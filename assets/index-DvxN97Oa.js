import{r as l,u as W,j as e,m as x,d as Ce,A as V,a as Ye,D as _e,b as le,R as $e,B as Qe,e as Ze,f as _,N as oe,g as Xe}from"./vendor-TSQaGVAF.js";import{W as ea,L as aa}from"./components-BTGIw8fp.js";import{s as K,A as sa,D as ta}from"./admin-Cshsfgaq.js";import{P as ia,a as na,b as la,c as ra,d as oa,e as ca,f as da,K as ma,G as ha,F as pa,g as ua,h as ga,D as xa,M as ja,A as va,i as ba,j as fa,V as ya,k as ka,l as Na}from"./games-BNDY0cYz.js";import{M as Sa,a as wa,b as _a,c as Ca,d as Ia,e as Ba,f as Ma,g as La,h as Pa,i as $a,j as Aa,k as Da,l as Ka,m as Oa,n as Ea,o as Ta,p as Fa,q as Ja,r as za,s as Ga,t as Ha,u as Ra,v as Ua,w as qa,x as Wa,y as Va,z as Ya,A as Qa,B as Za,C as Xa,D as es,E as as,F as ss,G as ts}from"./materi-DWe2SaUK.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))h(m);new MutationObserver(m=>{for(const u of m)if(u.type==="childList")for(const c of u.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&h(c)}).observe(document,{childList:!0,subtree:!0});function r(m){const u={};return m.integrity&&(u.integrity=m.integrity),m.referrerPolicy&&(u.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?u.credentials="include":m.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function h(m){if(m.ep)return;m.ep=!0;const u=r(m);fetch(m.href,u)}})();const Z=[{title:"Bab 1",levels:["Level 1"]},{title:"Bab 2",levels:["Level 1"]},{title:"Bab 3",levels:["Level 1"]}],xe=["addition","subtraction","multiplication","division"];function is(){const[i,n]=l.useState(null),[r,h]=l.useState(0),[m,u]=l.useState(Array(Z.length).fill(0)),[c,f]=l.useState(null),[B,y]=l.useState({completedLevels:0}),[g,k]=l.useState({}),p=W();l.useEffect(()=>{if(!(localStorage.getItem("isLoggedIn")==="true")){p("/login");return}const d=localStorage.getItem("userData"),o=d?JSON.parse(d):null,a=localStorage.getItem("selectedAvatar");if(a){const N=JSON.parse(a);f({...N,displayName:(o==null?void 0:o.nama)||N.name});const C=`avatar_${N.name}_levelScores`;JSON.parse(localStorage.getItem(C));const s=`avatar_${N.name}_operations`,M=JSON.parse(localStorage.getItem(s))||{},E={};let O=0;const J=Array(Z.length).fill(0);Z.forEach((z,H)=>{let R=z.levels.length*xe.length,q=0,Y=!1;z.levels.forEach((ee,se)=>{const ae=`bab${H}_level${se}`,Q=M[ae]||[];E[ae]=Q,Q.length===xe.length&&O++,q+=Q.length,Q.length>0&&(Y=!0)}),J[H]=Y?q/R*100:0}),u(J),y({completedLevels:O}),k(E);const T=J.reduce((z,H)=>z+H,0)/Z.length;h(T);const D=`avatar_${N.name}_chapterProgress`;localStorage.setItem(D,JSON.stringify(J))}},[p]);const A=(b,d)=>{localStorage.setItem("currentBabIndex",b),localStorage.setItem("currentLevelIndex",d),p(`/category?chapter=${b}&level=${d}`)},L=()=>{n(null)},$=(b,d)=>{if(!c)return!1;const o=`bab${b}_level${d}`;return g[o]&&g[o].length>0},j=(b,d)=>{if(!c)return 0;const o=`bab${b}_level${d}`;return g[o]?g[o].length/xe.length*100:0},v=(b,d,o)=>{if(!c)return!1;const a=`bab${b}_level${d}`;return g[a]&&g[a].includes(o)};return e.jsxs("div",{className:"main-siswa-container",children:[e.jsxs("header",{className:"header-siswa",children:[e.jsx(x.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:"Game Matematika Siswa"}),e.jsxs("div",{className:"profile-section",children:[e.jsx("div",{className:"profile-icon",children:c?e.jsx("img",{src:c.src,alt:c.displayName,className:"avatar-image"}):"👤"}),e.jsxs("div",{className:"progress-info",children:[e.jsxs("p",{children:["Progress"," ",e.jsx("strong",{children:c?c.displayName:"Siswa"}),":"," ",Math.round(r),"%"]}),e.jsxs("p",{children:["Level Selesai:"," ",e.jsx("strong",{children:B.completedLevels})," dari"," ",Z.length*Z[0].levels.length]})]})]})]}),e.jsxs("div",{className:"progress-container",children:[e.jsxs("div",{className:"progress-info",children:[e.jsxs("p",{children:["Progress"," ",e.jsx("strong",{children:c?c.name:"Siswa"}),":"," ",Math.round(r),"%"]}),e.jsxs("p",{children:["Level Selesai:"," ",e.jsx("strong",{children:B.completedLevels})," dari"," ",Z.length*Z[0].levels.length]})]}),e.jsx("div",{className:"progress-bar",children:e.jsx(x.div,{className:"progress",style:{width:`${r}%`},initial:{width:0},animate:{width:`${r}%`},transition:{duration:.8}})})]}),e.jsx("div",{className:"chapter-buttons",children:Z.map((b,d)=>e.jsxs(x.button,{className:"big-chapter-button",onClick:()=>n(d),initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.2*d},children:[b.title,e.jsxs("div",{className:"chapter-progress-indicator",children:[e.jsx("div",{className:"chapter-progress-bar",children:e.jsx("div",{className:"chapter-progress-fill",style:{width:`${m[d]}%`}})}),e.jsxs("span",{children:[Math.round(m[d]),"%"]})]})]},d))}),i!==null&&e.jsx("div",{className:"popup-overlay",children:e.jsxs(x.div,{className:"popup",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},children:[e.jsx("h2",{children:Z[i].title}),e.jsx("div",{className:"popup-progress-bar",children:e.jsx("div",{className:"popup-progress",style:{width:`${m[i]}%`}})}),e.jsxs("p",{className:"progress-text",children:[Math.round(m[i]),"% selesai"]}),e.jsx("div",{className:"levels",children:Z[i].levels.map((b,d)=>e.jsxs("div",{className:"level-container",children:[e.jsxs("button",{className:`level-button ${$(i,d)?"level-completed":""}`,onClick:()=>A(i,d),children:[b,e.jsx("div",{className:"level-progress-bar",children:e.jsx("div",{className:"level-progress-fill",style:{width:`${j(i,d)}%`}})})]}),e.jsx("div",{className:"category-indicators",children:xe.map((o,a)=>e.jsx("div",{className:`category-indicator ${v(i,d,o)?"category-completed":""}`,title:`${o} ${v(i,d,o)?"(completed)":"(not completed)"}`,children:v(i,d,o)&&"✓"},a))})]},d))}),e.jsx("button",{className:"close-popup-button",onClick:L,children:"✖ Kembali ke Menu"})]})})]})}function ns(){const[i,n]=l.useState(null),r=m=>{n(m)},h=()=>{n(null)};return e.jsxs("div",{className:"kategori-container",children:[e.jsx(x.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},className:"kategori-title",children:"Pilih Kategori Anda"}),e.jsx("div",{className:"kategori-grid",children:["Siswa","Guru","Orang Tua"].map((m,u)=>e.jsx(x.div,{className:"kategori-item",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2*u},onClick:()=>r(m),children:e.jsx("h2",{className:"kategori-text",children:m})},m))}),i&&e.jsx("div",{className:"login-popup",children:e.jsxs("div",{className:"login-form",children:[e.jsxs("h2",{children:["Login Sebagai ",i]}),e.jsx("input",{type:"text",placeholder:"Username"}),e.jsx("input",{type:"password",placeholder:"Password"}),e.jsx("button",{children:"Login"}),e.jsx("button",{className:"close-button",onClick:h,children:"Tutup"})]})})]})}function ls(){const{chapterIndex:i,levelIndex:n}=Ce(),[r,h]=l.useState(""),[m,u]=l.useState(0),[c,f]=l.useState(0),[B,y]=l.useState(0),[g,k]=l.useState(!1),[p,A]=l.useState(!1),[L,$]=l.useState([]),[j,v]=l.useState(!1),[b,d]=l.useState([]),o=W(),a={0:{0:[{pertanyaan:"Berapa hasil dari 2 + 2?",jawaban:"4",poin:20},{pertanyaan:"Berapa hasil dari 5 + 3?",jawaban:"8",poin:20},{pertanyaan:"Berapa hasil dari 4 + 6?",jawaban:"10",poin:20},{pertanyaan:"Berapa hasil dari 7 + 2?",jawaban:"9",poin:20},{pertanyaan:"Berapa hasil dari 3 + 8?",jawaban:"11",poin:20}]}},N=()=>{try{if(j){const T=L[c];return a[parseInt(i)][parseInt(n)][T]}else return a[parseInt(i)][parseInt(n)][c]}catch{return{pertanyaan:"Soal tidak tersedia",jawaban:"",poin:0}}},C=()=>{try{return j?L.length:a[parseInt(i)][parseInt(n)].length}catch{return 1}};l.useEffect(()=>{const T=JSON.parse(localStorage.getItem("chapterProgress"))||[];JSON.parse(localStorage.getItem("levelScores")),T&&T[i]&&y(T[i]);const D=a[parseInt(i)][parseInt(n)].length;d(Array(D).fill(null))},[i,n]);const s=T=>{if(T){const D=N().poin||0,z=C(),H=D/(z*20)*100,R=Math.min(B+H,100);y(R);const q=JSON.parse(localStorage.getItem("chapterProgress"))||Array(3).fill(0);q[i]=R,localStorage.setItem("chapterProgress",JSON.stringify(q));const Y=m+D;u(Y);const ee=localStorage.getItem("selectedAvatar");if(ee){const Q=JSON.parse(ee),te=`avatar_${Q.name}_levelScores`,re=JSON.parse(localStorage.getItem(te))||{},ce=`bab${i}_level${n}`;re[ce]=Y,localStorage.setItem(te,JSON.stringify(re));const de=`avatar_${Q.name}_chapterProgress`,me=JSON.parse(localStorage.getItem(de))||Array(3).fill(0);me[i]=R,localStorage.setItem(de,JSON.stringify(me));const he=window.location.pathname.split("/"),pe=he.length>2?he[2]:"addition",ue=JSON.parse(localStorage.getItem(`${te}_operations`))||{};ue[ce]=pe,localStorage.setItem(`${te}_operations`,JSON.stringify(ue)),localStorage.setItem(`${ce}_timestamp`,Date.now().toString()),localStorage.setItem("currentOperation",pe),localStorage.setItem("activeCharacter",ee)}const se=JSON.parse(localStorage.getItem("levelScores"))||{},ae=`bab${i}_level${n}`;return se[ae]=Y,localStorage.setItem("levelScores",JSON.stringify(se)),!0}return!1},M=()=>{if(!r.trim()){A(!0),k(!0),setTimeout(()=>{A(!1)},500),setTimeout(()=>{k(!1)},3e3);return}const T=N(),D=r.trim().toLowerCase()===T.jawaban.toLowerCase();if(j){if(D){[...L];const z=L[c],H=[...b];H[z]=!0,d(H)}}else{const z=[...b];z[c]=D,d(z),D||$([...L,c])}s(D),h(""),c<C()-1?f(c+1):L.length>0&&!j?E():O()},E=()=>{const T=`bab${i}_level${n}`;localStorage.setItem("currentLevelKey",T),localStorage.setItem("soalStatus",JSON.stringify(b)),localStorage.setItem("wrongAnswers",JSON.stringify(L)),localStorage.setItem("currentScore",m.toString());const D=C();localStorage.setItem("totalSoal",D.toString()),o(`/hasil-retry/${m}`)},O=()=>{const T=`bab${i}_level${n}`;localStorage.setItem("currentLevelKey",T);const D=C();localStorage.setItem("totalSoal",D.toString()),o(`/hasil/${m}`)},J=T=>{T.key==="Enter"&&M()};return l.useEffect(()=>{if(localStorage.getItem("retryMode")==="true"){const D=JSON.parse(localStorage.getItem("wrongAnswers"))||[],z=JSON.parse(localStorage.getItem("soalStatus"))||[],H=parseInt(localStorage.getItem("currentScore")||"0");v(!0),$(D),d(z),u(H),f(0),localStorage.removeItem("retryMode")}},[]),e.jsxs("div",{className:"game-page",children:[e.jsx("h1",{children:j?"Perbaiki Jawabanmu":"Game Matematika"}),e.jsxs("div",{className:"game-progress-container",children:[e.jsxs("div",{className:"game-progress-label",children:["Progress: ",Math.round(B),"%"]}),e.jsx("div",{className:"game-progress-bar",children:e.jsx("div",{className:"game-progress-fill",style:{width:`${B}%`}})})]}),e.jsxs("div",{className:"soal-info",children:[j?e.jsx("p",{className:"retry-mode",children:"Mode: Perbaikan Jawaban"}):null,e.jsxs("p",{children:["Bab ",parseInt(i)+1,", Level ",parseInt(n)+1]}),e.jsxs("p",{children:["Soal ",c+1," dari ",C(),j?" (yang perlu diperbaiki)":""]}),e.jsxs("p",{children:["Skor: ",m]})]}),e.jsxs(x.div,{className:"soal-container",animate:{scale:p?[1,1.02,.98,1]:1},transition:{duration:.5},children:[e.jsx(x.p,{className:"pertanyaan",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:300,damping:15},children:N().pertanyaan},`${j}-${c}`),e.jsxs("div",{className:"input-container",children:[e.jsx(x.input,{type:"text",value:r,onChange:T=>h(T.target.value),onKeyPress:J,placeholder:j?"Perbaiki jawabanmu...":"Masukkan jawaban...",autoFocus:!0,className:p?"shake-input":"",animate:{border:g?"2px solid #ff3d3d":"2px solid #999"}}),e.jsx(x.button,{onClick:M,whileHover:{scale:1.05},whileTap:{scale:.95},className:j?"retry-button":"",children:j?"Perbaiki":"Jawab"})]}),e.jsx(V,{children:g&&e.jsxs(x.div,{className:"error-message",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{type:"spring",stiffness:500,damping:30},children:[e.jsx("div",{className:"error-icon",children:"❗"}),e.jsx("p",{children:"Oops! Jawaban tidak boleh kosong"}),e.jsx("div",{className:"error-character",children:e.jsx("img",{src:"/src/assets/icon_murid.PNG",alt:"Karakter",className:"error-character-img"})})]})})]}),e.jsxs(x.div,{className:"helper-frame",initial:{x:100,opacity:0},animate:{x:0,opacity:1},transition:{delay:.5,type:"spring",stiffness:100},children:[e.jsx("div",{className:"speech-bubble",children:e.jsx("p",{children:j?"Yuk, perbaiki jawaban yang salah! 🧩":"Ayo jawab pertanyaannya! 🎮"})}),e.jsx("img",{src:j?"/src/assets/harimau.png":"/src/assets/anjing.png",alt:"Karakter Pembantu",className:"helper-character-img"})]})]})}function rs(){const{score:i}=Ce(),n=W(),[r,h]=l.useState({babIndex:0,levelIndex:0,levelKey:""});l.useEffect(()=>{const c=localStorage.getItem("currentLevelKey")||"";if(c){const f=c.match(/bab(\d+)/),B=c.match(/level(\d+)/);f&&B&&h({babIndex:parseInt(f[1]),levelIndex:parseInt(B[1]),levelKey:c})}if(c&&i){const f=localStorage.getItem("selectedAvatar");if(f){const A=JSON.parse(f),L=`avatar_${A.name}_levelScores`,$=localStorage.getItem("currentOperation")||"addition",j=Date.now(),v=`${c}_${$}_${j}`;let b=JSON.parse(localStorage.getItem(L))||{};b[v]=parseInt(i),localStorage.setItem(L,JSON.stringify(b));const d=`avatar_${A.name}_operations`,o=JSON.parse(localStorage.getItem(d))||{};o[v]=$,localStorage.setItem(d,JSON.stringify(o)),localStorage.setItem(`${v}_timestamp`,j.toString());const[a,N]=c.split("_"),C=parseInt(a.replace("bab","")),s=`avatar_${A.name}_chapterProgress`;let M=JSON.parse(localStorage.getItem(s))||Array(3).fill(0);const E=new Set;Object.keys(b).forEach(J=>{const T=J.split("_");T.length>=2&&T[0]===`bab${C}`&&E.add(T[1])});const O=Math.min(E.size/3*100,100);M[C]=O,localStorage.setItem(s,JSON.stringify(M))}const B=localStorage.getItem("currentOperation")||"addition",y=Date.now(),g=`${c}_${B}_${y}`;let k=JSON.parse(localStorage.getItem("levelScores"))||{};k[g]=parseInt(i),localStorage.setItem("levelScores",JSON.stringify(k));const p=JSON.parse(localStorage.getItem("chapterProgress"))||[];p.includes(g)||(p.push(g),localStorage.setItem("chapterProgress",JSON.stringify(p)))}if(parseInt(i)>50){const f=document.createElement("div");return f.className="confetti-container",document.body.appendChild(f),()=>{document.body.removeChild(f)}}},[i]);const m=()=>{r.levelIndex<2?n(`/materi/${r.babIndex}/${r.levelIndex+1}`):r.babIndex<2?n(`/materi/${r.babIndex+1}/0`):n("/main-siswa")},u=()=>{const c=parseInt(i),B=(parseInt(localStorage.getItem("totalSoal"))||5)*20,y=c/B*100;return y<=75?"Jangan Menyerah, Coba Lagi Ya!":y>75&&y<=85?"Wah Hebat, Sedikit Lagi Kamu Mencapai Skor Sempurna!":"Wah Hebatt, Pertahankan Ya!"};return e.jsxs(x.div,{className:"hasil-page",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},style:{minHeight:"100vh",width:"100%"},children:[e.jsx(x.h1,{initial:{scale:.5},animate:{scale:1},transition:{type:"spring",stiffness:200,damping:10},children:"🎉 Level Selesai!"}),e.jsxs("p",{children:["Bab ",r.babIndex+1,", Level ",r.levelIndex+1]}),e.jsxs(x.div,{className:"score-display",initial:{scale:.8,rotate:-5},animate:{scale:1,rotate:0},transition:{delay:.3,type:"spring"},children:[e.jsx("p",{className:"score-number",children:i}),e.jsx("p",{className:"score-label",children:"Skor Anda"})]}),e.jsx("p",{className:"score-message",children:u()}),e.jsx("div",{className:"hasil-buttons",children:e.jsx("button",{onClick:m,className:"next-level-button",children:"Level Selanjutnya ➔"})})]})}function os(){const i=W(),[n,r]=l.useState({name:"",role:"",avatar:null,id_kelas:null}),[h,m]=l.useState({totalScore:0,completedLevels:0,completedOperations:0,totalOperations:36,highestScore:0,recentActivity:[]}),[u]=l.useState(1),[c]=l.useState(1);l.useEffect(()=>{(async()=>{const p={addition:"Addition",subtraction:"Subtraction",multiplication:"Multiplication",division:"Division"},A=localStorage.getItem("userRole"),L=JSON.parse(localStorage.getItem("selectedAvatar")),$=localStorage.getItem("userKelas"),j=localStorage.getItem("id_siswa"),v=JSON.parse(localStorage.getItem("userData")||"{}");if(!L){i("/login");return}let b=null;if(v&&v.id_siswa)b=v,console.log("Using stored user data:",b);else try{let D=K.from("siswa").select("*");j?(D=D.eq("id_siswa",j),console.log("Searching by id_siswa:",j)):(D=D.ilike("nama",L.name),console.log("Searching by name:",L.name));const{data:z,error:H}=await D.maybeSingle();console.log("Fetched student data:",z),H?console.error("Error fetching siswa:",H):z?(localStorage.setItem("userData",JSON.stringify(z)),localStorage.setItem("userKelas",z.id_kelas.toString()),localStorage.setItem("id_siswa",z.id_siswa.toString()),b=z):(console.log("No student data found"),$&&(b={id_kelas:parseInt($)}))}catch(D){console.error("Exception fetching siswa:",D),$&&(b={id_kelas:parseInt($)})}b||(b={id_kelas:2},localStorage.setItem("userKelas","2")),r({name:(v==null?void 0:v.nama)||L.name||"Siswa",role:A||"siswa",avatar:{...L,displayName:(v==null?void 0:v.nama)||L.name},id_kelas:b.id_kelas});let d={};const o=`avatar_${L.name}_levelScores`;d=JSON.parse(localStorage.getItem(o))||{};const a=`avatar_${L.name}_operations`,N=JSON.parse(localStorage.getItem(a))||{};let C=0,s=0,M=0,E=0,O=[];const J={},T=new Set;Object.entries(d).forEach(([D,z])=>{if(z>0){const H=D.split("_");let R,q,Y;if(H.length>=3)R=`${H[0]}_${H[1]}`,q=H[2],Y=H.length>3?H[3]:Date.now().toString();else if(H.length===2)R=D,q=N[D]||"unknown",Y=Date.now().toString();else return;T.add(R),J[R]||(J[R]=[]),J[R].includes(q)||(J[R].push(q),M++),z>E&&(E=z);const[ee,se]=R.split("_"),ae=parseInt(ee.replace("bab",""))+1,Q=parseInt(se.replace("level",""))+1,te=p[q]||q,re=parseInt(localStorage.getItem(`${D}_timestamp`)||Y);O.push({id:D,bab:ae,level:Q,title:`Level ${Q} ${te}`,score:z,timestamp:re,operation:q}),C+=z}}),s=T.size,O.sort((D,z)=>z.timestamp-D.timestamp),m({totalScore:C,completedOperations:M,completedLevels:s,totalOperations:36,highestScore:E,recentActivity:O})})()},[i]);const f=()=>Math.round(h.completedOperations/h.totalOperations*100),B=()=>{const k=n.id_kelas;switch(console.log("Navigating based on kelas:",k),k){case 2:i("/kelas2");break;case 4:i("/kelas4");break;case 5:i("/kelas5");break;case 6:i("/kelas6");break;default:i("/main-siswa")}},y=(k,p,A)=>h.recentActivity.filter(L=>L.bab===k&&L.level===p&&L.operation===A),g=k=>{const p=new Date(k);return`${p.getDate()}/${p.getMonth()+1}/${p.getFullYear()}`};return e.jsxs(x.div,{className:"hasil-page skor-page",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[e.jsx("h1",{children:"Progres Belajarmu"}),e.jsxs("div",{className:"profile-info",children:[n.avatar&&e.jsx("div",{className:"avatar-container",children:e.jsx("img",{src:n.avatar.src,alt:"Avatar",className:"user-avatar"})}),e.jsxs("p",{children:["Hai, ",n.avatar?n.avatar.displayName:"Siswa","!"]})]}),e.jsxs("div",{className:"progress-overview",children:[e.jsxs("p",{children:["Total Skor: ",e.jsx("strong",{children:h.totalScore})]}),e.jsxs("p",{children:["Level Mulai Dikerjakan:"," ",e.jsx("strong",{children:h.completedLevels})," dari 9"]}),e.jsxs("p",{children:["Operasi Selesai: ",e.jsx("strong",{children:h.completedOperations})," ","dari ",h.totalOperations]}),e.jsxs("p",{children:["Progres Keseluruhan: ",e.jsxs("strong",{children:[f(),"%"]})]})]}),e.jsxs("div",{className:"skor-progress-container",children:[e.jsx("div",{className:"skor-progress-bar",children:e.jsx("div",{className:"skor-progress-fill",style:{width:`${f()}%`}})}),e.jsxs("p",{className:"progress-percentage",children:[f(),"%"]})]}),e.jsx("div",{className:"achievement-highlight",children:e.jsxs("p",{children:["Skor Tertinggi: ",e.jsx("strong",{children:h.highestScore})]})}),h.recentActivity.length>0?e.jsxs("div",{className:"recent-activities-container",children:[e.jsx("h2",{className:"aktivitas-title",children:"Aktivitas Terakhir"}),e.jsxs("div",{className:"recent-activities-box",children:[e.jsxs("h3",{className:"bab-title",children:["Bab ",u]}),e.jsx("div",{className:"divider"}),e.jsxs("div",{className:"level-container",children:[e.jsxs("h4",{className:"level-title",children:["Level ",c]}),e.jsxs("div",{className:"operations-container",children:[e.jsxs("div",{className:"operation-section",children:[e.jsx("h5",{className:"operation-title",children:"Addition"}),e.jsx("div",{className:"activities-grid",children:y(u,c,"addition").length>0?y(u,c,"addition").map(k=>e.jsxs("div",{className:"activity-white-card",children:[e.jsxs("div",{className:"operation-score",children:["Skor: ",e.jsx("span",{children:k.score})]}),e.jsx("div",{className:"activity-date",children:g(k.timestamp)})]},k.id)):e.jsx("div",{className:"no-activity-message",children:"Belum ada aktivitas Addition"})})]}),e.jsxs("div",{className:"operation-section",children:[e.jsx("h5",{className:"operation-title",children:"Subtraction"}),e.jsx("div",{className:"activities-grid",children:y(u,c,"subtraction").length>0?y(u,c,"subtraction").map(k=>e.jsxs("div",{className:"activity-white-card",children:[e.jsxs("div",{className:"operation-score",children:["Skor: ",e.jsx("span",{children:k.score})]}),e.jsx("div",{className:"activity-date",children:g(k.timestamp)})]},k.id)):e.jsx("div",{className:"no-activity-message",children:"Belum ada aktivitas Subtraction"})})]}),e.jsxs("div",{className:"operation-section",children:[e.jsx("h5",{className:"operation-title",children:"Multiplication"}),e.jsx("div",{className:"activities-grid",children:y(u,c,"multiplication").length>0?y(u,c,"multiplication").map(k=>e.jsxs("div",{className:"activity-white-card",children:[e.jsxs("div",{className:"operation-score",children:["Skor: ",e.jsx("span",{children:k.score})]}),e.jsx("div",{className:"activity-date",children:g(k.timestamp)})]},k.id)):e.jsx("div",{className:"no-activity-message",children:"Belum ada aktivitas Multiplication"})})]}),e.jsxs("div",{className:"operation-section",children:[e.jsx("h5",{className:"operation-title",children:"Division"}),e.jsx("div",{className:"activities-grid",children:y(u,c,"division").length>0?y(u,c,"division").map(k=>e.jsxs("div",{className:"activity-white-card",children:[e.jsxs("div",{className:"operation-score",children:["Skor: ",e.jsx("span",{children:k.score})]}),e.jsx("div",{className:"activity-date",children:g(k.timestamp)})]},k.id)):e.jsx("div",{className:"no-activity-message",children:"Belum ada aktivitas Division"})})]})]})]})]})]}):e.jsxs("div",{className:"recent-activities-container empty-activities",children:[e.jsx("h2",{className:"aktivitas-title",children:"Aktivitas Terakhir"}),e.jsx("div",{className:"empty-message",children:e.jsx("p",{children:"Belum ada aktivitas. Ayo mulai belajar!"})})]}),e.jsx("div",{className:"navigation-buttons",children:e.jsx("button",{onClick:B,className:"menu-button",children:"Kembali ke Menu"})})]})}function cs(){const{score:i}=Ce(),n=W(),[r,h]=l.useState({babIndex:0,levelIndex:0,levelKey:""}),[m,u]=l.useState(0);l.useEffect(()=>{const y=localStorage.getItem("currentLevelKey")||"",g=JSON.parse(localStorage.getItem("wrongAnswers"))||[];if(u(g.length),y){const k=y.match(/bab(\d+)/),p=y.match(/level(\d+)/);k&&p&&h({babIndex:parseInt(k[1]),levelIndex:parseInt(p[1]),levelKey:y})}},[]);const c=()=>{const y=parseInt(i),k=(parseInt(localStorage.getItem("totalSoal"))||5)*20,p=y/k*100;return p<=75?"Jangan Menyerah, Coba Lagi Ya!":p>75&&p<=85?"Wah Hebat, Sedikit Lagi Kamu Mencapai Skor Sempurna!":"Wah Hebatt, Pertahankan Ya!"},f=()=>{localStorage.setItem("retryMode","true"),n(`/game/${r.babIndex}/${r.levelIndex}`)},B=()=>{localStorage.removeItem("retryMode"),localStorage.removeItem("wrongAnswers"),localStorage.removeItem("soalStatus"),n(`/hasil/${i}`)};return e.jsxs(x.div,{className:"hasil-page retry-page",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[e.jsx(x.h1,{initial:{scale:.5},animate:{scale:1},transition:{type:"spring",stiffness:200,damping:10},children:"Ayo Coba Lagi! ✏️"}),e.jsxs("p",{children:["Bab ",r.babIndex+1,", Level ",r.levelIndex+1]}),e.jsxs(x.div,{className:"score-display",initial:{scale:.8,rotate:-5},animate:{scale:1,rotate:0},transition:{delay:.3,type:"spring"},children:[e.jsx("p",{className:"score-number",children:i}),e.jsx("p",{className:"score-label",children:"Skor Saat Ini"})]}),e.jsx("p",{className:"score-message",children:c()}),e.jsxs("div",{className:"retry-info",children:[e.jsxs(x.div,{className:"wrong-answers-count",initial:{x:-50,opacity:0},animate:{x:0,opacity:1},transition:{delay:.5,type:"spring"},children:[e.jsx("p",{className:"wrong-count",children:m}),e.jsx("p",{children:"Soal yang perlu diperbaiki"})]}),e.jsx(x.p,{className:"retry-message",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.7},children:"Beberapa jawaban masih kurang tepat. Mau mencoba lagi soal yang salah saja?"})]}),e.jsxs(x.div,{className:"helper-frame retry-character",initial:{y:50,opacity:0},animate:{y:0,opacity:1},transition:{delay:.9,type:"spring",stiffness:100},style:{alignItems:"flex-end",alignSelf:"flex-end",marginRight:"30px"},children:[e.jsx("div",{className:"speech-bubble",style:{alignSelf:"flex-end"},children:e.jsx("p",{children:"Jangan menyerah! Yuk perbaiki jawabanmu! 😺"})}),e.jsx("img",{src:"/src/assets/kucing.png",alt:"Karakter Kucing",className:"helper-character-img",style:{alignSelf:"flex-end"}})]}),e.jsxs("div",{className:"hasil-buttons",children:[e.jsx("button",{onClick:f,className:"retry-button",children:"Perbaiki Jawaban"}),e.jsx("button",{onClick:B,className:"skip-button",children:"Lanjutkan Saja"})]})]})}const Be=["addition","subtraction","multiplication","division"],je={addition:"penjumlahan",subtraction:"pengurangan",multiplication:"perkalian",division:"pembagian"},ds=()=>{const i=W(),n=Ye(),[r,h]=l.useState([]),[m,u]=l.useState(0),[c,f]=l.useState(0),[B,y]=l.useState(null),[g,k]=l.useState({addition:!1,subtraction:!1,multiplication:!1,division:!1}),[p,A]=l.useState(Be);l.useEffect(()=>{(()=>{const a=[];for(let N=0;N<15;N++)a.push({id:N,left:`${Math.random()*100}%`,size:`${Math.random()*60+10}px`,delay:`${Math.random()*15}s`,duration:`${Math.random()*10+10}s`});h(a)})();const v=new URLSearchParams(n.search),b=v.get("chapter"),d=v.get("level");if(b!==null&&d!==null)u(parseInt(b)),f(parseInt(d)),localStorage.setItem("currentBabIndex",b),localStorage.setItem("currentLevelIndex",d);else{const a=localStorage.getItem("currentBabIndex"),N=localStorage.getItem("currentLevelIndex");a&&N&&(u(parseInt(a)),f(parseInt(N)))}const o=localStorage.getItem("selectedAvatar");o&&y(JSON.parse(o)),L()},[n]);const L=()=>{const j=localStorage.getItem("selectedAvatar");if(!j)return;const v=JSON.parse(j);y(v);const b=`avatar_${v.name}_operations`,d=JSON.parse(localStorage.getItem(b))||{},o=localStorage.getItem("currentBabIndex"),a=localStorage.getItem("currentLevelIndex"),N=`bab${o}_level${a}`,C={addition:!1,subtraction:!1,multiplication:!1,division:!1};Object.entries(d).forEach(([s,M])=>{s===N&&(M==="addition"&&(C.addition=!0),M==="subtraction"&&(C.subtraction=!0),M==="multiplication"&&(C.multiplication=!0),M==="division"&&(C.division=!0))}),k(C),A(Be)},$=(j,v)=>{v==="materi"?i(`/materi/${j}`):v==="soal"&&(j==="addition"?i("/game/penjumlahan"):j==="subtraction"?i("/game/pengurangan"):j==="multiplication"?i("/game/perkalian"):j==="division"&&i("/game/pembagian"))};return e.jsxs("div",{className:"category-container",children:[r.map(j=>e.jsx("div",{className:"bubble",style:{left:j.left,width:j.size,height:j.size,animationDelay:j.delay,animationDuration:j.duration}},j.id)),e.jsxs("div",{className:"header2",children:[e.jsxs("h1",{children:["Halo ",B?B.name:"Tamu"," ",e.jsx("span",{className:"wave",children:"👋"})]}),e.jsx("p",{children:"Silahkan pilih kategori yang ingin kamu pelajari"}),e.jsxs("p",{className:"level-info",children:["Bab ",m+1," Level ",c+1]})]}),e.jsxs("div",{className:"categories-section",children:[e.jsx("h2",{children:"Kategori"}),e.jsxs("div",{className:"categories-grid",children:[e.jsxs("div",{className:"category-item",children:[e.jsxs("div",{className:`category-circle addition ${g.addition?"completed":""}`,children:[e.jsx("span",{className:"category-symbol",children:"2+2"}),g.addition&&e.jsx("div",{className:"completed-check",children:"✓"})]}),e.jsx("p",{className:"category-name",children:je.addition}),e.jsxs("div",{className:"category-buttons",children:[e.jsx("button",{className:"btn-materi",onClick:()=>$("addition","materi"),children:"Materi"}),e.jsx("button",{className:"btn-soal",onClick:()=>$("addition","soal"),children:"Soal"})]})]}),e.jsxs("div",{className:"category-item",children:[e.jsxs("div",{className:`category-circle substraction ${g.subtraction?"completed":""}`,children:[e.jsx("span",{className:"category-symbol",children:"2-2"}),g.subtraction&&e.jsx("div",{className:"completed-check",children:"✓"})]}),e.jsx("p",{className:"category-name",children:je.subtraction}),e.jsxs("div",{className:"category-buttons",children:[e.jsx("button",{className:"btn-materi",onClick:()=>$("subtraction","materi"),children:"Materi"}),e.jsx("button",{className:"btn-soal",onClick:()=>$("subtraction","soal"),children:"Soal"})]})]}),e.jsxs("div",{className:"category-item",children:[e.jsxs("div",{className:`category-circle division ${g.division?"completed":""}`,children:[e.jsx("span",{className:"category-symbol",children:"10/5"}),g.division&&e.jsx("div",{className:"completed-check",children:"✓"})]}),e.jsx("p",{className:"category-name",children:je.division}),e.jsxs("div",{className:"category-buttons",children:[e.jsx("button",{className:"btn-materi",onClick:()=>$("division","materi"),children:"Materi"}),e.jsx("button",{className:"btn-soal",onClick:()=>$("division","soal"),children:"Soal"})]})]}),e.jsxs("div",{className:"category-item",children:[e.jsxs("div",{className:`category-circle multiplication ${g.multiplication?"completed":""}`,children:[e.jsx("span",{className:"category-symbol",children:"2×2"}),g.multiplication&&e.jsx("div",{className:"completed-check",children:"✓"})]}),e.jsx("p",{className:"category-name",children:je.multiplication}),e.jsxs("div",{className:"category-buttons",children:[e.jsx("button",{className:"btn-materi",onClick:()=>$("multiplication","materi"),children:"Materi"}),e.jsx("button",{className:"btn-soal",onClick:()=>$("multiplication","soal"),children:"Soal"})]})]})]})]})]})},Me=async i=>{try{const{data:n,error:r}=await K.from("nilai").select(`
        id_nilai,
        nilai,
        tanggal,
        materi:id_materi (id_materi, nama_materi, kategori)
      `).eq("id_siswa",i);if(r)throw r;return n}catch(n){throw console.error(`Error fetching nilai for siswa ${i}:`,n),n}},ms=async i=>{try{const{data:n,error:r}=await K.from("riwayat_siswa").select(`
        id_riwayat,
        id_siswa,
        id_materi,
        kategori,
        nilai,
        waktu_pengerjaan,
        durasi_pengerjaan,
        jumlah_benar,
        jumlah_salah,
        level_kesulitan,
        selesai,
        keterangan,
        materi:id_materi (id_materi, nama_materi)
      `).eq("id_siswa",i).order("waktu_pengerjaan",{ascending:!1});if(r)throw r;return n}catch(n){throw console.error(`Error fetching riwayat for siswa ${i}:`,n),n}},ye=async i=>{const n=[{id_materi:101,nama_materi:"Penjumlahan 1-50",kategori:"Bilangan"},{id_materi:102,nama_materi:"Pengurangan 1-50",kategori:"Bilangan"},{id_materi:103,nama_materi:"Perkalian Dasar",kategori:"Bilangan"},{id_materi:104,nama_materi:"Pembagian Dasar",kategori:"Bilangan"},{id_materi:105,nama_materi:"Bangun Datar",kategori:"Geometri"},{id_materi:106,nama_materi:"Bangun Ruang",kategori:"Geometri"},{id_materi:107,nama_materi:"Satuan Panjang",kategori:"Pengukuran"},{id_materi:108,nama_materi:"Satuan Berat",kategori:"Pengukuran"},{id_materi:109,nama_materi:"Satuan Waktu",kategori:"Pengukuran"},{id_materi:110,nama_materi:"Pecahan",kategori:"Bilangan Pecahan"}],r=Math.floor(Math.random()*6)+5,h=[],m=new Date;for(let u=0;u<r;u++){const c=Math.floor(Math.random()*90),f=new Date(m);f.setDate(f.getDate()-c);const B=n[Math.floor(Math.random()*n.length)],y=Math.floor(Math.random()*101);h.push({id_nilai:u+1e3,id_siswa:i,id_materi:B.id_materi,nilai:y,tanggal:f.toISOString().split("T")[0],materi:B})}return h.sort((u,c)=>new Date(c.tanggal)-new Date(u.tanggal)),await new Promise(u=>setTimeout(u,800)),h},hs=({isOpen:i,onClose:n,student:r})=>{const[h,m]=l.useState([]),[u,c]=l.useState(!0),[f,B]=l.useState(null),[y,g]=l.useState(!1),[k,p]=l.useState("riwayat"),[A,L]=l.useState("semua"),[$,j]=l.useState([]);l.useEffect(()=>{i&&r&&v()},[i,r]);const v=async()=>{try{c(!0),B(null),g(!1),p("riwayat");let o;try{o=await ms(r.id),(!o||o.length===0)&&(p("nilai"),o=await Me(r.id),(!o||o.length===0)&&(g(!0),o=await ye(r.id)))}catch(N){console.warn("Error fetching real history, trying nilai table:",N);try{p("nilai"),o=await Me(r.id),(!o||o.length===0)&&(g(!0),o=await ye(r.id))}catch(C){console.warn("Error fetching from nilai table, using dummy data:",C),g(!0),o=await ye(r.id)}}let a;k==="riwayat"?a=o:a=o.sort((N,C)=>{const s=N.waktu_pengerjaan?N.waktu_pengerjaan:N.tanggal,M=C.waktu_pengerjaan?C.waktu_pengerjaan:C.tanggal;return new Date(M)-new Date(s)}),m(a)}catch(o){console.error("Error fetching student history:",o),B("Gagal memuat riwayat siswa")}finally{c(!1)}};l.useEffect(()=>{if(h.length>0)if(A==="semua")j(h);else{const o=h.filter(a=>{var C;return(a.kategori||((C=a.materi)==null?void 0:C.kategori)||"").toLowerCase()===A.toLowerCase()});j(o)}else j([])},[h,A]);const b=()=>{const o=new Set;return h.forEach(a=>{var C;const N=a.kategori||((C=a.materi)==null?void 0:C.kategori);N&&o.add(N)}),["semua",...Array.from(o)]},d=()=>{let o="Tanggal,Materi,Kategori,Nilai";k==="riwayat"?o+=`,Benar,Salah,Level Kesulitan
`:o+=`
`,$.forEach(s=>{var D,z;const M=s.waktu_pengerjaan?s.waktu_pengerjaan:s.tanggal,E=((D=s.materi)==null?void 0:D.nama_materi)||"-",O=s.kategori||((z=s.materi)==null?void 0:z.kategori)||"-",J=s.nilai||0;let T=`"${new Date(M).toLocaleDateString("id-ID")}","${E}","${O}","${J}"`;if(k==="riwayat"){const H=s.jumlah_benar||0,R=s.jumlah_salah||0,q=s.level_kesulitan||"Sedang";T+=`,"${H}","${R}","${q}"`}o+=T+`
`});const a=new Blob([o],{type:"text/csv;charset=utf-8;"}),N=URL.createObjectURL(a),C=document.createElement("a");C.setAttribute("href",N),C.setAttribute("download",`riwayat_${r.name}_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(C),C.click(),document.body.removeChild(C)};return i?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:["Riwayat Belajar ",(r==null?void 0:r.name)||"Siswa"]}),e.jsx("button",{className:"close-button",onClick:n,children:"×"})]}),e.jsx("div",{className:"modal-body",children:u?e.jsxs("div",{className:"loading",children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Memuat data riwayat..."]}):f?e.jsx("div",{className:"error-message",children:f}):h.length===0?e.jsx("div",{className:"empty-history",children:"Belum ada riwayat belajar untuk siswa ini"}):e.jsxs("div",{className:"history-list",children:[y&&e.jsxs("div",{className:"dummy-data-notice",children:[e.jsx("i",{className:"fas fa-info-circle"})," Menampilkan data contoh. Data asli belum tersedia."]}),!y&&e.jsxs("div",{className:"data-source-info",children:[e.jsx("i",{className:"fas fa-database"}),"Data dari: ",k==="riwayat"?"Riwayat Lengkap":"Nilai Ujian"]}),e.jsxs("div",{className:"filter-section",children:[e.jsx("label",{htmlFor:"filterKategori",children:"Filter Kategori:"}),e.jsx("select",{id:"filterKategori",value:A,onChange:o=>L(o.target.value),children:b().map(o=>e.jsx("option",{value:o,children:o},o))}),e.jsx("button",{className:"export-button",onClick:d,children:"Ekspor ke CSV"})]}),e.jsxs("table",{className:"history-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Tanggal"}),e.jsx("th",{children:"Materi"}),e.jsx("th",{children:"Kategori"}),e.jsx("th",{children:"Nilai"}),"                    ",k==="riwayat"&&e.jsxs(e.Fragment,{children:[e.jsx("th",{children:"Benar"}),e.jsx("th",{children:"Level"})]})]})}),e.jsx("tbody",{children:$.map(o=>{var M,E,O;const a=o.waktu_pengerjaan?o.waktu_pengerjaan:o.tanggal,N=((M=o.materi)==null?void 0:M.nama_materi)||"-",C=o.kategori||((E=o.materi)==null?void 0:E.kategori)||"-",s=o.nilai||0;return e.jsxs("tr",{children:[e.jsx("td",{children:new Date(a).toLocaleDateString("id-ID")}),e.jsx("td",{children:N}),e.jsx("td",{children:C}),e.jsx("td",{className:s>=70?"good-score":"needs-improvement",children:s}),"                        ",k==="riwayat"&&e.jsxs(e.Fragment,{children:[e.jsxs("td",{children:[o.jumlah_benar||0,"/",(o.jumlah_benar||0)+(o.jumlah_salah||0)]}),e.jsx("td",{children:e.jsx("span",{className:`level-${((O=o.level_kesulitan)==null?void 0:O.toLowerCase())||"sedang"}`,children:o.level_kesulitan||"Sedang"})})]})]},o.id_riwayat||o.id_nilai)})})]})]})}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"action-button close",onClick:n,children:"Tutup"})})]})}):null},ps=({isOpen:i,onClose:n,studentId:r,teacherId:h,studentName:m})=>{const[u,c]=l.useState(""),[f,B]=l.useState(!1),[y,g]=l.useState(null),[k,p]=l.useState(!0);l.useEffect(()=>{(async()=>{console.log("Fetching user from localStorage..."),p(!0);const $=localStorage.getItem("isLoggedIn")==="true",j=localStorage.getItem("userRole"),v=localStorage.getItem("userData"),b=v?JSON.parse(v):null;console.log("Login status:",{isLoggedIn:$,userRole:j,userData:b}),!$||j!=="guru"||!b?(console.warn("No valid teacher login session found in localStorage"),g(null)):(console.log("User from localStorage:",b),g(b)),p(!1)})()},[]),l.useEffect(()=>{console.log("Button status:",{loading:f,isUserLoading:k,user:y?"User exists":"No user",teacherId:h,studentId:r})},[f,k,y,h,r]);const A=async L=>{if(L.preventDefault(),k){console.log("User is still loading, preventing submit.");return}if(!y){alert("Anda harus login terlebih dahulu");return}if(!u.trim()){alert("Catatan tidak boleh kosong");return}if(!h){console.error("teacherId tidak diberikan ke ModalCatatan."),alert("Terjadi kesalahan: Informasi guru tidak lengkap.");return}try{B(!0);const $=_e.local().setZone("Asia/Jakarta"),{data:j,error:v}=await K.from("catatan").insert({id_guru:h,catatan:u.trim(),waktu:$.toISO()}).select().single();if(v)throw console.error("Error membuat catatan:",v),v;const{error:b}=await K.from("siswa_catatan").insert({id_siswa:r,id_catatan:j.id_catatan});if(b)throw console.error("Error membuat relasi:",b),b;alert("Catatan berhasil disimpan"),n(),c("")}catch($){console.error("Error menyimpan catatan:",$),alert("Terjadi kesalahan saat menyimpan catatan. Silakan coba lagi.")}finally{B(!1)}};return i?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h3",{children:["Tambah Catatan untuk ",m]}),e.jsx("button",{className:"close-button",onClick:n,children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("form",{onSubmit:A,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"catatan",children:"Catatan:"}),e.jsx("textarea",{id:"catatan",value:u,onChange:L=>c(L.target.value),placeholder:"Tulis catatan untuk siswa...",rows:"5",required:!0})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"cancel-button",onClick:n,disabled:f||k,children:"Batal"}),e.jsx("button",{type:"submit",className:"submit-button",disabled:f||k||!y,children:f?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Menyimpan..."]}):k?"Memuat user...":y?"Simpan Catatan":"Login diperlukan"})]})]})]})}):null},us=({isOpen:i,onClose:n,student:r,notes:h,onDeleteNote:m})=>{const u=c=>_e.fromISO(c).setZone("Asia/Jakarta").toLocaleString(_e.DATETIME_MED_WITH_SECONDS,{locale:"id"});return i?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Catatan Siswa"}),e.jsx("button",{className:"close-button",onClick:n,children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"student-info",children:[e.jsx("h3",{children:r.name}),e.jsx("p",{className:"student-class",children:r.class})]}),e.jsx("div",{className:"notes-container",children:h&&h.length>0?h.map((c,f)=>e.jsxs("div",{className:"note-item",children:[e.jsx("div",{className:"note-header",children:e.jsx("span",{className:"note-date",children:u(c.waktu)})}),e.jsxs("div",{className:"note-content",children:[e.jsx("p",{className:"note-text",children:c.catatan}),e.jsxs("div",{className:"note-actions",children:[e.jsxs("button",{className:"send-to-parent-button-inline",onClick:()=>alert(`Kirim catatan ID ${c.id_catatan} ke wali`),children:[e.jsx("i",{className:"fas fa-paper-plane"})," Kirim ke wali"]}),e.jsxs("button",{className:"delete-note-button-inline",onClick:()=>m(c.id_catatan),children:[e.jsx("i",{className:"fas fa-trash"})," Hapus Catatan"]})]})]})]},f)):e.jsxs("div",{className:"no-notes",children:[e.jsx("i",{className:"fas fa-info-circle"}),e.jsx("p",{children:"Belum ada catatan untuk siswa ini"})]})}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"close-modal-button",onClick:n,children:"Tutup"})})]})}):null},gs=({isOpen:i,onClose:n,student:r,onUpdate:h})=>{const[m,u]=l.useState({nama:"",nis:"",tanggal_lahir:"",alamat:"",id_kelas:"",avatar:"",Jenis_Kelamin:"",id_wali:""}),[c,f]=l.useState([]),[B,y]=l.useState(!1),[g,k]=l.useState(null),p=["Anjing","Babi","Bebek","Gurita","Harimau","Kelinci","Kucing","Sapi","Serigala","Singa"];l.useEffect(()=>{var v;r&&u({nama:r.name||"",nis:r.nis||"",tanggal_lahir:r.birthDate||"",alamat:r.address||"",id_kelas:((v=r.class)==null?void 0:v.replace("Kelas ",""))||"",avatar:r.avatar||"",Jenis_Kelamin:r.gender||"",id_wali:r.id_wali||""}),A()},[r]);const A=async()=>{try{const{data:v,error:b}=await K.from("wali").select("id_wali, nama");if(b)throw b;f(v||[])}catch(v){console.error("Error fetching parents:",v),k("Gagal memuat data wali murid")}},L=async v=>{try{const{data:b,error:d}=await K.from("siswa").select("id_siswa").eq("id_wali",v);if(d)throw d;return!(b&&b.length>=3&&!b.some(o=>o.id_siswa===r.id))}catch(b){return console.error("Error checking parent assignments:",b),!1}},$=async v=>{const{name:b,value:d}=v.target;b==="id_wali"&&d&&(await L(d)||alert("Peringatan: Wali murid ini sudah ditautkan dengan 3 siswa lain.")),u(o=>({...o,[b]:d}))},j=async v=>{v.preventDefault(),y(!0),k(null);try{if(m.id_wali&&!await L(m.id_wali)&&!confirm("Wali murid ini sudah ditautkan dengan 3 siswa lain. Apakah Anda yakin ingin melanjutkan?")){y(!1);return}const{error:b}=await K.from("siswa").update({nama:m.nama,nis:m.nis,tanggal_lahir:m.tanggal_lahir,alamat:m.alamat,id_kelas:m.id_kelas,avatar:m.avatar,Jenis_Kelamin:m.Jenis_Kelamin,id_wali:m.id_wali||null}).eq("id_siswa",r.id);if(b)throw b;alert("Data siswa berhasil diperbarui!"),h(),n()}catch(b){console.error("Error updating student:",b),k("Gagal memperbarui data siswa: "+b.message)}finally{y(!1)}};return i?e.jsx("div",{className:"edit-modal-overlay",children:e.jsxs("div",{className:"edit-modal",children:[e.jsxs("div",{className:"edit-modal-header",children:[e.jsx("h2",{children:"Edit Data Siswa"}),e.jsx("button",{className:"close-button",onClick:n,children:"×"})]}),e.jsxs("form",{onSubmit:j,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"nama",children:"Nama Siswa:"}),e.jsx("input",{type:"text",id:"nama",name:"nama",value:m.nama,onChange:$,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"nis",children:"NIS:"}),e.jsx("input",{type:"text",id:"nis",name:"nis",value:m.nis,onChange:$,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"tanggal_lahir",children:"Tanggal Lahir:"}),e.jsx("input",{type:"date",id:"tanggal_lahir",name:"tanggal_lahir",value:m.tanggal_lahir,onChange:$,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"alamat",children:"Alamat:"}),e.jsx("textarea",{id:"alamat",name:"alamat",value:m.alamat,onChange:$,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"id_kelas",children:"Kelas:"}),e.jsx("input",{type:"number",id:"id_kelas",name:"id_kelas",value:m.id_kelas,onChange:$,min:"1",max:"6",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"avatar",children:"Avatar:"}),e.jsxs("select",{id:"avatar",name:"avatar",value:m.avatar,onChange:$,required:!0,children:[e.jsx("option",{value:"",children:"Pilih Avatar"}),p.map(v=>e.jsx("option",{value:v,children:v},v))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"Jenis_Kelamin",children:"Jenis Kelamin:"}),e.jsxs("select",{id:"Jenis_Kelamin",name:"Jenis_Kelamin",value:m.Jenis_Kelamin,onChange:$,required:!0,children:[e.jsx("option",{value:"",children:"Pilih Jenis Kelamin"}),e.jsx("option",{value:"L",children:"Laki-laki"}),e.jsx("option",{value:"P",children:"Perempuan"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"id_wali",children:"Wali Murid:"}),e.jsxs("select",{id:"id_wali",name:"id_wali",value:m.id_wali||"",onChange:$,children:[e.jsx("option",{value:"",children:"Pilih Wali Murid"}),c.map(v=>e.jsx("option",{value:v.id_wali,children:v.nama},v.id_wali))]})]}),g&&e.jsx("div",{className:"error-message",children:g}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"save-button",disabled:B,children:B?"Menyimpan...":"Simpan"}),e.jsx("button",{type:"button",className:"cancel-button",onClick:n,disabled:B,children:"Batal"})]})]})]})}):null},xs=({isOpen:i,onClose:n,onAdd:r})=>{const[h,m]=l.useState({nama:"",nis:"",tanggal_lahir:"",alamat:"",id_kelas:"",avatar:"",Jenis_Kelamin:"L",id_wali:""}),[u,c]=l.useState([]),[f,B]=l.useState(!1),[y,g]=l.useState(null),k=["Anjing","Babi","Bebek","Gurita","Harimau","Kelinci","Kucing","Sapi","Serigala","Singa"];l.useEffect(()=>{p()},[]);const p=async()=>{try{const{data:j,error:v}=await K.from("wali").select("id_wali, nama");if(v)throw v;c(j||[])}catch(j){console.error("Error fetching parents:",j),g("Gagal memuat data wali murid")}},A=async j=>{try{const{data:v,error:b}=await K.from("siswa").select("id_siswa").eq("id_wali",j);if(b)throw b;return!(v&&v.length>=3)}catch(v){return console.error("Error checking parent assignments:",v),!1}},L=async j=>{const{name:v,value:b}=j.target;v==="id_wali"&&b&&(await A(b)||alert("Peringatan: Wali murid ini sudah ditautkan dengan 3 siswa.")),m(d=>({...d,[v]:b}))},$=async j=>{j.preventDefault(),B(!0),g(null);try{if(h.id_wali&&!await A(h.id_wali)&&!confirm("Wali murid ini sudah ditautkan dengan 3 siswa. Apakah Anda yakin ingin melanjutkan?")){B(!1);return}const{data:v,error:b}=await K.from("siswa").insert({nama:h.nama,nis:h.nis,tanggal_lahir:h.tanggal_lahir,alamat:h.alamat,id_kelas:h.id_kelas,avatar:h.avatar,Jenis_Kelamin:h.Jenis_Kelamin,id_wali:h.id_wali||null,id_role:4}).select().single();if(b)throw b;alert("Siswa baru berhasil ditambahkan!"),r(v),n()}catch(v){console.error("Error adding student:",v),g("Gagal menambahkan siswa: "+v.message)}finally{B(!1)}};return i?e.jsx("div",{className:"edit-modal-overlay",children:e.jsxs("div",{className:"edit-modal",children:[e.jsxs("div",{className:"edit-modal-header",children:[e.jsx("h2",{children:"Tambah Siswa Baru"}),e.jsx("button",{className:"close-button",onClick:n,children:"×"})]}),e.jsxs("form",{onSubmit:$,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"nama",children:"Nama Siswa:"}),e.jsx("input",{type:"text",id:"nama",name:"nama",value:h.nama,onChange:L,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"nis",children:"NIS:"}),e.jsx("input",{type:"text",id:"nis",name:"nis",value:h.nis,onChange:L,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"tanggal_lahir",children:"Tanggal Lahir:"}),e.jsx("input",{type:"date",id:"tanggal_lahir",name:"tanggal_lahir",value:h.tanggal_lahir,onChange:L,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"alamat",children:"Alamat:"}),e.jsx("textarea",{id:"alamat",name:"alamat",value:h.alamat,onChange:L,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"id_kelas",children:"Kelas:"}),e.jsx("input",{type:"number",id:"id_kelas",name:"id_kelas",value:h.id_kelas,onChange:L,min:"1",max:"6",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"avatar",children:"Avatar:"}),e.jsxs("select",{id:"avatar",name:"avatar",value:h.avatar,onChange:L,required:!0,children:[e.jsx("option",{value:"",children:"Pilih Avatar"}),k.map(j=>e.jsx("option",{value:j,children:j},j))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"Jenis_Kelamin",children:"Jenis Kelamin:"}),e.jsxs("select",{id:"Jenis_Kelamin",name:"Jenis_Kelamin",value:h.Jenis_Kelamin,onChange:L,required:!0,children:[e.jsx("option",{value:"L",children:"Laki-laki"}),e.jsx("option",{value:"P",children:"Perempuan"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"id_wali",children:"Wali Murid:"}),e.jsxs("select",{id:"id_wali",name:"id_wali",value:h.id_wali||"",onChange:L,children:[e.jsx("option",{value:"",children:"Pilih Wali Murid"}),u.map(j=>e.jsx("option",{value:j.id_wali,children:j.nama},j.id_wali))]})]}),y&&e.jsx("div",{className:"error-message",children:y}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"save-button",disabled:f,children:f?"Menyimpan...":"Simpan"}),e.jsx("button",{type:"button",className:"cancel-button",onClick:n,disabled:f,children:"Batal"})]})]})]})}):null},js=({isOpen:i,onClose:n,student:r,availableClasses:h,onConfirm:m,type:u})=>{if(!i)return null;const c=f=>{const B=u==="naik"?`Apakah Anda yakin ingin menaikkan ${r.name} ke ${f}?`:`Apakah Anda yakin ingin memindahkan ${r.name} ke ${f}?`;window.confirm(B)&&m(f)};return e.jsx("div",{className:"edit-modal-overlay",children:e.jsxs("div",{className:"edit-modal",style:{maxWidth:"500px"},children:[e.jsxs("div",{className:"edit-modal-header",style:{background:u==="naik"?"#4CAF50":"#2196F3",color:"white"},children:[e.jsxs("h2",{children:[u==="naik"?"Naik Kelas":"Pindah Kelas"," - ",r.name]}),e.jsx("button",{className:"close-button",onClick:n,children:"×"})]}),e.jsxs("div",{className:"modal-body",style:{padding:"20px"},children:[e.jsx("p",{style:{marginBottom:"15px",fontSize:"16px",color:"#666"},children:u==="naik"?"Pilih kelas tujuan untuk kenaikan kelas:":"Pilih kelas tujuan untuk pindah kelas:"}),e.jsx("div",{className:"class-options",style:{display:"grid",gap:"10px",maxHeight:"300px",overflowY:"auto",padding:"5px"},children:h.map(f=>e.jsxs("button",{onClick:()=>c(f),style:{padding:"12px 15px",border:"1px solid #e0e0e0",borderRadius:"8px",backgroundColor:"#fff",cursor:"pointer",transition:"all 0.2s ease",width:"100%",textAlign:"left",fontSize:"15px",display:"flex",alignItems:"center",gap:"10px"},onMouseOver:B=>{B.target.style.backgroundColor="#f5f5f5",B.target.style.borderColor=u==="naik"?"#4CAF50":"#2196F3"},onMouseOut:B=>{B.target.style.backgroundColor="#fff",B.target.style.borderColor="#e0e0e0"},children:[e.jsx("i",{className:`fas ${u==="naik"?"fa-arrow-up":"fa-exchange-alt"}`,style:{color:u==="naik"?"#4CAF50":"#2196F3"}}),f]},f))})]}),e.jsx("div",{className:"modal-footer",style:{padding:"15px 20px",borderTop:"1px solid #eee",display:"flex",justifyContent:"flex-end",gap:"10px"},children:e.jsx("button",{onClick:n,className:"cancel-button",style:{padding:"8px 20px",borderRadius:"6px",border:"1px solid #ddd",backgroundColor:"white",color:"#666",cursor:"pointer",fontSize:"14px",transition:"all 0.2s ease"},onMouseOver:f=>{f.target.style.backgroundColor="#f5f5f5"},onMouseOut:f=>{f.target.style.backgroundColor="white"},children:"Batal"})})]})})},Le=()=>{const i=W(),[n,r]=l.useState("daftar"),[h,m]=l.useState(""),[u,c]=l.useState("Semua Kelas"),[f,B]=l.useState([]),[y,g]=l.useState({name:"agung",role:"Guru Matematika",school:"SDN Merdeka 01",email:"siti.rahayu@sdnmerdeka01.sch.id",phone:"+62 812-3456-7890",studentCount:0,kelas:[]}),[k,p]=l.useState(!0),[A,L]=l.useState(null),[$,j]=l.useState({isOpen:!1,student:null}),[v,b]=l.useState([]),[d,o]=l.useState([]),[a,N]=l.useState([]),[C,s]=l.useState([]),[M,E]=l.useState({isOpen:!1,studentId:null,studentName:""}),[O,J]=l.useState({isOpen:!1,student:null,notes:[]}),[T,D]=l.useState({isOpen:!1,student:null}),[z,H]=l.useState({isOpen:!1}),[R,q]=l.useState({isOpen:!1,type:null,student:null,availableClasses:[]});l.useEffect(()=>{(async()=>{try{p(!0);const t=localStorage.getItem("isLoggedIn")==="true",w=localStorage.getItem("userRole"),P=localStorage.getItem("userData"),F=P?JSON.parse(P):null;if(!t||w!=="guru"||!F){console.warn("No valid teacher login session found in localStorage"),alert("Sesi login tidak valid. Silakan login kembali."),i("/login");return}console.log("Current user from localStorage:",F),L(F.id_guru),await Y(F.id_guru)}catch(t){console.error("Error loading user data:",t),alert("Terjadi kesalahan saat memuat data pengguna. Menggunakan data contoh."),g(w=>({...w,kelas:["Kelas 1","Kelas 2","Kelas 3"]}))}finally{p(!1)}})()},[i]),l.useEffect(()=>{y.kelas&&y.kelas.length>0&&(console.log("Teacher classes loaded, fetching students:",y.kelas),ee())},[y.kelas]),l.useEffect(()=>{A&&(async()=>{try{const{data:t,error:w}=await K.from("kelas").select("*").eq("id_guru",A);if(w)throw w;b(t||[]);const{data:P,error:F}=await K.from("siswa").select("*");if(F)throw F;B(P||[]);const{data:G,error:U}=await K.from("catatan").select(`
            *,
            siswa_catatan!inner(*)
          `).eq("id_guru",A);if(U)throw U;o(G||[]);const{data:X,error:ge}=await K.from("nilai").select("*");if(ge)throw ge;N(X||[]);const{data:Ve,error:Ie}=await K.from("kemajuan").select("*");if(Ie)throw Ie;s(Ve||[])}catch(t){console.error("Error fetching data:",t),alert("Terjadi kesalahan saat memuat data")}})()},[A]);const Y=async S=>{p(!0);try{const{data:t,error:w}=await K.from("guru").select("*").eq("id_guru",S).single();if(w)throw w;if(t){console.log("Fetched teacher data:",t);let P=[];t.kelas&&(console.log("Raw kelas data:",t.kelas,"Type:",typeof t.kelas),typeof t.kelas=="number"?P=[`Kelas ${t.kelas}`]:typeof t.kelas=="string"&&(P=t.kelas.split(",").map(G=>ae(G.trim())))),P=P.map(G=>ae(G)),P.length===0&&(P=["Kelas 1","Kelas 2","Kelas 3"],console.log("Using default classes as none were found in teacher data")),console.log("Processed teacher classes:",P);let F="Guru Matematika";if(P.length>0)if(P.length===1)F=`Guru Matematika ${P[0]}`;else{const G=P.map(U=>{var X;return(X=U.match(/\d+/))==null?void 0:X[0]}).filter(Boolean).sort((U,X)=>parseInt(U)-parseInt(X));G.length>1&&(F=`Guru Matematika Kelas ${G[0]}-${G[G.length-1]}`)}g({name:t.nama||y.name,role:F,school:"SDN Merdeka 01",email:t.email||y.email,phone:t.no_telp||y.phone,kelas:P,studentCount:0})}}catch(t){console.error("Error fetching teacher data:",t),alert("Error fetching teacher data. Using default profile."),g(w=>({...w,kelas:["Kelas 1","Kelas 2","Kelas 3"]}))}finally{p(!1)}},ee=async()=>{p(!0);try{const{data:S,error:t}=await K.from("siswa").select(`
          *,
          wali:id_wali (
            nama
          )
        `);if(t)throw t;if(!S||S.length===0){console.log("No students found in database"),B([]),g(P=>({...P,studentCount:0}));return}const w=S.map(P=>{const F=P.wali!==null;return{id:P.id_siswa,name:P.nama||"Nama tidak tersedia",class:`Kelas ${P.id_kelas}`||"Kelas tidak tersedia",nis:P.nis,birthDate:P.tanggal_lahir,address:P.alamat,gender:P.Jenis_Kelamin,id_wali:P.id_wali,parent:F?P.wali.nama:"Belum ditautkan",parentStatus:F?"linked":"unlinked",avatar:P.avatar,auth_user_id:P.created_at,created_at:P.created_at,updated_at:P.updated_at}});B(w),g(P=>({...P,studentCount:w.length}))}catch(S){console.error("Error fetching students:",S),alert("Error fetching students data. Using sample data instead."),se()}finally{p(!1)}},se=()=>{const S=[];y.kelas.forEach((t,w)=>{const P=t.replace(/\D/g,""),F=P?6+parseInt(P):7;S.push({id:`sample-${w}-1`,name:`Budi ${P||w+1}`,class:t,age:F,parent:w%2===0?"Andi Wijaya":"Belum ditautkan",parentStatus:w%2===0?"linked":"unlinked",avatar:"/src/assets/laki.png"}),S.push({id:`sample-${w}-2`,name:`Ani ${P||w+1}`,class:t,age:F,parent:w%2===1?"Rina Wijayanti":"Belum ditautkan",parentStatus:w%2===1?"linked":"unlinked",avatar:"/src/assets/perempuan.png"})}),B(S),g(t=>({...t,studentCount:S.length}))},ae=S=>{if(!S)return"";const t=String(S).trim();if(/^\d+$/.test(t))return`Kelas ${t}`;if(/^[kK](elas|ls)?\.?\s*\d+[A-Za-z]?$/.test(t))return`Kelas ${t.match(/\d+[A-Za-z]?/)[0]}`;if(t.toLowerCase().includes("kelas")){const w=t.match(/\d+[A-Za-z]?/);return w?`Kelas ${w[0]}`:t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}return`Kelas ${t}`},Q=async()=>{try{const{error:S}=await K.auth.signOut();if(S)throw S;localStorage.removeItem("isLoggedIn"),localStorage.removeItem("userRole"),localStorage.removeItem("userData"),i("/login")}catch(S){console.error("Error logging out:",S),alert("Error logging out. Please try again.")}},te=()=>{H({isOpen:!1})},re=S=>{const t={id:S.id_siswa,name:S.nama,class:`Kelas ${S.id_kelas}`,nis:S.nis,birthDate:S.tanggal_lahir,address:S.alamat,gender:S.Jenis_Kelamin,id_wali:S.id_wali,parentStatus:S.id_wali?"linked":"unlinked",avatar:S.avatar};B(w=>[...w,t]),g(w=>({...w,studentCount:w.studentCount+1}))},ce=()=>{if(!f)return[];let S=[...f];return h&&(S=S.filter(t=>t.name.toLowerCase().includes(h.toLowerCase()))),u!=="Semua Kelas"&&(S=S.filter(t=>t.class===u)),S},de=(S,t)=>{E({isOpen:!0,studentId:S,studentName:t})},me=S=>{j({isOpen:!0,student:S})},he=()=>{j({isOpen:!1,student:null})},pe=S=>{alert(`Lihat laporan siswa ID: ${S}`)},ue=async S=>{if(confirm("Apakah Anda yakin ingin menghapus siswa ini?"))try{const{error:t}=await K.from("siswa_catatan").delete().eq("id_siswa",S);t&&console.error("Error menghapus catatan siswa:",t);const{error:w}=await K.from("nilai").delete().eq("id_siswa",S);w&&console.error("Error menghapus nilai siswa:",w);const{error:P}=await K.from("kemajuan").delete().eq("id_siswa",S);P&&console.error("Error menghapus data kemajuan siswa:",P);const{error:F}=await K.from("siswa").delete().eq("id_siswa",S);if(F)throw F;B(f.filter(G=>G.id!==S)),g(G=>({...G,studentCount:G.studentCount-1})),alert("Siswa berhasil dihapus")}catch(t){console.error("Error deleting student:",t),alert("Error deleting student: "+t.message)}},Ee=()=>{E({isOpen:!1,studentId:null,studentName:""})},Te=S=>{const t=d.filter(w=>{var P;return((P=w.siswa_catatan[0])==null?void 0:P.id_siswa)===S.id});J({isOpen:!0,student:S,notes:t})},Fe=()=>{J({isOpen:!1,student:null,notes:[]})},Je=async S=>{if(confirm("Apakah Anda yakin ingin menghapus catatan ini?"))try{const{error:t}=await K.from("siswa_catatan").delete().eq("id_catatan",S);if(t)throw t;const{error:w}=await K.from("catatan").delete().eq("id_catatan",S);if(w)throw w;const P=d.filter(F=>F.id_catatan!==S);o(P),J(F=>{if(F.isOpen&&F.student){const G=F.student.id,U=P.filter(X=>X.siswa_catatan&&X.siswa_catatan.length>0&&X.siswa_catatan.some(ge=>ge.id_siswa===G));return{...F,notes:U}}else return F}),alert("Catatan berhasil dihapus!")}catch(t){console.error("Error deleting note:",t),alert("Gagal menghapus catatan: "+t.message)}},ze=async S=>{try{const t=S.class.match(/\d+/)[0];if(parseInt(t)+1>6){alert("Siswa sudah berada di kelas tertinggi");return}const{data:P,error:F}=await K.from("kelas").select("nama_kelas").gt("id_kelas",parseInt(t)).lte("id_kelas",6).order("id_kelas",{ascending:!0});if(F)throw F;if(!P||P.length===0){alert("Tidak ada kelas yang tersedia untuk kenaikan kelas");return}q({isOpen:!0,type:"naik",student:S,availableClasses:P.map(G=>G.nama_kelas)})}catch(t){console.error("Error in handleNaikKelas:",t),alert("Terjadi kesalahan saat memproses kenaikan kelas")}},Ge=async S=>{try{const t=S.class.match(/\d+/)[0],{data:w,error:P}=await K.from("kelas").select("nama_kelas").neq("id_kelas",parseInt(t)).order("id_kelas",{ascending:!0});if(P)throw P;if(!w||w.length===0){alert("Tidak ada kelas lain yang tersedia untuk pemindahan");return}q({isOpen:!0,type:"pindah",student:S,availableClasses:w.map(F=>F.nama_kelas)})}catch(t){console.error("Error in handlePindahKelas:",t),alert("Terjadi kesalahan saat memproses pemindahan kelas")}},He=async S=>{const t=R.student;S.match(/\d+/)[0];try{const{data:w,error:P}=await K.from("kelas").select("id_kelas").eq("nama_kelas",S).single();if(P)throw P;if(!w)throw new Error("Kelas tidak ditemukan");const{error:F}=await K.from("siswa").update({id_kelas:w.id_kelas,updated_at:new Date().toISOString()}).eq("id_siswa",t.id);if(F)throw F;B(f.map(U=>U.id===t.id?{...U,class:S}:U));const G=R.type==="naik"?"dinaikkan ke":"dipindahkan ke";alert(`${t.name} berhasil ${G} ${S}`),q({isOpen:!1,type:null,student:null,availableClasses:[]})}catch(w){console.error("Error dalam mengubah kelas:",w),alert("Gagal mengubah kelas: "+w.message)}},Re=()=>{switch(n){case"daftar":const S=ce();return e.jsxs("div",{className:"student-list",children:[e.jsxs("div",{className:"search-filter-container",children:[e.jsx("div",{className:"search-bar",children:e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx("i",{className:"fas fa-search search-icon"}),e.jsx("input",{type:"text",id:"search-siswa",name:"search-siswa",placeholder:"Cari siswa...",value:h,onChange:t=>m(t.target.value),className:"search-input"})]})}),e.jsx("div",{className:"filter-actions",style:{display:"flex",alignItems:"center",gap:"10px"},children:e.jsxs("div",{className:"filter-dropdown",style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsxs("select",{id:"filter-kelas",name:"filter-kelas",value:u,onChange:t=>c(t.target.value),className:"filter-select",children:[e.jsx("option",{value:"Semua Kelas",children:"Semua Kelas"}),y.kelas&&y.kelas.sort((t,w)=>{var G,U;const P=parseInt(((G=t.match(/\d+/))==null?void 0:G[0])||0),F=parseInt(((U=w.match(/\d+/))==null?void 0:U[0])||0);return P-F}).map((t,w)=>e.jsx("option",{value:t,children:t},w))]}),e.jsxs("button",{className:"filter-button",children:[e.jsx("i",{className:"fas fa-filter"})," Filter"]}),e.jsxs("button",{className:"add-student-button",onClick:()=>H({isOpen:!0}),style:{backgroundColor:"#4CAF50",color:"white",border:"none",padding:"10px 20px",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",height:"40px"},onMouseOver:t=>{t.target.style.backgroundColor="#45a049",t.target.style.transform="translateY(-1px)",t.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.15)"},onMouseOut:t=>{t.target.style.backgroundColor="#4CAF50",t.target.style.transform="translateY(0)",t.target.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)"},children:[e.jsx("i",{className:"fas fa-plus",style:{fontSize:"14px"}}),"Tambah Siswa"]})]})})]})," ",e.jsx("div",{className:"students-container",children:k?e.jsxs("div",{className:"loading",children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Memuat data siswa..."]}):S.length===0?e.jsx("div",{className:"no-students",children:"Tidak ada siswa yang ditemukan"}):S.map(t=>e.jsxs("div",{className:"student-card",children:[e.jsx("div",{className:"student-avatar",children:e.jsx("img",{src:fe(t),alt:`${t.name} avatar`})})," ",e.jsxs("div",{className:"student-info",children:[e.jsx("h3",{children:t.name}),e.jsxs("p",{children:[t.class," | NIS: ",t.nis]}),e.jsxs("p",{className:"parent-info",children:[e.jsx("span",{className:"parent-label",children:"Wali Murid: "}),t.parentStatus==="linked"?e.jsx("span",{className:"linked",children:t.parent}):e.jsx("span",{className:"unlinked",children:"Belum ditautkan"})]})]})," ","                    ",e.jsxs("div",{className:"student-actions",children:[e.jsxs("button",{className:"action-button edit",onClick:()=>We(t),children:[e.jsx("i",{className:"fas fa-edit"})," Edit"]}),e.jsx("button",{className:"action-button tugas",onClick:()=>me(t),children:"Riwayat"}),e.jsx("button",{className:"action-button hapus",onClick:()=>ue(t.id),children:"Hapus"})]})]},t.id))})," ",e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:"pagination-prev",children:"<"}),e.jsx("button",{className:"pagination-number active",children:"1"}),e.jsx("button",{className:"pagination-number",children:"2"}),e.jsx("button",{className:"pagination-number",children:"3"}),e.jsx("button",{className:"pagination-next",children:">"})]})]});case"kelas":return e.jsxs("div",{className:"student-list",children:[e.jsxs("div",{className:"search-filter-container",children:[e.jsx("div",{className:"search-bar",children:e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx("i",{className:"fas fa-search search-icon"}),e.jsx("input",{type:"text",placeholder:"Cari siswa...",value:h,onChange:t=>m(t.target.value),className:"search-input"})]})}),e.jsxs("div",{className:"filter-dropdown",children:[e.jsxs("select",{value:u,onChange:t=>c(t.target.value),className:"filter-select",children:[e.jsx("option",{value:"Semua Kelas",children:"Semua Kelas"}),y.kelas&&y.kelas.sort((t,w)=>{var G,U;const P=parseInt(((G=t.match(/\d+/))==null?void 0:G[0])||0),F=parseInt(((U=w.match(/\d+/))==null?void 0:U[0])||0);return P-F}).map((t,w)=>e.jsx("option",{value:t,children:t},w))]}),e.jsxs("button",{className:"filter-button",children:[e.jsx("i",{className:"fas fa-filter"})," Filter"]})]})]}),e.jsx("div",{className:"students-container",children:k?e.jsxs("div",{className:"loading",children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Memuat data siswa..."]}):f.filter(t=>(u==="Semua Kelas"||t.class===u)&&(h===""||t.name.toLowerCase().includes(h.toLowerCase()))).length===0?e.jsx("div",{className:"no-students",children:"Tidak ada siswa yang ditemukan"}):f.filter(t=>(u==="Semua Kelas"||t.class===u)&&(h===""||t.name.toLowerCase().includes(h.toLowerCase()))).map(t=>e.jsxs("div",{className:"student-card",children:[e.jsx("div",{className:"student-avatar",children:e.jsx("img",{src:fe(t),alt:`${t.name} avatar`})}),e.jsxs("div",{className:"student-info",children:[e.jsx("h3",{children:t.name}),e.jsxs("p",{children:[t.class," | NIS: ",t.nis]}),e.jsxs("p",{className:"parent-info",children:[e.jsx("span",{className:"parent-label",children:"Wali Murid: "}),t.parentStatus==="linked"?e.jsx("span",{className:"linked",children:t.parent}):e.jsx("span",{className:"unlinked",children:"Belum ditautkan"})]})]}),e.jsxs("div",{className:"student-actions",children:[e.jsxs("button",{className:"action-button naik-kelas",onClick:()=>ze(t),style:{backgroundColor:"#4CAF50",color:"white",border:"none",padding:"6px 12px",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"6px",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",marginRight:"8px"},onMouseOver:w=>{w.target.style.backgroundColor="#45a049",w.target.style.transform="translateY(-1px)",w.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.15)"},onMouseOut:w=>{w.target.style.backgroundColor="#4CAF50",w.target.style.transform="translateY(0)",w.target.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)"},children:[e.jsx("i",{className:"fas fa-arrow-up",style:{fontSize:"12px"}}),"Naik Kelas"]}),e.jsxs("button",{className:"action-button pindah-kelas",onClick:()=>Ge(t),style:{backgroundColor:"#2196F3",color:"white",border:"none",padding:"6px 12px",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"6px",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},onMouseOver:w=>{w.target.style.backgroundColor="#1976D2",w.target.style.transform="translateY(-1px)",w.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.15)"},onMouseOut:w=>{w.target.style.backgroundColor="#2196F3",w.target.style.transform="translateY(0)",w.target.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)"},children:[e.jsx("i",{className:"fas fa-exchange-alt",style:{fontSize:"12px"}}),"Pindah Kelas"]})]})]},t.id))})]});case"catatan":return e.jsxs("div",{className:"student-list",children:[e.jsxs("div",{className:"search-filter-container",children:[e.jsx("div",{className:"search-bar",children:e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx("i",{className:"fas fa-search search-icon"}),e.jsx("input",{type:"text",placeholder:"Cari siswa...",value:h,onChange:t=>m(t.target.value),className:"search-input"})]})}),e.jsxs("div",{className:"filter-dropdown",children:[e.jsxs("select",{value:u,onChange:t=>c(t.target.value),className:"filter-select",children:[e.jsx("option",{value:"Semua Kelas",children:"Semua Kelas"}),y.kelas&&y.kelas.sort((t,w)=>{var G,U;const P=parseInt(((G=t.match(/\d+/))==null?void 0:G[0])||0),F=parseInt(((U=w.match(/\d+/))==null?void 0:U[0])||0);return P-F}).map((t,w)=>e.jsx("option",{value:t,children:t},w))]}),e.jsxs("button",{className:"filter-button",children:[e.jsx("i",{className:"fas fa-filter"})," Filter"]})]})]}),e.jsx("div",{className:"students-container",children:k?e.jsxs("div",{className:"loading",children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Memuat data siswa..."]}):f.filter(t=>(u==="Semua Kelas"||t.class===u)&&(h===""||t.name.toLowerCase().includes(h.toLowerCase()))).length===0?e.jsx("div",{className:"no-students",children:"Tidak ada siswa yang ditemukan"}):f.filter(t=>(u==="Semua Kelas"||t.class===u)&&(h===""||t.name.toLowerCase().includes(h.toLowerCase()))).map(t=>e.jsxs("div",{className:"student-card",children:[e.jsx("div",{className:"student-avatar",children:e.jsx("img",{src:fe(t),alt:`${t.name} avatar`})}),e.jsxs("div",{className:"student-info",children:[e.jsx("h3",{children:t.name}),e.jsxs("p",{children:[t.class," | NIS: ",t.nis]}),e.jsxs("p",{className:"parent-info",children:[e.jsx("span",{className:"parent-label",children:"Wali Murid: "}),t.parentStatus==="linked"?e.jsx("span",{className:"linked",children:t.parent}):e.jsx("span",{className:"unlinked",children:"Belum ditautkan"})]})]}),e.jsxs("div",{className:"student-actions",children:[e.jsxs("button",{className:"action-button catatan",onClick:()=>de(t.id,t.name),children:[e.jsx("i",{className:"fas fa-comment-alt"})," Kirim Catatan"]}),e.jsxs("button",{className:"action-button lihat-catatan",onClick:()=>Te(t),children:[e.jsx("i",{className:"fas fa-eye"})," Lihat Catatan"]})]})]},t.id))})]});case"laporan":return e.jsxs("div",{className:"reports",children:[e.jsx("h2",{children:"Laporan"}),e.jsx("div",{className:"report-filters",children:e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Pilih Kelas:"}),e.jsx("select",{value:u||"",onChange:t=>c(parseInt(t.target.value)),children:v.map(t=>e.jsx("option",{value:t.id_kelas,children:t.nama_kelas},t.id_kelas))})]})}),u&&e.jsxs("div",{className:"report-content",children:[e.jsxs("div",{className:"class-summary",children:[e.jsx("h3",{children:"Ringkasan Kelas"}),e.jsxs("div",{className:"summary-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Total Siswa:"}),e.jsx("span",{className:"stat-value",children:f.filter(t=>t.id_kelas===u).length})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Rata-rata Nilai:"}),e.jsx("span",{className:"stat-value",children:calculateClassAverage(u)})]})]})]}),e.jsxs("div",{className:"student-reports",children:[e.jsx("h3",{children:"Laporan Per Siswa"}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nama Siswa"}),e.jsx("th",{children:"Rata-rata Nilai"}),e.jsx("th",{children:"Kemajuan"}),e.jsx("th",{children:"Aksi"})]})}),e.jsx("tbody",{children:f.filter(t=>t.id_kelas===u).map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.nama}),e.jsx("td",{children:calculateStudentAverage(t.id_siswa)}),e.jsx("td",{children:getStudentProgress(t.id_siswa)}),e.jsx("td",{children:e.jsxs("button",{onClick:()=>pe(t.id_siswa),children:[e.jsx("i",{className:"fas fa-file-alt"})," Detail"]})})]},t.id_siswa))})]})]})]})]});default:return e.jsx("div",{children:"No content available"})}},fe=S=>{const t={Anjing:"/src/assets/anjing.png",Babi:"/src/assets/babi.png",Bebek:"/src/assets/bebek.png",Gurita:"/src/assets/gurita.png",Harimau:"/src/assets/harimau.png",Kelinci:"/src/assets/kelinci.png",Kucing:"/src/assets/kucing.png",Sapi:"/src/assets/sapi.png",Serigala:"/src/assets/serigala.png",Singa:"/src/assets/singa.png"};return S!=null&&S.avatar&&t[S.avatar]?t[S.avatar]:(S==null?void 0:S.gender)==="P"?"/src/assets/perempuan.png":"/src/assets/laki.png"},Ue=()=>{ee()},qe=()=>{D({isOpen:!1,student:null})},We=S=>{D({isOpen:!0,student:S})};return e.jsxs("div",{className:"guru-dashboard",children:[" "," ",e.jsxs("header",{className:"header-guru",children:[e.jsxs("div",{className:"logo",children:[e.jsx("i",{className:"fas fa-chalkboard-teacher logo-icon"}),e.jsx("h1",{children:"Math Fun - Dashboard Guru"})]}),e.jsxs("div",{className:"header-actions",children:[e.jsxs("button",{className:"user-mode-button",children:[e.jsx("i",{className:"fas fa-user-friends icon-margin"})," Mode Orang Tua"]}),"x",e.jsxs("button",{className:"logout-button",onClick:Q,children:[e.jsx("i",{className:"fas fa-sign-out-alt icon-margin"})," Logout"]})]})]})," "," ",e.jsxs("div",{className:"profile-container",children:[e.jsx("div",{className:"profile-avatar",children:e.jsx("img",{src:"/src/assets/icon_guru.png",alt:"Profile"})}),e.jsx("div",{className:"profile-info",children:k?e.jsxs("div",{className:"loading-profile",children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Memuat data guru..."]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:y.name}),e.jsxs("p",{children:[y.role," - ",y.school]}),e.jsxs("div",{className:"contact-info",children:[e.jsxs("a",{href:`mailto:${y.email}`,className:"email-link",children:[e.jsx("i",{className:"fas fa-envelope"})," ",y.email]}),e.jsxs("a",{href:`tel:${y.phone}`,className:"phone-link",children:[e.jsx("i",{className:"fas fa-phone"})," ",y.phone]}),e.jsxs("span",{className:"student-count",children:[e.jsx("i",{className:"fas fa-user-graduate"})," ",y.studentCount," Siswa"]})]})]})}),e.jsxs("button",{className:"edit-profile-button",children:[e.jsx("i",{className:"fas fa-edit"})," Edit Profil"]})]})," "," ",e.jsxs("nav",{className:"tabs-nav",children:[e.jsxs("button",{className:`tab-button ${n==="daftar"?"active":""}`,onClick:()=>r("daftar"),children:[e.jsx("i",{className:"fas fa-users tab-icon"})," Kelola Siswa"]}),e.jsxs("button",{className:`tab-button ${n==="kelas"?"active":""}`,onClick:()=>r("kelas"),children:[e.jsx("i",{className:"fas fa-chalkboard tab-icon"})," Kelola Kelas"]}),e.jsxs("button",{className:`tab-button ${n==="materi"?"active":""}`,onClick:()=>r("materi"),children:[e.jsx("i",{className:"fas fa-chalkboard tab-icon"})," Kelola Materi"]}),e.jsxs("button",{className:`tab-button ${n==="catatan"?"active":""}`,onClick:()=>r("catatan"),children:[e.jsx("i",{className:"fas fa-comment-alt tab-icon"})," Kirim Catatan"]}),e.jsxs("button",{className:`tab-button ${n==="laporan"?"active":""}`,onClick:()=>r("laporan"),children:[e.jsx("i",{className:"fas fa-chart-bar tab-icon"})," Laporan"]}),"      "]}),e.jsx("div",{className:"tab-content",children:Re()}),e.jsx(hs,{isOpen:$.isOpen,onClose:he,student:$.student}),e.jsx(ps,{isOpen:M.isOpen,onClose:Ee,studentId:M.studentId,teacherId:A,studentName:M.studentName}),e.jsx(us,{isOpen:O.isOpen,onClose:Fe,student:O.student,notes:O.notes,onDeleteNote:Je}),e.jsx(gs,{isOpen:T.isOpen,onClose:qe,student:T.student,onUpdate:Ue}),e.jsx(xs,{isOpen:z.isOpen,onClose:te,onAdd:re}),e.jsx(js,{isOpen:R.isOpen,onClose:()=>q({isOpen:!1,type:null,student:null,availableClasses:[]}),student:R.student,availableClasses:R.availableClasses,onConfirm:He,type:R.type})]})},Ae="/RubimathV1.8/assets/bronze-C06y5rVm.PNG",De="/RubimathV1.8/assets/silver-ByBpWjuQ.PNG",Ke="/RubimathV1.8/assets/gold-B99uM-3Z.PNG",Oe="/RubimathV1.8/assets/mainsiswa-CNgKkMeZ.jpg",ie=[{title:"Bab 1",levels:["Level 1"]},{title:"Bab 2",levels:["Level 1"]},{title:"Bab 3",levels:["Level 1"]},{title:"Bab 4",levels:["Level 1"]},{title:"Bab 5",levels:["Level 1"]},{title:"Bab 6",levels:["Level 1"]}];function vs(){const[i,n]=l.useState(null),[r,h]=l.useState(0),[m,u]=l.useState(Array(ie.length).fill(0)),[c,f]=l.useState(null),[B,y]=l.useState({completedLevels:0}),[g,k]=l.useState({}),p=W();l.useEffect(()=>{if(console.log("MainSiswa2 mounted"),document.body.style.backgroundColor="#ffffff",document.body.style.color="#333333",!(localStorage.getItem("isLoggedIn")==="true")){p("/login");return}const o=localStorage.getItem("userData"),a=o?JSON.parse(o):null,N=localStorage.getItem("selectedAvatar");if(N){const C=JSON.parse(N);f({...C,displayName:(a==null?void 0:a.nama)||C.name});const s=`avatar_${C.name}_levelScores`;JSON.parse(localStorage.getItem(s));let M=0;const E=Array(ie.length).fill(0);u(E),y({completedLevels:M}),k({});const O=E.reduce((T,D)=>T+D,0)/ie.length;h(O);const J=`avatar_${C.name}_chapterProgress`;localStorage.setItem(J,JSON.stringify(E))}else{const C=JSON.parse(localStorage.getItem("chapterProgress"))||Array(ie.length).fill(0);u(C);const s=C.reduce((M,E)=>M+E,0)/ie.length;h(s)}},[p]);const A=d=>{d===0?(localStorage.setItem("currentBabIndex",0),localStorage.setItem("currentLevelIndex",0),p("/category2_bab1")):d===1?(localStorage.setItem("currentBabIndex",1),localStorage.setItem("currentLevelIndex",0),p("/category2_bab2")):d===2?(localStorage.setItem("currentBabIndex",2),localStorage.setItem("currentLevelIndex",0),p("/category2_bab3")):d===3?(localStorage.setItem("currentBabIndex",3),localStorage.setItem("currentLevelIndex",0),p("/category2_bab4")):d===4?(localStorage.setItem("currentBabIndex",4),localStorage.setItem("currentLevelIndex",0),p("/category2_bab5")):d===5?(localStorage.setItem("currentBabIndex",5),localStorage.setItem("currentLevelIndex",0),p("/category2_bab6")):n(d)},L=(d,o)=>{localStorage.setItem("currentBabIndex",d),localStorage.setItem("currentLevelIndex",o),p(`/category?chapter=${d}&level=${o}`)},$=()=>{n(null)},j=()=>{localStorage.removeItem("isLoggedIn"),p("/login")},v=()=>{p("/skor")},b=(d,o)=>{if(!c)return!1;const a=`bab${d}_level${o}`;return g[a]&&g[a].length>0};return e.jsxs("div",{className:"main-siswa-container",style:{color:"#333333",backgroundImage:`url(${Oe})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",position:"relative"},children:[e.jsxs("header",{className:"header-siswa",style:{position:"relative",zIndex:1},children:[" ",e.jsx(x.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},style:{color:"#ff5722",textShadow:"2px 2px 4px rgba(0,0,0,0.5)"},children:"Game Matematika Siswa"}),e.jsxs("div",{className:"profile-section",children:[e.jsx("div",{className:"profile-icon",children:c?e.jsx("img",{src:c.src,alt:c.displayName||c.name,className:"avatar-image"}):"👤"}),e.jsxs("div",{className:"profile-actions",children:[e.jsx("button",{onClick:v,className:"score-button",children:"Lihat Progres"}),e.jsx("button",{onClick:j,className:"logout-button",children:"Keluar"})," "]})]})]}),e.jsxs("div",{className:"progress-container",style:{position:"relative",zIndex:1,backgroundColor:"transparent",padding:"15px"},children:[e.jsxs("div",{className:"progress-info",style:{color:"white"},children:[e.jsxs("p",{children:["Progress"," ",e.jsx("strong",{children:c?c.displayName:"Siswa"}),":"," ",Math.round(r),"%"]}),e.jsxs("p",{children:["Level Selesai: ",e.jsx("strong",{children:B.completedLevels})," dari 9"]})]}),e.jsxs("div",{className:"progress-bar",style:{position:"relative",marginBottom:"20px",width:"90%",margin:"0 auto 30px auto",height:"15px"},children:[" ",e.jsx("div",{style:{position:"absolute",left:"30%",top:-2,bottom:-2,width:"3px",backgroundColor:"#ff5722"}}),e.jsx("div",{style:{position:"absolute",left:"60%",top:-2,bottom:-2,width:"3px",backgroundColor:"#ff5722"}}),e.jsx("div",{style:{position:"absolute",right:"0",top:-2,bottom:-2,width:"3px",backgroundColor:"#ff5722"}}),e.jsx(x.div,{className:"progress",style:{width:`${r}%`},initial:{width:0},animate:{width:`${r}%`},transition:{duration:.8}})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"30px",position:"relative",padding:"0",height:"70px",width:"90%",margin:"0 auto",overflow:"visible"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",position:"absolute",left:"30%",transform:"translateX(-50%)"},children:[" ",e.jsx("img",{src:Ae,alt:"Bronze Badge",style:{width:"60px",height:"60px",marginRight:"10px",opacity:r>=30?"1":"0.4",filter:r>=30?"none":"grayscale(80%)",transition:"all 0.3s ease"}}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontWeight:"bold",fontSize:"0.9rem",textAlign:"left",opacity:r>=30?"1":"0.6"},children:"Bronze"}),e.jsx("p",{style:{margin:"2px 0 0 0",fontSize:"0.8rem",textAlign:"left",color:r>=30?"#ff5722":"#999999"},children:"30%"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",position:"absolute",left:"60%",transform:"translateX(-50%)"},children:[" ",e.jsx("img",{src:De,alt:"Silver Badge",style:{width:"60px",height:"60px",marginRight:"10px",opacity:r>=60?"1":"0.4",filter:r>=60?"none":"grayscale(80%)",transition:"all 0.3s ease"}}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontWeight:"bold",fontSize:"0.9rem",textAlign:"left",opacity:r>=60?"1":"0.6"},children:"Silver"}),e.jsx("p",{style:{margin:"2px 0 0 0",fontSize:"0.8rem",textAlign:"left",color:r>=60?"#ff5722":"#999999"},children:"60%"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",position:"absolute",left:"calc(100% - 2px)",transform:"translateX(-50%)"},children:[" ",e.jsx("img",{src:Ke,alt:"Gold Badge",style:{width:"60px",height:"60px",marginRight:"10px",opacity:r>=100?"1":"0.4",filter:r>=100?"none":"grayscale(80%)",transition:"all 0.3s ease"}}),e.jsxs("div",{style:{whiteSpace:"nowrap"},children:[e.jsx("p",{style:{margin:0,fontWeight:"bold",fontSize:"0.9rem",textAlign:"left",opacity:r>=100?"1":"0.6"},children:"Gold"}),e.jsx("p",{style:{margin:"2px 0 0 0",fontSize:"0.8rem",textAlign:"left",color:r>=100?"#ff5722":"#999999"},children:"100%"})]})]})]})]}),e.jsx("div",{className:"chapter-buttons",style:{position:"relative",zIndex:1},children:ie.map((d,o)=>e.jsx(x.button,{className:"big-chapter-button",onClick:()=>A(o),initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.2*o},style:{backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white",textShadow:"1px 1px 2px black",padding:"25px 15px 15px",fontSize:"1.5rem",fontWeight:"bold",display:"flex",flexDirection:"column",alignItems:"center"},children:d.title},o))})," ",i!==null&&i!==0&&e.jsx("div",{className:"popup-overlay",style:{zIndex:10,backgroundColor:"rgba(0, 0, 0, 0.7)"},children:e.jsxs(x.div,{className:"popup",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},style:{backgroundColor:"rgba(0, 0, 0, 0.8)",border:"2px solid #ff5722",color:"white"},children:[" ",e.jsx("h2",{children:ie[i].title}),e.jsx("div",{className:"levels",children:ie[i].levels.map((d,o)=>e.jsx("div",{className:"level-container",children:e.jsx("button",{className:`level-button ${b(i,o)?"level-completed":""}`,onClick:()=>L(i,o),children:d})},o))}),e.jsx("button",{className:"close-popup-button",onClick:$,children:"✖ Kembali ke Menu"})]})})]})}const ne=[{title:"Bab 1",levels:["Level 1"]},{title:"Bab 2",levels:["Level 1"]},{title:"Bab 3",levels:["Level 1"]},{title:"Bab 4",levels:["Level 1"]},{title:"Bab 5",levels:["Level 1"]},{title:"Bab 6",levels:["Level 1"]}];function bs(){const[i,n]=l.useState(null),[r,h]=l.useState(0),[m,u]=l.useState(Array(ne.length).fill(0)),[c,f]=l.useState(null),[B,y]=l.useState({completedLevels:0}),[g,k]=l.useState({}),p=W();l.useEffect(()=>{if(console.log("MainSiswa4 mounted"),document.body.style.backgroundColor="#ffffff",document.body.style.color="#333333",!(localStorage.getItem("isLoggedIn")==="true")){p("/login");return}const o=localStorage.getItem("userData"),a=o?JSON.parse(o):null;if(a&&a.nama)f({name:a.nama});else{console.warn("No user data found in localStorage"),p("/login");return}const N=localStorage.getItem("selectedAvatar");if(N){const C=JSON.parse(N);f({...C,displayName:a.nama});const s=`avatar_${C.name}_levelScores`;JSON.parse(localStorage.getItem(s));let M=0;const E=Array(ne.length).fill(0);u(E),y({completedLevels:M}),k({});const O=E.reduce((T,D)=>T+D,0)/ne.length;h(O);const J=`avatar_${C.name}_chapterProgress`;localStorage.setItem(J,JSON.stringify(E))}else{const C=JSON.parse(localStorage.getItem("chapterProgress"))||Array(ne.length).fill(0);u(C);const s=C.reduce((M,E)=>M+E,0)/ne.length;h(s)}},[p]);const A=d=>{d===0?(localStorage.setItem("currentBabIndex",0),localStorage.setItem("currentLevelIndex",0),p("/category4_bab1")):d===1?(localStorage.setItem("currentBabIndex",1),localStorage.setItem("currentLevelIndex",0),p("/category4_bab2")):d===2?(localStorage.setItem("currentBabIndex",2),localStorage.setItem("currentLevelIndex",0),p("/category4_bab3")):d===3?(localStorage.setItem("currentBabIndex",3),localStorage.setItem("currentLevelIndex",0),p("/category4_bab4")):d===4?(localStorage.setItem("currentBabIndex",4),localStorage.setItem("currentLevelIndex",0),p("/category4_bab5")):d===5?(localStorage.setItem("currentBabIndex",5),localStorage.setItem("currentLevelIndex",0),p("/category4_bab6")):n(d)},L=(d,o)=>{localStorage.setItem("currentBabIndex",d),localStorage.setItem("currentLevelIndex",o),p(`/category?chapter=${d}&level=${o}`)},$=()=>{n(null)},j=()=>{localStorage.removeItem("isLoggedIn"),p("/login")},v=()=>{p("/skor")},b=(d,o)=>{if(!c)return!1;const a=`bab${d}_level${o}`;return g[a]&&g[a].length>0};return e.jsxs("div",{className:"main-siswa-container",style:{color:"#333333",backgroundImage:`url(${Oe})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",position:"relative"},children:[e.jsxs("header",{className:"header-siswa",style:{position:"relative",zIndex:1},children:["        ",e.jsx(x.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},style:{color:"#ff5722",textShadow:"2px 2px 4px rgba(0,0,0,0.5)"},children:"Game Matematika Siswa"}),e.jsxs("div",{className:"profile-section",children:[e.jsx("div",{className:"profile-icon",children:c?e.jsx("img",{src:c.src,alt:c.displayName||c.name,className:"avatar-image"}):"👤"}),e.jsxs("div",{className:"profile-actions",children:[e.jsx("button",{onClick:v,className:"score-button",children:"Lihat Progres"}),e.jsx("button",{onClick:j,className:"logout-button",children:"Keluar"}),"          "]})]})]}),e.jsxs("div",{className:"progress-container",style:{position:"relative",zIndex:1,backgroundColor:"transparent",padding:"15px"},children:[e.jsxs("div",{className:"progress-info",style:{color:"white"},children:[e.jsxs("p",{children:["Progress"," ",e.jsx("strong",{children:c?c.displayName:"Siswa"}),":"," ",Math.round(r),"%"]}),e.jsxs("p",{children:["Level Selesai: ",e.jsx("strong",{children:B.completedLevels})," dari 9"]})]}),e.jsxs("div",{className:"progress-bar",style:{position:"relative",marginBottom:"20px",width:"90%",margin:"0 auto 30px auto",height:"15px"},children:["          ",e.jsx("div",{style:{position:"absolute",left:"30%",top:-2,bottom:-2,width:"3px",backgroundColor:"#ff5722"}}),e.jsx("div",{style:{position:"absolute",left:"60%",top:-2,bottom:-2,width:"3px",backgroundColor:"#ff5722"}}),e.jsx("div",{style:{position:"absolute",right:"0",top:-2,bottom:-2,width:"3px",backgroundColor:"#ff5722"}}),e.jsx(x.div,{className:"progress",style:{width:`${r}%`},initial:{width:0},animate:{width:`${r}%`},transition:{duration:.8}})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"30px",position:"relative",padding:"0",height:"70px",width:"90%",margin:"0 auto",overflow:"visible"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",position:"absolute",left:"30%",transform:"translateX(-50%)"},children:["            ",e.jsx("img",{src:Ae,alt:"Bronze Badge",style:{width:"60px",height:"60px",marginRight:"10px",opacity:r>=30?"1":"0.4",filter:r>=30?"none":"grayscale(80%)",transition:"all 0.3s ease"}}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontWeight:"bold",fontSize:"0.9rem",textAlign:"left",opacity:r>=30?"1":"0.6"},children:"Bronze"}),e.jsx("p",{style:{margin:"2px 0 0 0",fontSize:"0.8rem",textAlign:"left",color:r>=30?"#ff5722":"#999999"},children:"30%"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",position:"absolute",left:"60%",transform:"translateX(-50%)"},children:["            ",e.jsx("img",{src:De,alt:"Silver Badge",style:{width:"60px",height:"60px",marginRight:"10px",opacity:r>=60?"1":"0.4",filter:r>=60?"none":"grayscale(80%)",transition:"all 0.3s ease"}}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontWeight:"bold",fontSize:"0.9rem",textAlign:"left",opacity:r>=60?"1":"0.6"},children:"Silver"}),e.jsx("p",{style:{margin:"2px 0 0 0",fontSize:"0.8rem",textAlign:"left",color:r>=60?"#ff5722":"#999999"},children:"60%"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",position:"absolute",left:"calc(100% - 2px)",transform:"translateX(-50%)"},children:["              ",e.jsx("img",{src:Ke,alt:"Gold Badge",style:{width:"60px",height:"60px",marginRight:"10px",opacity:r>=100?"1":"0.4",filter:r>=100?"none":"grayscale(80%)",transition:"all 0.3s ease"}}),e.jsxs("div",{style:{whiteSpace:"nowrap"},children:[e.jsx("p",{style:{margin:0,fontWeight:"bold",fontSize:"0.9rem",textAlign:"left",opacity:r>=100?"1":"0.6"},children:"Gold"}),e.jsx("p",{style:{margin:"2px 0 0 0",fontSize:"0.8rem",textAlign:"left",color:r>=100?"#ff5722":"#999999"},children:"100%"})]})]})]})]}),e.jsx("div",{className:"chapter-buttons",style:{position:"relative",zIndex:1},children:ne.map((d,o)=>e.jsx(x.button,{className:"big-chapter-button",onClick:()=>A(o),initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.2*o},style:{backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white",textShadow:"1px 1px 2px black",padding:"25px 15px 15px",fontSize:"1.5rem",fontWeight:"bold",display:"flex",flexDirection:"column",alignItems:"center"},children:d.title},o))}),"      ",i!==null&&i!==0&&e.jsx("div",{className:"popup-overlay",style:{zIndex:10,backgroundColor:"rgba(0, 0, 0, 0.7)"},children:e.jsxs(x.div,{className:"popup",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},style:{backgroundColor:"rgba(0, 0, 0, 0.8)",border:"2px solid #ff5722",color:"white"},children:["            ",e.jsx("h2",{children:ne[i].title}),e.jsx("div",{className:"levels",children:ne[i].levels.map((d,o)=>e.jsx("div",{className:"level-container",children:e.jsx("button",{className:`level-button ${b(i,o)?"level-completed":""}`,onClick:()=>L(i,o),children:d})},o))}),e.jsx("button",{className:"close-popup-button",onClick:$,children:"✖ Kembali ke Menu"})]})})]})}const ve=[{id:1,title:"Level 1",description:"Pengenalan Dasar",icon:"🔢",color:"#FF6B6B",gradient:"linear-gradient(135deg, #FF6B6B, #FF8E8E)",subChapters:[{id:1,title:"Cara Membaca dan Menulis Bilangan Cacah",icon:"📘"},{id:2,title:"Cara Membandingkan dan Mengurutkan Bilangan Cacah Sampai 10.000",icon:"🔢"}],games:[{id:1,title:"Petualangan Bilangan Cacah",path:"/game/kelas4/bab1/level1",icon:"🔢"}]},{id:2,title:"Level 2",description:"Operasi Dasar",icon:"🧮",color:"#4ECDC4",gradient:"linear-gradient(135deg, #4ECDC4, #7EE8FA)",subChapters:[{id:3,title:"Komposisi Bilangan Cacah Sampai 10.000",icon:"➕"},{id:4,title:"Pengurangan Bilangan Cacah Sampai 1.000",icon:"➖"}],games:[{id:2,title:"Tantangan Komposisi & Pengurangan",path:"/game/kelas4/bab1/level2",icon:"🧮"}]},{id:3,title:"Level 3",description:"Geometri Dasar",icon:"📐",color:"#FFD166",gradient:"linear-gradient(135deg, #FFD166, #FFF3B0)",subChapters:[{id:5,title:"Perkalian Bilangan Cacah Sampai 1.000",icon:"✖️"},{id:6,title:"Pembagian Bilangan Cacah Sampai 1.000",icon:"➗"}],games:[{id:5,title:"Latihan Perkalian Dan Pembagian",path:"/game/kelas4/bab1/level3",icon:"🧩"}]},{id:4,title:"Level 4",description:"Bangun Ruang",icon:"🧊",color:"#6A0572",gradient:"linear-gradient(135deg, #6A0572, #AB83A1)",subChapters:[{id:7,title:"Faktor Kelipatan",icon:"🧊"},{id:8,title:"Evaluasi",icon:"📦"}],games:[{id:7,title:"Ayo Latihan!",path:"/game/kelas4/bab1/level4",icon:"🎲"}],locked:!1}];function fs(){const i=W(),[n,r]=l.useState(null),[h,m]=l.useState(!1),[u,c]=l.useState({}),[f,B]=l.useState([]),[y,g]=l.useState(!1),[k,p]=l.useState(!1),A=l.useRef(null),L=Array.from({length:50},(s,M)=>({id:M,size:Math.random()*3+1,left:Math.random()*100,top:Math.random()*100,delay:Math.random()*5,duration:Math.random()*3+2})),$=Array.from({length:6},(s,M)=>({id:M,size:Math.random()*150+100,left:Math.random()*100,top:Math.random()*20+10,speed:Math.random()*100+50,delay:Math.random()*20}));l.useEffect(()=>{if(!(localStorage.getItem("isLoggedIn")==="true")){i("/login");return}const M=JSON.parse(localStorage.getItem("selectedAvatar"));if(M){const O=`avatar_${M.name}_bab1_levels_progress`,J=JSON.parse(localStorage.getItem(O))||{};c(J);const T=ve.filter(D=>{var z;return!D.locked&&((z=J[`level_${D.id}`])==null?void 0:z.completed)}).map(D=>D.id);B(T)}const E=setTimeout(()=>{p(!0)},3e3);return()=>clearTimeout(E)},[i]);const j=()=>{$e({particleCount:100,spread:70,origin:{y:.6}})},v=s=>{if(s.locked){alert("Level ini terkunci! Selesaikan level sebelumnya terlebih dahulu.");return}g(!0),f.includes(s.id)&&j(),r(s),m(!0),p(!1)},b=()=>{const s=ve.find(M=>M.id===1);s&&(r(s),m(!0),p(!1),g(!0),f.includes(1)&&j())},d=()=>{m(!1),setTimeout(()=>{r(null),g(!1)},300)},o=s=>{i(`/materi/materikelas4/materiBab1_${s.id}`)},a=s=>{i(s.path)},N=()=>{g(!0),setTimeout(()=>{i("/kelas4")},500)},C=s=>f.includes(s);return e.jsxs("div",{className:`category-container ${y?"animate-bg":""}`,children:[e.jsxs("div",{className:"background-elements",children:[L.map(s=>e.jsx("div",{className:"star",style:{width:s.size+"px",height:s.size+"px",left:s.left+"%",top:s.top+"%",animationDelay:s.delay+"s",animationDuration:s.duration+"s"}},`star-${s.id}`)),$.map(s=>e.jsx("div",{className:"cloud",style:{width:s.size+"px",height:s.size/2+"px",left:s.left+"%",top:s.top+"%",animationDuration:s.speed+"s",animationDelay:s.delay+"s"}},`cloud-${s.id}`))]}),e.jsxs("header",{className:"header animated-header",children:[e.jsxs(x.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:["BAB 1 ",e.jsx("span",{className:"wave",children:"🎓"})]}),e.jsx(x.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3,duration:.6},className:"header-tagline",children:"Pilih level untuk memulai petualangan belajarmu!"})]}),e.jsxs("section",{className:"categories-section",children:[e.jsxs(x.h2,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.7},children:[e.jsx("span",{className:"category-icon",children:"🚀"})," Pilih Level"]}),e.jsx(x.button,{className:"back-button",onClick:N,whileHover:{scale:1.05},whileTap:{scale:.95},initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},children:"Kembali"}),e.jsx(V,{children:k&&e.jsxs(x.div,{className:"hint-bubble",initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8},children:[e.jsx("div",{className:"hint-arrow"}),e.jsx("p",{children:"Klik kartu level untuk mulai belajar!"})]})}),e.jsx("div",{className:"level-path",children:ve.map((s,M)=>e.jsxs(le.Fragment,{children:[M>0&&e.jsx("div",{className:`path-connector ${f.includes(s.id-1)?"completed-path":""}`,children:f.includes(s.id-1)&&e.jsx("div",{className:"path-progress-animation"})}),e.jsx("div",{className:`path-node ${C(s.id)?"completed-node":""} ${s.locked?"locked-node":""}`,children:s.id})]},`path-${s.id}`))}),e.jsx("div",{className:"level-grid",children:ve.map(s=>e.jsxs(x.div,{className:`level-card ${s.locked?"level-locked":""} ${s.id===1?"level1-card":""}`,onClick:()=>s.id===1?b():v(s),whileHover:s.locked?{}:{scale:1.05,y:-5},whileTap:s.locked?{}:{scale:.95},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*s.id},style:{boxShadow:s.id===1?"0 8px 25px rgba(255, 107, 107, 0.4)":"0 8px 20px rgba(0, 0, 0, 0.15)"},ref:s.id===1?A:null,children:[e.jsxs("div",{className:`level-icon-circle ${C(s.id)?"completed":""}`,style:{background:s.gradient},children:[s.locked&&e.jsx("div",{className:"lock-overlay",children:"🔒"}),C(s.id)&&e.jsx("div",{className:"completed-check",children:"✓"}),e.jsx("span",{className:"level-symbol",children:s.icon})]}),e.jsx("h3",{className:"level-title",children:s.title}),e.jsx("p",{className:"level-description",children:s.description}),e.jsxs("div",{className:"level-info",children:[e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"📚"})," ",s.subChapters.length," Sub Bab"]}),e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"🎮"})," ",s.games.length," Game"]})]}),e.jsx("div",{className:"level-badge",style:{background:s.color},children:s.id})]},s.id))})]}),e.jsx(V,{children:h&&n&&e.jsx(x.div,{className:"popup-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:d,children:e.jsxs(x.div,{className:"level-popup",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{type:"spring",damping:25},style:{background:"linear-gradient(to bottom right, white, #f9f9f9)",borderTop:`5px solid ${n.color}`},onClick:s=>s.stopPropagation(),children:[e.jsx(x.button,{className:"close-popup",onClick:d,initial:{opacity:0},animate:{opacity:1},whileHover:{scale:1.1},whileTap:{scale:.9},transition:{duration:.3,type:"spring",stiffness:300},children:"✕"}),e.jsxs("div",{className:"popup-header",style:{background:n.gradient},children:[e.jsx("div",{className:"popup-level-icon",children:n.icon}),e.jsxs("h2",{children:["Level ",n.id,": ",n.title]})]}),e.jsxs("div",{className:"popup-sections",children:[e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"📚"}),"Sub-Bab Materi"]}),e.jsx("div",{className:"sub-chapter-list",children:n.subChapters.map(s=>e.jsxs(x.div,{className:"sub-chapter-item",onClick:()=>o(s),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"sub-chapter-icon",children:s.icon}),e.jsxs("div",{className:"sub-chapter-content",children:[e.jsx("div",{className:"sub-chapter-number",children:s.id}),e.jsx("h4",{children:s.title})]}),e.jsx("div",{className:"sub-chapter-arrow",children:"→"})]},s.id))})]}),e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"🎮"}),"Game Latihan"]}),e.jsx("div",{className:"game-list",children:n.games.map(s=>e.jsxs(x.div,{className:"game-item",onClick:()=>a(s),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"game-icon",children:s.icon}),e.jsxs("div",{className:"game-content",children:[e.jsx("h4",{children:s.title}),e.jsx("span",{className:"game-label",children:"Main Sekarang"})]}),e.jsx("div",{className:"game-arrow",children:"→"})]},s.id))})]})]}),e.jsx("div",{className:"popup-footer",children:C(n.id)?e.jsxs("div",{className:"level-status completed-status",children:[e.jsx("span",{className:"status-icon",children:"✓"})," Level Selesai"]}):e.jsxs("div",{className:"level-status",children:[e.jsx("span",{className:"status-icon",children:"⏳"})," Belum Selesai"]})})]})})})]})}const be=[{id:1,title:"Level 1",description:"Pengenalan Operasi Hitung",icon:"🔍",color:"#4E6BFF",gradient:"linear-gradient(135deg, #4E6BFF, #8393FF)",subChapters:[{id:1,title:"Pembilang Satu",icon:"📝"},{id:2,title:"Menyebut Pecahan Yang Penyebutnya Sama",icon:"📊"}],games:[{id:1,title:"Permainan Mencari Pecahan Dan Pembilang",path:"/game/kelas4/bab2/level1",icon:"🎲"}]},{id:2,title:"Level 2",description:"Pengukuran & Pola",icon:"📏",color:"#FF5733",gradient:"linear-gradient(135deg, #FF5733, #FF9A7A)",subChapters:[{id:3,title:"Mengurutkan dan Membandingkan Pecahan",icon:"🧩"},{id:4,title:"Pecahan Senilai",icon:"🔢"}],games:[{id:3,title:"Tantangan Mengurutkan Dan Pecahan Senilai",path:"/game/kelas4/bab2/level2",icon:"🎯"}]},{id:3,title:"Level 3",description:"Operasi Kompleks",icon:"🧮",color:"#9C27B0",gradient:"linear-gradient(135deg, #9C27B0, #D066E2)",subChapters:[{id:5,title:"Pecahan Desimal",icon:"✖️"},{id:6,title:"Pecahan Desimal: Persepuluhan",icon:"➗"}],games:[{id:5,title:"Menghitung Pecahan Desimal Sampai Perespuluhan",path:"/game/kelas4/bab2/level3",icon:"🧩"}]},{id:4,title:"Level 4",description:"Evaluasi & Penerapan",icon:"🏆",color:"#009688",gradient:"linear-gradient(135deg, #009688, #4DB6AC)",subChapters:[{id:7,title:"Pecahan Desimal: Perseratusan dan Persen",icon:"📊"},{id:8,title:"Rangkuman Singkat",icon:"📝"}],games:[{id:7,title:"Game Latihan Pecahan Desimal",path:"/game/kelas4/bab2/level4",icon:"🎮"}],locked:!1}];function ys(){const i=W(),[n,r]=l.useState(null),[h,m]=l.useState(!1),[u,c]=l.useState({}),[f,B]=l.useState([]),[y,g]=l.useState(!1),[k,p]=l.useState(!1),A=l.useRef(null),L=Array.from({length:50},(s,M)=>({id:M,size:Math.random()*3+1,left:Math.random()*100,top:Math.random()*100,delay:Math.random()*5,duration:Math.random()*3+2})),$=Array.from({length:6},(s,M)=>({id:M,size:Math.random()*150+100,left:Math.random()*100,top:Math.random()*20+10,speed:Math.random()*100+50,delay:Math.random()*20}));l.useEffect(()=>{if(!(localStorage.getItem("isLoggedIn")==="true")){i("/login");return}const M=JSON.parse(localStorage.getItem("selectedAvatar"));if(M){const O=`avatar_${M.name}_bab2_levels_progress`,J=JSON.parse(localStorage.getItem(O))||{};c(J);const T=be.filter(D=>{var z;return!D.locked&&((z=J[`level_${D.id}`])==null?void 0:z.completed)}).map(D=>D.id);B(T)}const E=setTimeout(()=>{p(!0)},3e3);return()=>clearTimeout(E)},[i]);const j=()=>{$e({particleCount:100,spread:70,origin:{y:.6}})},v=s=>{if(s.locked){alert("Level ini terkunci! Selesaikan level sebelumnya terlebih dahulu.");return}g(!0),f.includes(s.id)&&j(),r(s),m(!0),p(!1)},b=()=>{const s=be.find(M=>M.id===1);s&&(r(s),m(!0),p(!1),g(!0),f.includes(1)&&j())},d=()=>{m(!1),setTimeout(()=>{r(null),g(!1)},300)},o=s=>{s.title==="Pembilang Satu"?i("/materi/materikelas4/materiBab2_1"):s.title==="Menyebut Pecahan Yang Penyebutnya Sama"?i("/materi/materikelas4/materiBab2_2"):s.title==="Mengurutkan dan Membandingkan Pecahan"?i("/materi/materikelas4/materiBab2_3"):s.title==="Pecahan Senilai"?i("/materi/materikelas4/materiBab2_4"):s.title==="Pecahan Desimal"?i("/materi/materikelas4/materiBab2_5"):s.title==="Pecahan Desimal: Persepuluhan"?i("/materi/materikelas4/materiBab2_6"):s.title==="Pecahan Desimal: Perseratusan dan Persen"?i("/materi/materikelas4/materiBab2_7"):i(`/materi/materikelas4/materiBab1_${s.id}`)},a=s=>{i(s.path)},N=()=>{g(!0),setTimeout(()=>{i("/kelas4")},500)},C=s=>f.includes(s);return e.jsxs("div",{className:`category-container ${y?"animate-bg":""}`,children:[e.jsxs("div",{className:"background-elements",children:[L.map(s=>e.jsx("div",{className:"star",style:{width:s.size+"px",height:s.size+"px",left:s.left+"%",top:s.top+"%",animationDelay:s.delay+"s",animationDuration:s.duration+"s"}},`star-${s.id}`)),$.map(s=>e.jsx("div",{className:"cloud",style:{width:s.size+"px",height:s.size/2+"px",left:s.left+"%",top:s.top+"%",animationDuration:s.speed+"s",animationDelay:s.delay+"s"}},`cloud-${s.id}`))]}),e.jsxs("header",{className:"header animated-header",children:[e.jsxs(x.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:["BAB 2 ",e.jsx("span",{className:"wave",children:"🧮"})]}),e.jsx(x.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3,duration:.6},className:"header-tagline",children:"Pilih level untuk memulai perjalanan belajar matematika!"})]}),e.jsxs("section",{className:"categories-section",children:[e.jsxs(x.h2,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.7},children:[e.jsx("span",{className:"category-icon",children:"📚"})," Bab 2: Operasi Hitung"]}),e.jsx(x.button,{className:"back-button",onClick:N,whileHover:{scale:1.05},whileTap:{scale:.95},initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},children:"Kembali"}),e.jsx(V,{children:k&&e.jsxs(x.div,{className:"hint-bubble",initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8},children:[e.jsx("div",{className:"hint-arrow"}),e.jsx("p",{children:"Klik kartu level untuk mulai belajar!"})]})}),e.jsx("div",{className:"level-path",children:be.map((s,M)=>e.jsxs(le.Fragment,{children:[M>0&&e.jsx("div",{className:`path-connector ${f.includes(s.id-1)?"completed-path":""}`,children:f.includes(s.id-1)&&e.jsx("div",{className:"path-progress-animation"})}),e.jsx("div",{className:`path-node ${C(s.id)?"completed-node":""} ${s.locked?"locked-node":""}`,onClick:()=>v(s),children:s.id})]},`path-${s.id}`))}),e.jsx("div",{className:"level-grid",children:be.map(s=>e.jsxs(x.div,{className:`level-card ${s.locked?"level-locked":""} ${s.id===1?"level1-card":""}`,onClick:()=>s.id===1?b():v(s),whileHover:s.locked?{}:{scale:1.05,y:-5},whileTap:s.locked?{}:{scale:.95},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*s.id},style:{boxShadow:s.id===1?"0 8px 25px rgba(78, 107, 255, 0.4)":"0 8px 20px rgba(0, 0, 0, 0.15)"},ref:s.id===1?A:null,children:[e.jsxs("div",{className:`level-icon-circle ${C(s.id)?"completed":""} ${s.id===1?"level1-icon":""}`,style:{background:s.gradient},children:[s.locked&&e.jsx("div",{className:"lock-overlay",children:"🔒"}),C(s.id)&&e.jsx("div",{className:"completed-check",children:"✓"}),e.jsx("span",{className:"level-symbol",children:s.icon})]}),e.jsx("h3",{className:"level-title",children:s.title}),e.jsx("p",{className:"level-description",children:s.description}),e.jsxs("div",{className:"level-info",children:[e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"📚"})," ",s.subChapters.length," Sub Bab"]}),e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"🎮"})," ",s.games.length," Game"]})]}),e.jsx("div",{className:"level-badge",style:{background:s.color},children:s.id})]},s.id))})]}),e.jsx(V,{children:h&&n&&e.jsx(x.div,{className:"popup-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:d,children:e.jsxs(x.div,{className:"level-popup",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{type:"spring",damping:25},style:{background:"linear-gradient(to bottom right, white, #f9f9f9)",borderTop:`5px solid ${n.color}`},onClick:s=>s.stopPropagation(),children:[e.jsx(x.button,{className:"close-popup",onClick:d,initial:{opacity:0},animate:{opacity:1},whileHover:{scale:1.1},whileTap:{scale:.9},transition:{duration:.3,type:"spring",stiffness:300},children:"✕"}),e.jsxs("div",{className:"popup-header",style:{background:n.gradient},children:[e.jsx("div",{className:"popup-level-icon",children:n.icon}),e.jsxs("h2",{children:["Level ",n.id,": ",n.title]})]}),e.jsxs("div",{className:"popup-sections",children:[e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"📚"}),"Sub-Bab Materi"]}),e.jsx("div",{className:"sub-chapter-list",children:n.subChapters.map(s=>e.jsxs(x.div,{className:"sub-chapter-item",onClick:()=>o(s),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"sub-chapter-icon",children:s.icon}),e.jsxs("div",{className:"sub-chapter-content",children:[e.jsx("div",{className:"sub-chapter-number",children:s.id}),e.jsx("h4",{children:s.title})]}),e.jsx("div",{className:"sub-chapter-arrow",children:"→"})]},s.id))})]}),e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"🎮"}),"Game Latihan"]}),e.jsx("div",{className:"game-list",children:n.games.map(s=>e.jsxs(x.div,{className:"game-item",onClick:()=>a(s),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"game-icon",children:s.icon}),e.jsxs("div",{className:"game-content",children:[e.jsx("h4",{children:s.title}),e.jsx("span",{className:"game-label",children:"Main Sekarang"})]}),e.jsx("div",{className:"game-arrow",children:"→"})]},s.id))})]})]}),e.jsx("div",{className:"popup-footer",children:C(n.id)?e.jsxs("div",{className:"level-status completed-status",children:[e.jsx("span",{className:"status-icon",children:"✓"})," Level Selesai"]}):e.jsxs("div",{className:"level-status",children:[e.jsx("span",{className:"status-icon",children:"⏳"})," Belum Selesai"]})})]})})})]})}const ke=[{id:1,title:"Level 1",description:"Pengenalan Pola Gambar",icon:"🏠",color:"#3F51B5",gradient:"linear-gradient(135deg, #3F51B5, #7986CB)",subChapters:[{id:1,title:"Pola Gambar",icon:"🧊"},{id:2,title:"Pola Gambar Membesar",icon:"📦"},{id:3,title:"Pola Gambar Mengecil",icon:"🔷"}],games:[{id:1,title:"Yuk Coba Gamenya!",path:"/game/kelas4/bab3/level1",icon:"🎲"}]},{id:2,title:"Level 2",description:"Pengenalan Pola Bilangan",icon:"📐",color:"#4CAF50",gradient:"linear-gradient(135deg, #4CAF50, #81C784)",subChapters:[{id:4,title:"Pola Bilangan",icon:"🎯"},{id:5,title:"Pola Bilangan Membesar",icon:"📊"},{id:6,title:"Pola Bilangan Mengecil",icon:"🔢"}],games:[{id:2,title:"Yuk Coba Gamenya!",path:"/game/kelas4/bab3/level2",icon:"⚡"}]}];function ks(){const i=W(),[n,r]=l.useState(null),[h,m]=l.useState(!1),[u,c]=l.useState({}),[f,B]=l.useState([]),[y,g]=l.useState(!1),[k,p]=l.useState(!1),A=Array.from({length:50},(a,N)=>({id:N,size:Math.random()*3+1,left:Math.random()*100,top:Math.random()*100,delay:Math.random()*5,duration:Math.random()*3+2})),L=Array.from({length:6},(a,N)=>({id:N,size:Math.random()*150+100,left:Math.random()*100,top:Math.random()*20+10,speed:Math.random()*100+50,delay:Math.random()*20}));l.useEffect(()=>{if(!(localStorage.getItem("isLoggedIn")==="true")){i("/login");return}const N=JSON.parse(localStorage.getItem("selectedAvatar"));if(N){const s=`avatar_${N.name}_levels_progress`,M=JSON.parse(localStorage.getItem(s))||{};c(M);const E=ke.filter(O=>{var J;return!O.locked&&((J=M[`level_${O.id}`])==null?void 0:J.completed)}).map(O=>O.id);B(E)}const C=setTimeout(()=>{p(!0)},3e3);return()=>clearTimeout(C)},[i]);const $=a=>{if(a.locked){alert("Level ini terkunci! Selesaikan level sebelumnya terlebih dahulu.");return}g(!0),r(a),m(!0),p(!1)},j=()=>{m(!1),setTimeout(()=>{r(null),g(!1)},300)},v=a=>{a.title==="Pola Gambar"?i("/materi/materikelas4/materiBab3_1"):a.title==="Pola Gambar Membesar"?i("/materi/materikelas4/materiBab3_2"):a.title==="Pola Gambar Mengecil"?i("/materi/materikelas4/materiBab3_3"):a.title==="Pola Bilangan"?i("/materi/materikelas4/materiBab3_4"):a.title==="Pola Bilangan Membesar"?i("/materi/materikelas4/materiBab3_5"):a.title==="Pola Bilangan Mengecil"?i("/materi/materikelas4/materiBab3_6"):i(`/materi/materikelas4/materiBab3_${a.id}`)},b=a=>{i(a.path)},d=()=>{g(!0),setTimeout(()=>{i("/kelas4")},500)},o=a=>!1;return e.jsxs("div",{className:`category-container ${y?"animate-bg":""}`,children:[e.jsxs("div",{className:"background-elements",children:[A.map(a=>e.jsx("div",{className:"star",style:{width:a.size+"px",height:a.size+"px",left:a.left+"%",top:a.top+"%",animationDelay:a.delay+"s",animationDuration:a.duration+"s"}},`star-${a.id}`)),L.map(a=>e.jsx("div",{className:"cloud",style:{width:a.size+"px",height:a.size/2+"px",left:a.left+"%",top:a.top+"%",animationDuration:a.speed+"s",animationDelay:a.delay+"s"}},`cloud-${a.id}`))]}),e.jsxs("header",{className:"header animated-header",children:[e.jsxs(x.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:["BAB 3 ",e.jsx("span",{className:"wave",children:"🏠"})]}),e.jsx(x.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3,duration:.6},className:"header-tagline",children:"Eksplorasi dunia tiga dimensi dengan seru!"})]}),e.jsxs("section",{className:"categories-section",children:[e.jsxs(x.h2,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.7},children:[e.jsx("span",{className:"category-icon",children:"📦"})," Bab 3: Pengenalan Pola Bilangan Dan Gambar"]}),e.jsx(x.button,{className:"back-button",onClick:d,whileHover:{scale:1.05},whileTap:{scale:.95},initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},children:"Kembali"}),e.jsx(V,{children:k&&e.jsxs(x.div,{className:"hint-bubble",initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8},children:[e.jsx("div",{className:"hint-arrow"}),e.jsx("p",{children:"Klik kartu level untuk mulai belajar!"})]})}),e.jsx("div",{className:"level-path",children:ke.map((a,N)=>e.jsxs(le.Fragment,{children:[N>0&&e.jsx("div",{className:"path-connector"}),e.jsx("div",{className:`path-node ${a.locked?"locked-node":""}`,children:a.id})]},`path-${a.id}`))}),e.jsx("div",{className:"level-grid",children:ke.map(a=>e.jsxs(x.div,{className:`level-card ${a.locked?"level-locked":""}`,onClick:()=>$(a),whileHover:a.locked?{}:{scale:1.05,y:-5},whileTap:a.locked?{}:{scale:.95},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*a.id},style:{boxShadow:"0 8px 20px rgba(0, 0, 0, 0.15)"},children:[e.jsxs("div",{className:`level-icon-circle ${o(a.id)?"completed":""}`,style:{background:a.gradient},children:[a.locked&&e.jsx("div",{className:"lock-overlay",children:"🔒"}),o(a.id),e.jsx("span",{className:"level-symbol",children:a.icon})]}),e.jsx("h3",{className:"level-title",children:a.title}),e.jsx("p",{className:"level-description",children:a.description}),e.jsxs("div",{className:"level-info",children:[e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"📚"})," ",a.subChapters.length," Sub Bab"]}),e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"🎮"})," ",a.games.length," Game"]})]}),e.jsx("div",{className:"level-badge",style:{background:a.color},children:a.id})]},a.id))})]}),e.jsx(V,{children:h&&n&&e.jsx(x.div,{className:"popup-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:j,children:e.jsxs(x.div,{className:"level-popup",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{type:"spring",damping:25},style:{background:"linear-gradient(to bottom right, white, #f9f9f9)",borderTop:`5px solid ${n.color}`},onClick:a=>a.stopPropagation(),children:[e.jsx(x.button,{className:"close-popup",onClick:j,initial:{opacity:0},animate:{opacity:1},whileHover:{scale:1.1},whileTap:{scale:.9},transition:{duration:.3,type:"spring",stiffness:300},children:"✕"}),e.jsxs("div",{className:"popup-header",style:{background:n.gradient},children:[e.jsx("div",{className:"popup-level-icon",children:n.icon}),e.jsxs("h2",{children:["Level ",n.id,": ",n.title]})]}),e.jsxs("div",{className:"popup-sections",children:[e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"📚"}),"Sub-Bab Materi"]}),e.jsx("div",{className:"sub-chapter-list",children:n.subChapters.map(a=>e.jsxs(x.div,{className:"sub-chapter-item",onClick:()=>v(a),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"sub-chapter-icon",children:a.icon}),e.jsxs("div",{className:"sub-chapter-content",children:[e.jsx("div",{className:"sub-chapter-number",children:a.id}),e.jsx("h4",{children:a.title})]}),e.jsx("div",{className:"sub-chapter-arrow",children:"→"})]},a.id))})]}),e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"🎮"}),"Game Latihan"]}),e.jsx("div",{className:"game-list",children:n.games.map(a=>e.jsxs(x.div,{className:"game-item",onClick:()=>b(a),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"game-icon",children:a.icon}),e.jsxs("div",{className:"game-content",children:[e.jsx("h4",{children:a.title}),e.jsx("span",{className:"game-label",children:"Main Sekarang"})]}),e.jsx("div",{className:"game-arrow",children:"→"})]},a.id))})]})]}),e.jsx("div",{className:"popup-footer",children:o(n.id)?e.jsxs("div",{className:"level-status completed-status",children:[e.jsx("span",{className:"status-icon",children:"✓"})," Level Selesai"]}):e.jsxs("div",{className:"level-status",children:[e.jsx("span",{className:"status-icon",children:"⏳"})," Belum Selesai"]})})]})})})]})}const Ne=[{id:1,title:"Level 1",description:"Pengukuran Luas",icon:"📏",color:"#4CAF50",gradient:"linear-gradient(135deg, #4CAF50, #81C784)",subChapters:[{id:1,title:"Pengukuran Luas Menggunakan Satuan Tidak Baku",icon:"🟦"},{id:2,title:"Pengukuran Luas Menggunakan Satuan Baku",icon:"📐"}],games:[{id:1,title:"Yuk Coba Gamenya!",path:"/game/kelas4/bab4/level1",icon:"🎮"}]},{id:2,title:"Level 2",description:"Pengukuran Volume",icon:"📦",color:"#2196F3",gradient:"linear-gradient(135deg, #2196F3, #64B5F6)",subChapters:[{id:3,title:"Pengukuran Volume Menggunakan Satuan Tidak Baku",icon:"🧊"},{id:4,title:"Pengukuran Volume Menggunakan Satuan Baku",icon:"🥛"}],games:[{id:2,title:"Yuk Coba Gamenya!",path:"/game/kelas4/bab4/level2",icon:"🎲"}]}];function Ns(){const i=W(),[n,r]=l.useState(null),[h,m]=l.useState(!1),[u,c]=l.useState({}),[f,B]=l.useState([]),[y,g]=l.useState(!1),[k,p]=l.useState(!1),A=Array.from({length:50},(a,N)=>({id:N,size:Math.random()*3+1,left:Math.random()*100,top:Math.random()*100,delay:Math.random()*5,duration:Math.random()*3+2})),L=Array.from({length:6},(a,N)=>({id:N,size:Math.random()*150+100,left:Math.random()*100,top:Math.random()*20+10,speed:Math.random()*100+50,delay:Math.random()*20}));l.useEffect(()=>{if(!(localStorage.getItem("isLoggedIn")==="true")){i("/login");return}const N=JSON.parse(localStorage.getItem("selectedAvatar"));if(N){const s=`avatar_${N.name}_levels_progress`,M=JSON.parse(localStorage.getItem(s))||{};c(M);const E=Ne.filter(O=>{var J;return!O.locked&&((J=M[`level_${O.id}`])==null?void 0:J.completed)}).map(O=>O.id);B(E)}const C=setTimeout(()=>{p(!0)},3e3);return()=>clearTimeout(C)},[i]);const $=a=>{if(a.locked){alert("Level ini terkunci! Selesaikan level sebelumnya terlebih dahulu.");return}g(!0),r(a),m(!0),p(!1)},j=()=>{m(!1),setTimeout(()=>{r(null),g(!1)},300)},v=a=>{a.title==="Pengukuran Luas Menggunakan Satuan Tidak Baku"?i("/materi/materikelas4/materiBab4_1"):a.title==="Pengukuran Luas Menggunakan Satuan Baku"?i("/materi/materikelas4/materiBab4_2"):a.title==="Pengukuran Volume Menggunakan Satuan Tidak Baku"?i("/materi/materikelas4/materiBab4_3"):a.title==="Pengukuran Volume Menggunakan Satuan Baku"?i("/materi/materikelas4/materiBab4_4"):i(`/materi/materikelas4/materiBab4_${a.id}`)},b=a=>{i(a.path)},d=()=>{g(!0),setTimeout(()=>{i("/kelas4")},500)},o=a=>!1;return e.jsxs("div",{className:`category-container ${y?"animate-bg":""}`,children:[e.jsxs("div",{className:"background-elements",children:[A.map(a=>e.jsx("div",{className:"star",style:{width:a.size+"px",height:a.size+"px",left:a.left+"%",top:a.top+"%",animationDelay:a.delay+"s",animationDuration:a.duration+"s"}},`star-${a.id}`)),L.map(a=>e.jsx("div",{className:"cloud",style:{width:a.size+"px",height:a.size/2+"px",left:a.left+"%",top:a.top+"%",animationDuration:a.speed+"s",animationDelay:a.delay+"s"}},`cloud-${a.id}`))]})," ",e.jsxs("header",{className:"header animated-header",children:[e.jsxs(x.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:["BAB 4 ",e.jsx("span",{className:"wave",children:"📏"})]}),e.jsx(x.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3,duration:.6},className:"header-tagline",children:"Belajar pengukuran luas dan volume bersama!"})]}),e.jsxs("section",{className:"categories-section",children:[" ",e.jsxs(x.h2,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.7},children:[e.jsx("span",{className:"category-icon",children:"📏"})," Bab 4: Pengukuran Luas dan Volume"]}),e.jsx(x.button,{className:"back-button",onClick:d,whileHover:{scale:1.05},whileTap:{scale:.95},initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},children:"Kembali"}),e.jsx(V,{children:k&&e.jsxs(x.div,{className:"hint-bubble",initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8},children:[e.jsx("div",{className:"hint-arrow"}),e.jsx("p",{children:"Klik kartu level untuk mulai belajar!"})]})}),e.jsx("div",{className:"level-path",children:Ne.map((a,N)=>e.jsxs(le.Fragment,{children:[N>0&&e.jsx("div",{className:"path-connector"}),e.jsx("div",{className:`path-node ${a.locked?"locked-node":""}`,children:a.id})]},`path-${a.id}`))}),e.jsx("div",{className:"level-grid",children:Ne.map(a=>e.jsxs(x.div,{className:`level-card ${a.locked?"level-locked":""}`,onClick:()=>$(a),whileHover:a.locked?{}:{scale:1.05,y:-5},whileTap:a.locked?{}:{scale:.95},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*a.id},style:{boxShadow:"0 8px 20px rgba(0, 0, 0, 0.15)"},children:[e.jsxs("div",{className:`level-icon-circle ${o(a.id)?"completed":""}`,style:{background:a.gradient},children:[a.locked&&e.jsx("div",{className:"lock-overlay",children:"🔒"}),o(a.id),e.jsx("span",{className:"level-symbol",children:a.icon})]}),e.jsx("h3",{className:"level-title",children:a.title}),e.jsx("p",{className:"level-description",children:a.description}),e.jsxs("div",{className:"level-info",children:[e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"📚"})," ",a.subChapters.length," Sub Bab"]}),e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"🎮"})," ",a.games.length," Game"]})]}),e.jsx("div",{className:"level-badge",style:{background:a.color},children:a.id})]},a.id))})]}),e.jsx(V,{children:h&&n&&e.jsx(x.div,{className:"popup-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:j,children:e.jsxs(x.div,{className:"level-popup",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{type:"spring",damping:25},style:{background:"linear-gradient(to bottom right, white, #f9f9f9)",borderTop:`5px solid ${n.color}`},onClick:a=>a.stopPropagation(),children:[e.jsx(x.button,{className:"close-popup",onClick:j,initial:{opacity:0},animate:{opacity:1},whileHover:{scale:1.1},whileTap:{scale:.9},transition:{duration:.3,type:"spring",stiffness:300},children:"✕"}),e.jsxs("div",{className:"popup-header",style:{background:n.gradient},children:[e.jsx("div",{className:"popup-level-icon",children:n.icon}),e.jsxs("h2",{children:["Level ",n.id,": ",n.title]})]}),e.jsxs("div",{className:"popup-sections",children:[e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"📚"}),"Sub-Bab Materi"]}),e.jsx("div",{className:"sub-chapter-list",children:n.subChapters.map(a=>e.jsxs(x.div,{className:"sub-chapter-item",onClick:()=>v(a),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"sub-chapter-icon",children:a.icon}),e.jsxs("div",{className:"sub-chapter-content",children:[e.jsx("div",{className:"sub-chapter-number",children:a.id}),e.jsx("h4",{children:a.title})]}),e.jsx("div",{className:"sub-chapter-arrow",children:"→"})]},a.id))})]}),e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"🎮"}),"Game Latihan"]}),e.jsx("div",{className:"game-list",children:n.games.map(a=>e.jsxs(x.div,{className:"game-item",onClick:()=>b(a),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"game-icon",children:a.icon}),e.jsxs("div",{className:"game-content",children:[e.jsx("h4",{children:a.title}),e.jsx("span",{className:"game-label",children:"Main Sekarang"})]}),e.jsx("div",{className:"game-arrow",children:"→"})]},a.id))})]})]}),e.jsx("div",{className:"popup-footer",children:o(n.id)?e.jsxs("div",{className:"level-status completed-status",children:[e.jsx("span",{className:"status-icon",children:"✓"})," Level Selesai"]}):e.jsxs("div",{className:"level-status",children:[e.jsx("span",{className:"status-icon",children:"⏳"})," Belum Selesai"]})})]})})})]})}const Se=[{id:1,title:"Level 1",description:"Data dan Pengukuran",icon:"📊",color:"#E91E63",gradient:"linear-gradient(135deg, #E91E63, #F48FB1)",subChapters:[{id:1,title:"Apa Itu Segibanyak?",icon:"📝"},{id:2,title:" Segitiga: Bangun Tiga Sisi yang Seru!",icon:"📈"},{id:3,title:"Segiempat Bangun Empat Sisi yang Menarik",icon:"🔍"}],games:[{id:1,title:"Yuk Coba Gamenya!",path:"/game/kelas4/Bab5/level1",icon:"🎮"}]}];function Ss(){const i=W(),[n,r]=l.useState(null),[h,m]=l.useState(!1),[u,c]=l.useState({}),[f,B]=l.useState([]),[y,g]=l.useState(!1),[k,p]=l.useState(!1),A=Array.from({length:50},(a,N)=>({id:N,size:Math.random()*3+1,left:Math.random()*100,top:Math.random()*100,delay:Math.random()*5,duration:Math.random()*3+2})),L=Array.from({length:6},(a,N)=>({id:N,size:Math.random()*150+100,left:Math.random()*100,top:Math.random()*20+10,speed:Math.random()*100+50,delay:Math.random()*20}));l.useEffect(()=>{if(!(localStorage.getItem("isLoggedIn")==="true")){i("/login");return}const N=JSON.parse(localStorage.getItem("selectedAvatar"));if(N){const s=`avatar_${N.name}_levels_progress`,M=JSON.parse(localStorage.getItem(s))||{};c(M);const E=Se.filter(O=>{var J;return!O.locked&&((J=M[`level_${O.id}`])==null?void 0:J.completed)}).map(O=>O.id);B(E)}const C=setTimeout(()=>{p(!0)},3e3);return()=>clearTimeout(C)},[i]);const $=a=>{if(a.locked){alert("Level ini terkunci! Selesaikan level sebelumnya terlebih dahulu.");return}g(!0),r(a),m(!0),p(!1)},j=()=>{m(!1),setTimeout(()=>{r(null),g(!1)},300)},v=a=>{a.title==="Apa Itu Segibanyak?"?i("/materi/materikelas4/materiBab5_1"):a.title===" Segitiga: Bangun Tiga Sisi yang Seru!"?i("/materi/materikelas4/materiBab5_2"):a.title==="Segiempat Bangun Empat Sisi yang Menarik"?i("/materi/materikelas4/materiBab5_3"):i(`/materi/materikelas4/materiBab5_${a.id}`)},b=a=>{i(a.path)},d=()=>{g(!0),setTimeout(()=>{i("/kelas4")},500)},o=a=>!1;return e.jsxs("div",{className:`category-container ${y?"animate-bg":""}`,children:[e.jsxs("div",{className:"background-elements",children:[A.map(a=>e.jsx("div",{className:"star",style:{width:a.size+"px",height:a.size+"px",left:a.left+"%",top:a.top+"%",animationDelay:a.delay+"s",animationDuration:a.duration+"s"}},`star-${a.id}`)),L.map(a=>e.jsx("div",{className:"cloud",style:{width:a.size+"px",height:a.size/2+"px",left:a.left+"%",top:a.top+"%",animationDuration:a.speed+"s",animationDelay:a.delay+"s"}},`cloud-${a.id}`))]})," ",e.jsxs("header",{className:"header animated-header",children:[e.jsxs(x.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:["BAB 5 ",e.jsx("span",{className:"wave",children:"📊"})]}),e.jsx(x.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3,duration:.6},className:"header-tagline",children:"Belajar data dan pengukuran bersama!"})]}),e.jsxs("section",{className:"categories-section",children:[" ",e.jsxs(x.h2,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.7},children:[e.jsx("span",{className:"category-icon",children:"📊"})," Bab 5: Data dan Pengukuran"]}),e.jsx(x.button,{className:"back-button",onClick:d,whileHover:{scale:1.05},whileTap:{scale:.95},initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},children:"Kembali"}),e.jsx(V,{children:k&&e.jsxs(x.div,{className:"hint-bubble",initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8},children:[e.jsx("div",{className:"hint-arrow"}),e.jsx("p",{children:"Klik kartu level untuk mulai belajar!"})]})}),e.jsx("div",{className:"level-path",children:Se.map((a,N)=>e.jsxs(le.Fragment,{children:[N>0&&e.jsx("div",{className:"path-connector"}),e.jsx("div",{className:`path-node ${a.locked?"locked-node":""}`,children:a.id})]},`path-${a.id}`))}),e.jsx("div",{className:"level-grid",children:Se.map(a=>e.jsxs(x.div,{className:`level-card ${a.locked?"level-locked":""}`,onClick:()=>$(a),whileHover:a.locked?{}:{scale:1.05,y:-5},whileTap:a.locked?{}:{scale:.95},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*a.id},style:{boxShadow:"0 8px 20px rgba(0, 0, 0, 0.15)"},children:[e.jsxs("div",{className:`level-icon-circle ${o(a.id)?"completed":""}`,style:{background:a.gradient},children:[a.locked&&e.jsx("div",{className:"lock-overlay",children:"🔒"}),o(a.id),e.jsx("span",{className:"level-symbol",children:a.icon})]}),e.jsx("h3",{className:"level-title",children:a.title}),e.jsx("p",{className:"level-description",children:a.description}),e.jsxs("div",{className:"level-info",children:[e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"📚"})," ",a.subChapters.length," Sub Bab"]}),e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"🎮"})," ",a.games.length," Game"]})]}),e.jsx("div",{className:"level-badge",style:{background:a.color},children:a.id})]},a.id))})]}),e.jsx(V,{children:h&&n&&e.jsx(x.div,{className:"popup-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:j,children:e.jsxs(x.div,{className:"level-popup",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{type:"spring",damping:25},style:{background:"linear-gradient(to bottom right, white, #f9f9f9)",borderTop:`5px solid ${n.color}`},onClick:a=>a.stopPropagation(),children:[e.jsx(x.button,{className:"close-popup",onClick:j,initial:{opacity:0},animate:{opacity:1},whileHover:{scale:1.1},whileTap:{scale:.9},transition:{duration:.3,type:"spring",stiffness:300},children:"✕"}),e.jsxs("div",{className:"popup-header",style:{background:n.gradient},children:[e.jsx("div",{className:"popup-level-icon",children:n.icon}),e.jsxs("h2",{children:["Level ",n.id,": ",n.title]})]}),e.jsxs("div",{className:"popup-sections",children:[e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"📚"}),"Sub-Bab Materi"]}),e.jsx("div",{className:"sub-chapter-list",children:n.subChapters.map(a=>e.jsxs(x.div,{className:"sub-chapter-item",onClick:()=>v(a),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"sub-chapter-icon",children:a.icon}),e.jsxs("div",{className:"sub-chapter-content",children:[e.jsx("div",{className:"sub-chapter-number",children:a.id}),e.jsx("h4",{children:a.title})]}),e.jsx("div",{className:"sub-chapter-arrow",children:"→"})]},a.id))})]}),e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"🎮"}),"Game Latihan"]}),e.jsx("div",{className:"game-list",children:n.games.map(a=>e.jsxs(x.div,{className:"game-item",onClick:()=>b(a),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"game-icon",children:a.icon}),e.jsxs("div",{className:"game-content",children:[e.jsx("h4",{children:a.title}),e.jsx("span",{className:"game-label",children:"Main Sekarang"})]}),e.jsx("div",{className:"game-arrow",children:"→"})]},a.id))})]})]}),e.jsx("div",{className:"popup-footer",children:o(n.id)?e.jsxs("div",{className:"level-status completed-status",children:[e.jsx("span",{className:"status-icon",children:"✓"})," Level Selesai"]}):e.jsxs("div",{className:"level-status",children:[e.jsx("span",{className:"status-icon",children:"⏳"})," Belum Selesai"]})})]})})})]})}const we=[{id:1,title:"Level 1",description:"Data dan Diagram",icon:"📏",color:"#E91E63",gradient:"linear-gradient(135deg,rgb(233, 192, 30), #F48FB1)",subChapters:[{id:1,title:"Bentuk Penyajian Data Tabel Dan Diagram",icon:"📝"},{id:2,title:"Diagram Gambar (Piktogram)",icon:"📈"},{id:3,title:"Diagram Batang",icon:"🔍"}],games:[{id:1,title:"Yuk Coba Gamenya!",path:"/game/kelas4/Bab6/level1",icon:"🎮"}]}];function ws(){const i=W(),[n,r]=l.useState(null),[h,m]=l.useState(!1),[u,c]=l.useState({}),[f,B]=l.useState([]),[y,g]=l.useState(!1),[k,p]=l.useState(!1),A=Array.from({length:50},(a,N)=>({id:N,size:Math.random()*3+1,left:Math.random()*100,top:Math.random()*100,delay:Math.random()*5,duration:Math.random()*3+2})),L=Array.from({length:6},(a,N)=>({id:N,size:Math.random()*150+100,left:Math.random()*100,top:Math.random()*20+10,speed:Math.random()*100+50,delay:Math.random()*20}));l.useEffect(()=>{if(!(localStorage.getItem("isLoggedIn")==="true")){i("/login");return}const N=JSON.parse(localStorage.getItem("selectedAvatar"));if(N){const s=`avatar_${N.name}_levels_progress`,M=JSON.parse(localStorage.getItem(s))||{};c(M);const E=we.filter(O=>{var J;return!O.locked&&((J=M[`level_${O.id}`])==null?void 0:J.completed)}).map(O=>O.id);B(E)}const C=setTimeout(()=>{p(!0)},3e3);return()=>clearTimeout(C)},[i]);const $=a=>{if(a.locked){alert("Level ini terkunci! Selesaikan level sebelumnya terlebih dahulu.");return}g(!0),r(a),m(!0),p(!1)},j=()=>{m(!1),setTimeout(()=>{r(null),g(!1)},300)},v=a=>{i(`/materi/materikelas4/materiBab6_${a.id}`)},b=a=>{i(a.path)},d=()=>{g(!0),setTimeout(()=>{i("/kelas4")},500)},o=a=>!1;return e.jsxs("div",{className:`category-container ${y?"animate-bg":""}`,children:[e.jsxs("div",{className:"background-elements",children:[A.map(a=>e.jsx("div",{className:"star",style:{width:a.size+"px",height:a.size+"px",left:a.left+"%",top:a.top+"%",animationDelay:a.delay+"s",animationDuration:a.duration+"s"}},`star-${a.id}`)),L.map(a=>e.jsx("div",{className:"cloud",style:{width:a.size+"px",height:a.size/2+"px",left:a.left+"%",top:a.top+"%",animationDuration:a.speed+"s",animationDelay:a.delay+"s"}},`cloud-${a.id}`))]})," ",e.jsxs("header",{className:"header animated-header",children:[e.jsxs(x.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:["BAB 6 ",e.jsx("span",{className:"wave",children:"📊"})]}),e.jsx(x.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3,duration:.6},className:"header-tagline",children:"Belajar Piktogram dan Diagram Batang bersama!"})]}),e.jsxs("section",{className:"categories-section",children:[" ",e.jsxs(x.h2,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.7},children:[e.jsx("span",{className:"category-icon",children:"📊"})," Bab 6: Piktogram dan Diagram Batang"]}),e.jsx(x.button,{className:"back-button",onClick:d,whileHover:{scale:1.05},whileTap:{scale:.95},initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},children:"Kembali"}),e.jsx(V,{children:k&&e.jsxs(x.div,{className:"hint-bubble",initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8},children:[e.jsx("div",{className:"hint-arrow"}),e.jsx("p",{children:"Klik kartu level untuk mulai belajar!"})]})}),e.jsx("div",{className:"level-path",children:we.map((a,N)=>e.jsxs(le.Fragment,{children:[N>0&&e.jsx("div",{className:"path-connector"}),e.jsx("div",{className:`path-node ${a.locked?"locked-node":""}`,children:a.id})]},`path-${a.id}`))}),e.jsx("div",{className:"level-grid",children:we.map(a=>e.jsxs(x.div,{className:`level-card ${a.locked?"level-locked":""}`,onClick:()=>$(a),whileHover:a.locked?{}:{scale:1.05,y:-5},whileTap:a.locked?{}:{scale:.95},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*a.id},style:{boxShadow:"0 8px 20px rgba(0, 0, 0, 0.15)"},children:[e.jsxs("div",{className:`level-icon-circle ${o(a.id)?"completed":""}`,style:{background:a.gradient},children:[a.locked&&e.jsx("div",{className:"lock-overlay",children:"🔒"}),o(a.id),e.jsx("span",{className:"level-symbol",children:a.icon})]}),e.jsx("h3",{className:"level-title",children:a.title}),e.jsx("p",{className:"level-description",children:a.description}),e.jsxs("div",{className:"level-info",children:[e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"📚"})," ",a.subChapters.length," Sub Bab"]}),e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"🎮"})," ",a.games.length," Game"]})]}),e.jsx("div",{className:"level-badge",style:{background:a.color},children:a.id})]},a.id))})]}),e.jsx(V,{children:h&&n&&e.jsx(x.div,{className:"popup-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:j,children:e.jsxs(x.div,{className:"level-popup",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{type:"spring",damping:25},style:{background:"linear-gradient(to bottom right, white, #f9f9f9)",borderTop:`5px solid ${n.color}`},onClick:a=>a.stopPropagation(),children:[e.jsx(x.button,{className:"close-popup",onClick:j,initial:{opacity:0},animate:{opacity:1},whileHover:{scale:1.1},whileTap:{scale:.9},transition:{duration:.3,type:"spring",stiffness:300},children:"✕"}),e.jsxs("div",{className:"popup-header",style:{background:n.gradient},children:[e.jsx("div",{className:"popup-level-icon",children:n.icon}),e.jsxs("h2",{children:["Level ",n.id,": ",n.title]})]}),e.jsxs("div",{className:"popup-sections",children:[e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"📚"}),"Sub-Bab Materi"]}),e.jsx("div",{className:"sub-chapter-list",children:n.subChapters.map(a=>e.jsxs(x.div,{className:"sub-chapter-item",onClick:()=>v(a),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"sub-chapter-icon",children:a.icon}),e.jsxs("div",{className:"sub-chapter-content",children:[e.jsx("div",{className:"sub-chapter-number",children:a.id}),e.jsx("h4",{children:a.title})]}),e.jsx("div",{className:"sub-chapter-arrow",children:"→"})]},a.id))})]}),e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"🎮"}),"Game Latihan"]}),e.jsx("div",{className:"game-list",children:n.games.map(a=>e.jsxs(x.div,{className:"game-item",onClick:()=>b(a),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"game-icon",children:a.icon}),e.jsxs("div",{className:"game-content",children:[e.jsx("h4",{children:a.title}),e.jsx("span",{className:"game-label",children:"Main Sekarang"})]}),e.jsx("div",{className:"game-arrow",children:"→"})]},a.id))})]})]}),e.jsx("div",{className:"popup-footer",children:o(n.id)?e.jsxs("div",{className:"level-status completed-status",children:[e.jsx("span",{className:"status-icon",children:"✓"})," Level Selesai"]}):e.jsxs("div",{className:"level-status",children:[e.jsx("span",{className:"status-icon",children:"⏳"})," Belum Selesai"]})})]})})})]})}const I=({children:i})=>localStorage.getItem("isLoggedIn")==="true"?i:e.jsx(oe,{to:"/login"}),Pe=({children:i})=>localStorage.getItem("userRole")==="admin"?i:e.jsx(oe,{to:"/"});function _s(){const[i,n]=l.useState(null);return l.useEffect(()=>{const r=async()=>{try{if(!K){n("Tidak dapat terhubung ke database. Beberapa fitur mungkin tidak tersedia.");return}const m=await K.testConnection();n(m?null:"Tidak dapat terhubung ke database. Beberapa fitur mungkin tidak tersedia.")}catch(m){console.error("Database connection error:",m),n("Terjadi kesalahan saat menghubungi database.")}};r();const h=setInterval(r,3e4);return()=>clearInterval(h)},[]),e.jsxs(Qe,{children:[i&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,backgroundColor:"#fff3cd",color:"#856404",padding:"10px",textAlign:"center",zIndex:1e3},children:i}),e.jsxs(Ze,{children:[e.jsx(_,{path:"/",element:e.jsx(ea,{})}),e.jsx(_,{path:"/login",element:e.jsx(aa,{})}),e.jsx(_,{path:"/main-siswa",element:e.jsx(I,{children:e.jsx(is,{})})}),e.jsx(_,{path:"/kelas2",element:e.jsx(I,{children:e.jsx(vs,{})})}),e.jsx(_,{path:"/kelas4",element:e.jsx(I,{children:e.jsx(bs,{})})}),e.jsx(_,{path:"/category4_bab1",element:e.jsx(I,{children:e.jsx(fs,{})})}),e.jsx(_,{path:"/category4_bab2",element:e.jsx(I,{children:e.jsx(ys,{})})}),e.jsx(_,{path:"/category4_bab3",element:e.jsx(I,{children:e.jsx(ks,{})})}),e.jsx(_,{path:"/category4_bab4",element:e.jsx(I,{children:e.jsx(Ns,{})})}),e.jsx(_,{path:"/category4_bab5",element:e.jsx(I,{children:e.jsx(Ss,{})})}),e.jsx(_,{path:"/category4_bab6",element:e.jsx(I,{children:e.jsx(ws,{})})}),e.jsx(_,{path:"/kategori",element:e.jsx(I,{children:e.jsx(ns,{})})}),e.jsx(_,{path:"/game/:chapterIndex/:levelIndex",element:e.jsx(I,{children:e.jsx(ls,{})})}),e.jsx(_,{path:"/hasil/:score",element:e.jsx(I,{children:e.jsx(rs,{})})}),e.jsx(_,{path:"/hasil-retry/:score",element:e.jsx(I,{children:e.jsx(cs,{})})}),e.jsx(_,{path:"/skor",element:e.jsx(I,{children:e.jsx(os,{})})}),e.jsx(_,{path:"/category",element:e.jsx(I,{children:e.jsx(ds,{})})}),e.jsx(_,{path:"/game/penjumlahan",element:e.jsx(I,{children:e.jsx(ia,{})})}),e.jsx(_,{path:"/game/pembagian",element:e.jsx(I,{children:e.jsx(na,{})})}),e.jsx(_,{path:"/game/pengurangan",element:e.jsx(I,{children:e.jsx(la,{})})}),e.jsx(_,{path:"/game/perkalian",element:e.jsx(I,{children:e.jsx(ra,{})})}),e.jsx(_,{path:"/game/pengukuran-luas",element:e.jsx(I,{children:e.jsx(oa,{})})}),e.jsx(_,{path:"/game/pengukuran-volume",element:e.jsx(I,{children:e.jsx(ca,{})})}),e.jsx(_,{path:"/game/kelas4/bab1/level1",element:e.jsx(I,{children:e.jsx(da,{})})}),e.jsx(_,{path:"/game/kelas4/bab1/level2",element:e.jsx(I,{children:e.jsx(ma,{})})}),e.jsx(_,{path:"/game/kelas4/bab1/level3",element:e.jsx(I,{children:e.jsx(ha,{})})}),e.jsx(_,{path:"/game/kelas4/bab1/level4",element:e.jsx(I,{children:e.jsx(pa,{})})}),e.jsx(_,{path:"/game/kelas4/bab2/level1",element:e.jsx(I,{children:e.jsx(ua,{})})}),e.jsx(_,{path:"/game/kelas4/bab2/level2",element:e.jsx(I,{children:e.jsx(ga,{})})}),e.jsx(_,{path:"/game/kelas4/bab2/level3",element:e.jsx(I,{children:e.jsx(xa,{})})}),e.jsx(_,{path:"/game/kelas4/bab2/level4",element:e.jsx(I,{children:e.jsx(ja,{})})})," ",e.jsx(_,{path:"/game/kelas4/bab3/level1",element:e.jsx(I,{children:e.jsx(va,{})})}),e.jsx(_,{path:"/game/kelas4/bab3/level2",element:e.jsx(I,{children:e.jsx(ba,{})})}),e.jsx(_,{path:"/game/kelas4/bab4/level1",element:e.jsx(I,{children:e.jsx(fa,{})})}),e.jsx(_,{path:"/game/kelas4/bab4/level2",element:e.jsx(I,{children:e.jsx(ya,{})})}),e.jsx(_,{path:"/game/kelas4/bab5/level1",element:e.jsx(I,{children:e.jsx(ka,{})})}),e.jsx(_,{path:"/game/kelas4/bab6/level1",element:e.jsx(I,{children:e.jsx(Na,{})})}),e.jsx(_,{path:"/game/addition",element:e.jsx(oe,{to:"/game/penjumlahan",replace:!0})}),e.jsx(_,{path:"/game/division",element:e.jsx(oe,{to:"/game/pembagian",replace:!0})}),e.jsx(_,{path:"/game/subtraction",element:e.jsx(oe,{to:"/game/pengurangan",replace:!0})}),e.jsx(_,{path:"/game/multiplication",element:e.jsx(oe,{to:"/game/perkalian",replace:!0})}),e.jsx(_,{path:"/materi/addition",element:e.jsx(I,{children:e.jsx(Sa,{})})}),e.jsx(_,{path:"/materi/subtraction",element:e.jsx(I,{children:e.jsx(wa,{})})}),e.jsx(_,{path:"/materi/multiplication",element:e.jsx(I,{children:e.jsx(_a,{})})}),e.jsx(_,{path:"/materi/division",element:e.jsx(I,{children:e.jsx(Ca,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab1_1",element:e.jsx(I,{children:e.jsx(Ia,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab1_2",element:e.jsx(I,{children:e.jsx(Ba,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab1_3",element:e.jsx(I,{children:e.jsx(Ma,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab1_4",element:e.jsx(I,{children:e.jsx(La,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab1_5",element:e.jsx(I,{children:e.jsx(Pa,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab1_6",element:e.jsx(I,{children:e.jsx($a,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab1_7",element:e.jsx(I,{children:e.jsx(Aa,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab2_1",element:e.jsx(I,{children:e.jsx(Da,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab2_2",element:e.jsx(I,{children:e.jsx(Ka,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab2_3",element:e.jsx(I,{children:e.jsx(Oa,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab2_4",element:e.jsx(I,{children:e.jsx(Ea,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab2_5",element:e.jsx(I,{children:e.jsx(Ta,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab2_6",element:e.jsx(I,{children:e.jsx(Fa,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab2_7",element:e.jsx(I,{children:e.jsx(Ja,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab3_1",element:e.jsx(I,{children:e.jsx(za,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab3_2",element:e.jsx(I,{children:e.jsx(Ga,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab3_3",element:e.jsx(I,{children:e.jsx(Ha,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab3_4",element:e.jsx(I,{children:e.jsx(Ra,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab3_5",element:e.jsx(I,{children:e.jsx(Ua,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab3_6",element:e.jsx(I,{children:e.jsx(qa,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab4_1",element:e.jsx(I,{children:e.jsx(Wa,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab4_2",element:e.jsx(I,{children:e.jsx(Va,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab4_3",element:e.jsx(I,{children:e.jsx(Ya,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab4_4",element:e.jsx(I,{children:e.jsx(Qa,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab5_1",element:e.jsx(I,{children:e.jsx(Za,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab5_2",element:e.jsx(I,{children:e.jsx(Xa,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab5_3",element:e.jsx(I,{children:e.jsx(es,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab6_1",element:e.jsx(I,{children:e.jsx(as,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab6_2",element:e.jsx(I,{children:e.jsx(ss,{})})}),e.jsx(_,{path:"/materi/materikelas4/materiBab6_3",element:e.jsx(I,{children:e.jsx(ts,{})})}),e.jsx(_,{path:"/admin/register",element:e.jsx(Pe,{children:e.jsx(sa,{})})}),e.jsx(_,{path:"/guru/dashboard",element:e.jsx(I,{children:e.jsx(Le,{})})}),e.jsx(_,{path:"/tabguru",element:e.jsx(I,{children:e.jsx(Le,{})})}),e.jsx(_,{path:"/admin/dashboard",element:e.jsx(Pe,{children:e.jsx(ta,{})})})]})]})}const Cs=l.createContext(null),Is=({children:i})=>{const[n,r]=l.useState(null),[h,m]=l.useState(!0),[u,c]=l.useState(null);l.useEffect(()=>{const g=async()=>{try{if(!K){console.error("Supabase client not initialized"),m(!1);return}const{data:{user:p}}=await K.auth.getUser();if(p){try{await K.rpc("set_current_user_id",{user_id:p.id})}catch(A){console.error("Error setting current user ID:",A)}r(p)}}catch(p){console.error("Error checking auth state:",p),c(p.message)}finally{m(!1)}};if(!K){console.error("Supabase client not initialized"),m(!1);return}const{data:{subscription:k}}=K.auth.onAuthStateChange(async(p,A)=>{if(A!=null&&A.user){try{await K.rpc("set_current_user_id",{user_id:A.user.id})}catch(L){console.error("Error setting current user ID:",L)}r(A.user)}else r(null);m(!1)});return g(),()=>{k==null||k.unsubscribe()}},[]);const y={user:n,loading:h,error:u,signIn:async(g,k)=>{try{if(!K)throw new Error("Supabase client not initialized");const{data:p,error:A}=await K.auth.signInWithPassword({email:g,password:k});if(A)throw A;return p}catch(p){throw c(p.message),p}},signOut:async()=>{try{if(!K)throw new Error("Supabase client not initialized");const{error:g}=await K.auth.signOut();if(g)throw g;localStorage.clear(),r(null)}catch(g){throw c(g.message),g}}};return e.jsx(Cs.Provider,{value:y,children:i})};console.log("============ DEBUG KONEKSI SUPABASE ============");const Bs=()=>{if(!K)return console.error("[Supabase] Client tidak tersedia"),!1;if(typeof K.from!="function")return console.error("[Supabase] Metode from tidak tersedia pada client"),!1;try{const i=K.from("siswa");return!i||typeof i.select!="function"?(console.error("[Supabase] Metode from tidak mengembalikan objek yang valid"),!1):!0}catch(i){return console.error("[Supabase] Error saat validasi client:",i),!1}};console.log("Supabase client tersedia:",K?"Ya":"Tidak");K&&(console.log("Supabase URL:",K.supabaseUrl),console.log("Supabase Key tersedia:",K.supabaseKey?"Ya":"Tidak"),console.log("Metode yang tersedia:",Object.keys(K).join(", ")),console.log("Validasi client:",Bs()?"Valid":"Tidak valid"));const Ms=Xe.createRoot(document.getElementById("root"));Ms.render(e.jsx(le.StrictMode,{children:e.jsx(Is,{children:e.jsx(_s,{})})}));
