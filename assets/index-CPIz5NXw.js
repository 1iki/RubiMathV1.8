import{u as V,r as o,j as e,c as Me,a as Qe,b as oe,R as Ke,B as ea,d as aa,e as B,N as de,f as sa}from"./vendor-react-NycgNT1J.js";import{s as w,A as ta,D as ia}from"./admin-BY96w3qK.js";import{l as na,M as la,a as ra,b as oa,c as ca,d as da,e as ma,f as ha,g as ua,h as pa,i as ga,j as xa,k as fa,m as ja,n as ba,o as va,p as ya,q as ka,r as Na,s as Sa,t as wa,u as _a,v as Ca,w as Ia,x as Ma,y as Ba,z as La,A as Pa,B as Da,C as Aa,D as $a,E as Ka,F as Ea,G as Oa,H as Ta}from"./materi-EQG7Fcxl.js";import{m as x,A as W}from"./vendor-animation-p0WZj77a.js";import{P as Fa,a as Ja,b as Ra,c as Ga,d as za,e as Ha,f as Ua,K as qa,G as Va,F as Wa,g as Ya,h as Xa,D as Za,M as Qa,A as es,i as as,j as ss,V as ts,k as is,l as ns}from"./games-BY71enND.js";import{$ as Ie}from"./vendor-others-BxSdbvqq.js";import"./vendor-supabase-BtbaGLld.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))r(c);new MutationObserver(c=>{for(const m of c)if(m.type==="childList")for(const u of m.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function s(c){const m={};return c.integrity&&(m.integrity=c.integrity),c.referrerPolicy&&(m.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?m.credentials="include":c.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function r(c){if(c.ep)return;c.ep=!0;const m=s(c);fetch(c.href,m)}})();const ls="/RubimathV1.8/assets/forest-DjXLawl4.jpg",rs="/RubimathV1.8/assets/icon_murid-BYcXkfNK.PNG",os="/RubimathV1.8/assets/icon_guru-DZoOKZhD.png",cs="/RubimathV1.8/assets/icon_wali-sa-vr0rS.png";function ds(){const t=V(),[n,s]=o.useState(!1),[r,c]=o.useState(!1),m=()=>{s(!0)},u=P=>{localStorage.setItem("selectedRole",P),t("/login")},g=()=>{c(!1),localStorage.setItem("selectedRole","admin"),t("/login")};return e.jsxs("div",{className:"main-container",style:{backgroundImage:`url(${ls})`},children:[e.jsxs("div",{className:"overlay",children:[e.jsx("img",{src:na,alt:"Logo",className:"logo"}),e.jsx("button",{className:"admin-login-button",onClick:()=>c(!0),children:"Admin"}),e.jsxs("main",{className:"content",children:[e.jsx(x.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:1},className:"main-title",style:{color:"white"},children:"Siap Jadi Jagoan Matematika?"}),e.jsx(x.h2,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"subtitle",children:"Ayo Temani Rubi Berhitung!"}),e.jsx(x.button,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.5,duration:.5},className:"book-button",onClick:m,children:"MULAI SEKARANG"})]})]}),n&&e.jsx("div",{className:"popup-overlay",children:e.jsxs(x.div,{className:"popup role-selection-popup",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},children:[e.jsx("h2",{children:"Pilih Peran Kamu"}),e.jsxs("div",{className:"role-buttons",children:[e.jsxs("button",{className:"role-button role-siswa",onClick:()=>u("siswa"),children:[e.jsx("div",{className:"role-icon",children:e.jsx("img",{src:rs,alt:"Siswa"})}),e.jsx("span",{children:"Siswa"})]}),e.jsxs("button",{className:"role-button role-guru",onClick:()=>u("guru"),children:[e.jsx("div",{className:"role-icon",children:e.jsx("img",{src:os,alt:"Guru"})}),e.jsx("span",{children:"Guru"})]}),e.jsxs("button",{className:"role-button role-ortu",onClick:()=>u("ortu"),children:[e.jsx("div",{className:"role-icon",children:e.jsx("img",{src:cs,alt:"Orang Tua"})}),e.jsx("span",{children:"Orang Tua"})]})]}),e.jsx("button",{className:"close-popup-button",onClick:()=>s(!1),children:"Kembali"})]})}),r&&e.jsx("div",{className:"popup-overlay",children:e.jsxs(x.div,{className:"popup admin-confirm-popup",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},children:[e.jsx("h2",{children:"Masuk sebagai Admin"}),e.jsx("p",{children:"Anda akan diarahkan ke halaman login admin."}),e.jsxs("div",{className:"admin-confirm-buttons",children:[e.jsx("button",{className:"confirm-button",onClick:g,children:"Lanjutkan"}),e.jsx("button",{className:"close-popup-button",onClick:()=>c(!1),children:"Batal"})]})]})})]})}const le=[{id_siswa:1,nis:"2023001",nama:"Rudi Hartono",id_kelas:1,tanggal_lahir:"2012-03-14",alamat:"Jl. Cemara No.8",id_role:4},{id_siswa:2,nis:"2023002",nama:"Nisa Kurnia",id_kelas:2,tanggal_lahir:"2012-06-21",alamat:"Jl. Melati No.9",id_role:4},{id_siswa:3,nis:"123131",nama:"Fachri Aditya Rizky",id_kelas:1,alamat:"sdfscds",id_role:4}],re=[{id_guru:1,nuptk:"198401232005011001",nama:"Ahmad Fauzi",no_telp:"081234567890",alamat:"Jl. Pendidikan No.1",id_role:2},{id_guru:2,nuptk:"197905152003021002",nama:"Lilis Kusuma",no_telp:"082134567891",alamat:"Jl. Merdeka No.2",id_role:2}],ms={admin:[{username:"budi.setiawan",password:"admin123",type:"superadmin",nama:"Budi Setiawan"},{username:"siti.aminah",password:"pass1234",type:"admin_sekolah",nama:"Siti Aminah"},{username:"dodi.pratama",password:"pass1234",type:"admin_dev",nama:"Dodi Pratama"}]},Le=(t,n,s)=>{let r;switch(s){case"siswa":r=le.find(c=>c.nama===t&&c.nis===n);break;case"guru":r=re.find(c=>c.nama===t&&c.nuptk===n);break}if(!r)throw new Error("Invalid credentials");return{user:r,session:null,isOffline:!0}},hs=async(t,n)=>{try{if(console.log(`[Database] Mencoba login siswa dengan nama: ${t} dan NIS: ${n}`),!w){console.error("[Database] Supabase client tidak tersedia");const s=le.find(r=>r.nama===t&&r.nis===n);if(!s)throw new Error("Siswa tidak ditemukan (offline mode)");return console.log("[Database] Menggunakan data offline:",s),s}if(typeof w.from!="function")if(console.error("[Database] Metode from tidak tersedia pada supabase client"),w.from&&typeof w.from=="function"){console.log("[Database] Mencoba memperbaiki metode from dengan cara alternatif");try{const s=w.from.bind(w),r=s("siswa");if(r&&typeof r.select=="function")console.log("[Database] Metode from berhasil diperbaiki"),w.from=s;else{console.error("[Database] Metode from tidak dapat diperbaiki");const c=le.find(m=>m.nama===t&&m.nis===n);if(!c)throw new Error("Siswa tidak ditemukan (offline mode)");return console.log("[Database] Menggunakan data offline:",c),c}}catch(s){console.error("[Database] Error saat memperbaiki metode from:",s);const r=le.find(c=>c.nama===t&&c.nis===n);if(!r)throw new Error("Siswa tidak ditemukan (offline mode)");return console.log("[Database] Menggunakan data offline:",r),r}}else{const s=le.find(r=>r.nama===t&&r.nis===n);if(!s)throw new Error("Siswa tidak ditemukan (offline mode)");return console.log("[Database] Menggunakan data offline:",s),s}try{console.log("[Database] Mencoba dengan metode Supabase client");const{data:s,error:r}=await w.from("siswa").select(`
          *,
          kelas (
            id_kelas,
            nama_kelas
          )
        `).eq("nama",t).eq("nis",n);if(console.log("[Database] Hasil query Supabase:",{data:s,error:r}),r)throw console.error("[Database] Error dengan metode Supabase client:",r),r;if(!s||s.length===0)throw console.warn("[Database] Tidak ada data siswa yang ditemukan"),new Error("Siswa tidak ditemukan");return console.log("[Database] Login siswa berhasil dengan data:",s[0]),s[0]}catch(s){console.error("[Database] Error dengan Supabase client, mencoba dengan fetch API:",s);try{const c=`${w.supabaseUrl}/rest/v1/siswa?select=*,kelas(id_kelas,nama_kelas)&nama=eq.${encodeURIComponent(t)}&nis=eq.${encodeURIComponent(n)}`;console.log("[Database] Request URL:",c);const m=await fetch(c,{method:"GET",headers:{apikey:w.supabaseKey,Authorization:`Bearer ${w.supabaseKey}`,"Content-Type":"application/json",Accept:"application/json",Prefer:"return=representation"}});if(!m.ok)throw console.error("[Database] HTTP error:",m.status,m.statusText),new Error(`HTTP error! status: ${m.status}`);const u=await m.json();if(console.log("[Database] Data dari fetch API:",u),!u||u.length===0)throw console.warn("[Database] Tidak ada data siswa yang ditemukan dengan fetch API"),new Error("Siswa tidak ditemukan");return console.log("[Database] Login siswa berhasil dengan fetch API:",u[0]),u[0]}catch(r){console.error("[Database] Fetch API error:",r);const c=le.find(m=>m.nama===t&&m.nis===n);if(!c)throw new Error("Siswa tidak ditemukan (offline mode)");return console.log("[Database] Menggunakan data offline sebagai fallback terakhir:",c),c}}}catch(s){throw console.error("[Database] Login siswa error:",s),s}},us=async(t,n)=>{try{if(console.log(`[Database] Mencoba login guru dengan nama: ${t} dan NUPTK: ${n}`),!w){console.error("[Database] Supabase client tidak tersedia");const s=re.find(r=>r.nama===t&&r.nuptk===n);if(!s)throw new Error("Guru tidak ditemukan (offline mode)");return console.log("[Database] Menggunakan data offline:",s),s}if(typeof w.from!="function")if(console.error("[Database] Metode from tidak tersedia pada supabase client"),w.from&&typeof w.from=="function"){console.log("[Database] Mencoba memperbaiki metode from dengan cara alternatif");try{const s=w.from.bind(w),r=s("guru");if(r&&typeof r.select=="function")console.log("[Database] Metode from berhasil diperbaiki"),w.from=s;else{console.error("[Database] Metode from tidak dapat diperbaiki");const c=re.find(m=>m.nama===t&&m.nuptk===n);if(!c)throw new Error("Guru tidak ditemukan (offline mode)");return console.log("[Database] Menggunakan data offline:",c),c}}catch(s){console.error("[Database] Error saat memperbaiki metode from:",s);const r=re.find(c=>c.nama===t&&c.nuptk===n);if(!r)throw new Error("Guru tidak ditemukan (offline mode)");return console.log("[Database] Menggunakan data offline:",r),r}}else{const s=re.find(r=>r.nama===t&&r.nuptk===n);if(!s)throw new Error("Guru tidak ditemukan (offline mode)");return console.log("[Database] Menggunakan data offline:",s),s}try{console.log("[Database] Mencoba dengan metode Supabase client");const{data:s,error:r}=await w.from("guru").select("*").eq("nama",t).eq("nuptk",n).single();if(r)throw console.error("[Database] Error dengan metode Supabase client:",r),r;if(!s)throw console.warn("[Database] Tidak ada data guru yang ditemukan"),new Error("Guru tidak ditemukan");return console.log("[Database] Login guru berhasil dengan data:",s),s}catch(s){console.error("[Database] Error dengan Supabase client, mencoba dengan fetch API:",s);try{const r=`${w.supabaseUrl}/rest/v1/guru?select=*&nama=eq.${encodeURIComponent(t)}&nuptk=eq.${encodeURIComponent(n)}`;console.log("[Database] Request URL:",r);const c=await fetch(r,{headers:{apikey:w.supabaseKey,Authorization:`Bearer ${w.supabaseKey}`,"Content-Type":"application/json",Accept:"application/json"}});if(!c.ok)throw console.error("[Database] HTTP error:",c.status,c.statusText),new Error(`HTTP error! status: ${c.status}`);const m=await c.json();if(console.log("[Database] Data dari fetch API:",m),!m||m.length===0)throw console.warn("[Database] Tidak ada data guru yang ditemukan dengan fetch API"),new Error("Guru tidak ditemukan");return console.log("[Database] Login guru berhasil dengan fetch API:",m[0]),m[0]}catch(r){console.error("[Database] Fetch API error:",r);const c=re.find(m=>m.nama===t&&m.nuptk===n);if(!c)throw new Error("Guru tidak ditemukan (offline mode)");return console.log("[Database] Menggunakan data offline sebagai fallback terakhir:",c),c}}}catch(s){throw console.error("[Database] Login guru error:",s),s}},ps=async(t,n)=>{try{if(console.log(`[Database] Attempting admin login with username: ${t}`),!w)return console.error("[Database] Supabase client not available"),Le(t,n,"admin");try{const{data:s,error:r}=await w.from("admin").select("*").eq("nama",t).single();if(r)throw r.code==="42P17"?(console.error("[Database] Supabase RLS policy error (infinite recursion):",r),new Error("Supabase RLS policy error pada tabel 'admin': infinite recursion. Silakan perbaiki policy di dashboard Supabase.")):(console.error("[Database] Error fetching admin:",r),new Error("Invalid credentials"));if(!s)throw console.warn("[Database] No admin found with provided name"),new Error("Invalid credentials");if(s.password!==n)throw console.warn("[Database] Invalid password"),new Error("Invalid credentials");return console.log("[Database] Admin login successful"),{...s,offline:!1}}catch(s){if(s&&s.message&&s.message.includes("infinite recursion"))throw s;return console.error("[Database] Admin login failed:",s),Le(t,n,"admin")}}catch(s){throw s&&s.message&&s.message.includes("infinite recursion")||console.error("[Database] Admin login error:",s),s}},gs=async(t,n)=>{try{if(console.log(`[Database] Mencoba update avatar siswa dengan ID: ${t} ke avatar: ${n}`),!w)return console.error("[Database] Supabase client tidak tersedia"),console.log("[Database] Fallback ke mode offline untuk update avatar"),{id_siswa:t,avatar:n,offline:!0};if(typeof w.from!="function")if(console.error("[Database] Metode from tidak tersedia pada supabase client"),w.from&&typeof w.from=="function"){console.log("[Database] Mencoba memperbaiki metode from dengan cara alternatif");try{const s=w.from.bind(w),r=s("siswa");if(r&&typeof r.select=="function")console.log("[Database] Metode from berhasil diperbaiki"),w.from=s;else return console.error("[Database] Metode from tidak dapat diperbaiki"),console.log("[Database] Fallback ke mode offline untuk update avatar"),{id_siswa:t,avatar:n,offline:!0}}catch(s){return console.error("[Database] Error saat memperbaiki metode from:",s),console.log("[Database] Fallback ke mode offline untuk update avatar"),{id_siswa:t,avatar:n,offline:!0}}}else return console.log("[Database] Fallback ke mode offline untuk update avatar"),{id_siswa:t,avatar:n,offline:!0};try{console.log("[Database] Mencoba dengan metode Supabase client");const{data:s,error:r}=await w.from("siswa").update({avatar:n}).eq("id_siswa",t).select().single();if(r)throw console.error("[Database] Error dengan metode Supabase client:",r),r;return console.log("[Database] Update avatar berhasil dengan data:",s),s}catch(s){console.error("[Database] Error dengan Supabase client, mencoba dengan fetch API:",s);try{const r=`${w.supabaseUrl}/rest/v1/siswa?id_siswa=eq.${t}`;console.log("[Database] Request URL:",r);const c=await fetch(r,{method:"PATCH",headers:{apikey:w.supabaseKey,Authorization:`Bearer ${w.supabaseKey}`,"Content-Type":"application/json",Prefer:"return=representation"},body:JSON.stringify({avatar:n})});if(!c.ok)throw console.error("[Database] HTTP error:",c.status,c.statusText),new Error(`HTTP error! status: ${c.status}`);const m=await c.json();return console.log("[Database] Data dari fetch API:",m),!m||m.length===0?(console.warn("[Database] Tidak ada data yang dikembalikan dengan fetch API"),{id_siswa:t,avatar:n,offline:!0}):(console.log("[Database] Update avatar berhasil dengan fetch API:",m[0]),m[0])}catch(r){return console.error("[Database] Fetch API error:",r),console.log("[Database] Fallback ke mode offline untuk update avatar setelah semua upaya gagal"),{id_siswa:t,avatar:n,offline:!0}}}}catch(s){return console.error("[Database] Update avatar error:",s),{id_siswa:t,avatar:n,offline:!0}}},xs="/RubimathV1.8/assets/anjing--sHHR2RJ.png",fs="/RubimathV1.8/assets/babi-iuUEe_Y4.png",js="/RubimathV1.8/assets/bebek-yCqPr9No.png",bs="/RubimathV1.8/assets/gurita-BN8Y1DTZ.png",vs="/RubimathV1.8/assets/harimau-DXNXkm5D.png",ys="/RubimathV1.8/assets/kelinci-Db5133_e.png",ks="/RubimathV1.8/assets/kucing-S-jfTbGR.png",Ns="/RubimathV1.8/assets/sapi-H4aliFfW.png",Ss="/RubimathV1.8/assets/serigala-BU2v79sh.png",ws="/RubimathV1.8/assets/singa-gYcf82U9.png",_s=[{name:"Anjing",src:xs},{name:"Babi",src:fs},{name:"Bebek",src:js},{name:"Gurita",src:bs},{name:"Harimau",src:vs},{name:"Kelinci",src:ys},{name:"Kucing",src:ks},{name:"Sapi",src:Ns},{name:"Serigala",src:Ss},{name:"Singa",src:ws}];function Cs(){const[t,n]=o.useState(""),[s,r]=o.useState(""),[c,m]=o.useState(""),[u,g]=o.useState(!1),[P,k]=o.useState(!1),[b,S]=o.useState(null),[h,E]=o.useState(""),[D,I]=o.useState(!1),[v,j]=o.useState(!0),[y,p]=o.useState(0),d=V();o.useEffect(()=>{const f=localStorage.getItem("selectedRole");f?E(f):d("/"),a()},[d]),o.useEffect(()=>{const f=()=>{navigator.onLine?D&&y<3&&a():(I(!0),j(!1))};return window.addEventListener("online",f),window.addEventListener("offline",()=>{I(!0),j(!1)}),f(),()=>{window.removeEventListener("online",f),window.removeEventListener("offline",()=>{I(!0),j(!1)})}},[D,y]);const a=async()=>{try{if(j(!0),!navigator.onLine)return console.log("Browser reports offline"),I(!0),!1;if(!w)return console.error("Supabase client not initialized"),I(!0),!1;try{const{error:f}=await w.from("siswa").select("id_siswa").limit(1);return f?(console.error("Database connection error:",f),I(!0),!1):(I(!1),!0)}catch(f){return console.error("Database test failed:",f),I(!0),!1}}catch(f){return console.error("Connection check error:",f),I(!0),!1}finally{j(!1)}},_=()=>{p(f=>f+1),a()},L=async f=>{if(f.preventDefault(),m(""),g(!0),!h){m("Error: Role tidak terdeteksi"),g(!1);return}try{try{await a()}catch(N){console.error("Error saat memeriksa koneksi:",N),I(!0)}if(D){console.log("Menggunakan mode offline untuk login"),i();return}if(h==="siswa")try{console.log("Mencoba login dengan nama:",t,"dan NIS:",s);const N=await hs(t,s);if(!N){console.error("Tidak ada data yang ditemukan untuk kredensial tersebut"),m("Nama atau NIS siswa salah!"),g(!1);return}console.log("Login berhasil dengan user:",N),localStorage.setItem("userData",JSON.stringify(N)),N.offline&&(I(!0),localStorage.setItem("isOfflineMode","true")),k(!0)}catch(N){console.error("Error during siswa login:",N),console.log("Mencoba fallback ke mode offline setelah error"),i()}else if(h==="guru")try{console.log("Mencoba login guru dengan nama:",t,"dan NUPTK:",s);const N=await us(t,s);if(!N){console.error("Tidak ada data guru yang ditemukan untuk kredensial tersebut"),m("Nama atau NUPTK guru salah!"),g(!1);return}console.log("Login guru berhasil dengan user:",N),localStorage.setItem("userData",JSON.stringify(N)),N.offline&&(I(!0),localStorage.setItem("isOfflineMode","true")),O(null,"guru")}catch(N){console.error("Error during guru login:",N),console.log("Mencoba fallback ke mode offline setelah error"),i()}else if(h==="admin")try{console.log("Attempting admin login with username:",t);const N=await ps(t,s);if(!N){console.error("No admin data found for given credentials"),m("Username atau password admin salah!"),g(!1);return}console.log("Admin login successful with user:",N);const G={nama:N.nama,tipe_admin:N.tipe_admin,id_admin:N.id_admin,username:t};localStorage.setItem("userData",JSON.stringify(G)),N.offline&&(I(!0),localStorage.setItem("isOfflineMode","true")),O(null,"admin")}catch(N){console.error("Error during admin login:",N),console.log("Attempting fallback to offline mode after error"),i()}}catch(N){console.error("Login error:",N),m("Terjadi kesalahan saat login. Silakan coba lagi atau gunakan mode offline."),g(!1),I(!0),i()}},i=()=>{if(h==="siswa"){const f=le.find(G=>G.nama===t&&G.nis===s);if(!f){m("Nama atau NIS siswa salah!"),g(!1);return}const N={...f,offline:!0};localStorage.setItem("userData",JSON.stringify(N)),localStorage.setItem("isOfflineMode","true"),I(!0),k(!0)}else if(h==="guru"){const f=re.find(G=>G.nama===t&&G.nuptk===s);if(!f){m("Nama atau NUPTK guru salah!"),g(!1);return}const N={...f,offline:!0};localStorage.setItem("userData",JSON.stringify(N)),localStorage.setItem("isOfflineMode","true"),I(!0),O(null,"guru")}else if(h==="admin"){const f=ms.admin.find(N=>N.username===t&&N.password===s);if(f){const N={nama:f.nama,tipe_admin:f.type,username:f.username,offline:!0};localStorage.setItem("userData",JSON.stringify(N)),localStorage.setItem("isOfflineMode","true"),I(!0),O(null,"admin")}else m("Username atau password admin salah!"),g(!1)}},$=async f=>{S(f);try{const N=JSON.parse(localStorage.getItem("userData")||"{}");if(N&&N.id_siswa){let G=!0;if(!D)try{const z=await gs(N.id_siswa,f.name);console.log("Avatar update attempt result:",z),z&&!z.error&&(z.offline&&(I(!0),localStorage.setItem("isOfflineMode","true")),N.avatar=z.avatar||f.name,G=!1)}catch(z){console.error("Error updating avatar online:",z)}G&&(N.avatar=f.name),localStorage.setItem("userData",JSON.stringify(N))}O(f,"siswa")}catch(N){console.error("Error during avatar selection:",N),O(f,"siswa")}},O=(f,N)=>{switch(localStorage.setItem("isLoggedIn","true"),localStorage.setItem("userRole",N),localStorage.setItem("isOfflineMode",D.toString()),f&&localStorage.setItem("selectedAvatar",JSON.stringify(f)),N){case"siswa":{const z=JSON.parse(localStorage.getItem("userData")||"{}").id_kelas;d(z===1?"/kelas1":z===2?"/kelas2":z===3?"/kelas3":z===4?"/kelas4":z===5?"/kelas5":z===6?"/kelas6":"/main-siswa");break}case"guru":{d("/guru/dashboard");break}case"ortu":{d("/dashboard-ortu");break}case"admin":{d("/admin/dashboard");break}default:d("/")}},T=()=>{localStorage.removeItem("selectedRole"),d("/")},F=(()=>{switch(h){case"siswa":return{title:"Login Siswa",icon:null};case"guru":return{title:"Login Guru",icon:null};case"ortu":return{title:"Login Orang Tua",icon:null};case"admin":return{title:"Login Admin",icon:null};default:return{title:"Login",icon:null}}})();return e.jsxs("div",{className:"login-container",children:[D&&e.jsxs("div",{className:"offline-indicator",children:["Mode Offline - Data login digunakan dari local storage",e.jsx("button",{className:"retry-button",onClick:_,disabled:v,children:v?"Memeriksa...":"Coba Sambung Ulang"})]}),e.jsx("button",{className:`back-button role-${h}`,onClick:T,children:"Kembali"}),e.jsxs("div",{className:`login-box role-${h}`,children:[e.jsx("div",{className:"login-header",children:e.jsx("h2",{children:F.title})}),P?e.jsxs("div",{className:"avatar-selection",children:[e.jsx("h3",{children:"Pilih Avatar Kamu!"}),e.jsx("div",{className:"avatar-grid",children:_s.map((f,N)=>e.jsxs(x.div,{className:"avatar-option",onClick:()=>$(f),whileHover:{scale:1.1},whileTap:{scale:.9},children:[e.jsx("img",{src:f.src,alt:f.name}),e.jsx("p",{children:f.name})]},N))})]}):e.jsxs("div",{className:"login-form1",children:[F.icon&&e.jsx("div",{className:"role-icon-container",children:e.jsx("img",{src:F.icon,alt:`Icon ${F.title}`,className:"role-icon-large"})}),e.jsxs("form",{onSubmit:L,children:[e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"username",children:h==="siswa"||h==="guru"?"Nama":h==="admin"?"Email":"Username"}),e.jsx("input",{type:"text",id:"username",value:t,onChange:f=>n(f.target.value),required:!0,autoComplete:h==="siswa"?"given-name":h==="guru"?"name":h==="admin"?"email":"username",placeholder:h==="siswa"||h==="guru"?"Masukkan nama":h==="ortu"?"ortu":"Masukkan email admin"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"password",children:h==="siswa"?"Nomor Induk Siswa (NIS)":h==="guru"?"NUPTK":"Password"}),e.jsx("input",{type:h==="siswa"||h==="guru"?"text":"password",id:"password",value:s,onChange:f=>r(f.target.value),required:!0,autoComplete:h==="siswa"||h==="guru"?"username":"current-password",placeholder:h==="siswa"?"Masukkan NIS":h==="guru"?"Masukkan NUPTK":h==="ortu"?"ortu123":"Masukkan password"})]}),c&&e.jsx("div",{className:"error-message",children:c}),e.jsx("button",{type:"submit",className:"login-button",disabled:u,children:u?"Memproses...":"Login"})]})]})]})]})}const Z=[{title:"Bab 1",levels:["Level 1"]},{title:"Bab 2",levels:["Level 1"]},{title:"Bab 3",levels:["Level 1"]}],je=["addition","subtraction","multiplication","division"];function Is(){const[t,n]=o.useState(null),[s,r]=o.useState(0),[c,m]=o.useState(Array(Z.length).fill(0)),[u,g]=o.useState(null),[P,k]=o.useState({completedLevels:0}),[b,S]=o.useState({}),h=V();o.useEffect(()=>{if(!(localStorage.getItem("isLoggedIn")==="true")){h("/login");return}const p=localStorage.getItem("userData"),d=p?JSON.parse(p):null,a=localStorage.getItem("selectedAvatar");if(a){const _=JSON.parse(a);g({..._,displayName:(d==null?void 0:d.nama)||_.name});const L=`avatar_${_.name}_levelScores`;JSON.parse(localStorage.getItem(L));const i=`avatar_${_.name}_operations`,$=JSON.parse(localStorage.getItem(i))||{},O={};let T=0;const J=Array(Z.length).fill(0);Z.forEach((N,G)=>{let z=N.levels.length*je.length,q=0,Y=!1;N.levels.forEach((ee,se)=>{const ae=`bab${G}_level${se}`,X=$[ae]||[];O[ae]=X,X.length===je.length&&T++,q+=X.length,X.length>0&&(Y=!0)}),J[G]=Y?q/z*100:0}),m(J),k({completedLevels:T}),S(O);const F=J.reduce((N,G)=>N+G,0)/Z.length;r(F);const f=`avatar_${_.name}_chapterProgress`;localStorage.setItem(f,JSON.stringify(J))}},[h]);const E=(y,p)=>{localStorage.setItem("currentBabIndex",y),localStorage.setItem("currentLevelIndex",p),h(`/category?chapter=${y}&level=${p}`)},D=()=>{n(null)},I=(y,p)=>{if(!u)return!1;const d=`bab${y}_level${p}`;return b[d]&&b[d].length>0},v=(y,p)=>{if(!u)return 0;const d=`bab${y}_level${p}`;return b[d]?b[d].length/je.length*100:0},j=(y,p,d)=>{if(!u)return!1;const a=`bab${y}_level${p}`;return b[a]&&b[a].includes(d)};return e.jsxs("div",{className:"main-siswa-container",children:[e.jsxs("header",{className:"header-siswa",children:[e.jsx(x.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:"Game Matematika Siswa"}),e.jsxs("div",{className:"profile-section",children:[e.jsx("div",{className:"profile-icon",children:u?e.jsx("img",{src:u.src,alt:u.displayName,className:"avatar-image"}):"👤"}),e.jsxs("div",{className:"progress-info",children:[e.jsxs("p",{children:["Progress"," ",e.jsx("strong",{children:u?u.displayName:"Siswa"}),":"," ",Math.round(s),"%"]}),e.jsxs("p",{children:["Level Selesai:"," ",e.jsx("strong",{children:P.completedLevels})," dari"," ",Z.length*Z[0].levels.length]})]})]})]}),e.jsxs("div",{className:"progress-container",children:[e.jsxs("div",{className:"progress-info",children:[e.jsxs("p",{children:["Progress"," ",e.jsx("strong",{children:u?u.name:"Siswa"}),":"," ",Math.round(s),"%"]}),e.jsxs("p",{children:["Level Selesai:"," ",e.jsx("strong",{children:P.completedLevels})," dari"," ",Z.length*Z[0].levels.length]})]}),e.jsx("div",{className:"progress-bar",children:e.jsx(x.div,{className:"progress",style:{width:`${s}%`},initial:{width:0},animate:{width:`${s}%`},transition:{duration:.8}})})]}),e.jsx("div",{className:"chapter-buttons",children:Z.map((y,p)=>e.jsxs(x.button,{className:"big-chapter-button",onClick:()=>n(p),initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.2*p},children:[y.title,e.jsxs("div",{className:"chapter-progress-indicator",children:[e.jsx("div",{className:"chapter-progress-bar",children:e.jsx("div",{className:"chapter-progress-fill",style:{width:`${c[p]}%`}})}),e.jsxs("span",{children:[Math.round(c[p]),"%"]})]})]},p))}),t!==null&&e.jsx("div",{className:"popup-overlay",children:e.jsxs(x.div,{className:"popup",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},children:[e.jsx("h2",{children:Z[t].title}),e.jsx("div",{className:"popup-progress-bar",children:e.jsx("div",{className:"popup-progress",style:{width:`${c[t]}%`}})}),e.jsxs("p",{className:"progress-text",children:[Math.round(c[t]),"% selesai"]}),e.jsx("div",{className:"levels",children:Z[t].levels.map((y,p)=>e.jsxs("div",{className:"level-container",children:[e.jsxs("button",{className:`level-button ${I(t,p)?"level-completed":""}`,onClick:()=>E(t,p),children:[y,e.jsx("div",{className:"level-progress-bar",children:e.jsx("div",{className:"level-progress-fill",style:{width:`${v(t,p)}%`}})})]}),e.jsx("div",{className:"category-indicators",children:je.map((d,a)=>e.jsx("div",{className:`category-indicator ${j(t,p,d)?"category-completed":""}`,title:`${d} ${j(t,p,d)?"(completed)":"(not completed)"}`,children:j(t,p,d)&&"✓"},a))})]},p))}),e.jsx("button",{className:"close-popup-button",onClick:D,children:"✖ Kembali ke Menu"})]})})]})}function Ms(){const[t,n]=o.useState(null),s=c=>{n(c)},r=()=>{n(null)};return e.jsxs("div",{className:"kategori-container",children:[e.jsx(x.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},className:"kategori-title",children:"Pilih Kategori Anda"}),e.jsx("div",{className:"kategori-grid",children:["Siswa","Guru","Orang Tua"].map((c,m)=>e.jsx(x.div,{className:"kategori-item",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2*m},onClick:()=>s(c),children:e.jsx("h2",{className:"kategori-text",children:c})},c))}),t&&e.jsx("div",{className:"login-popup",children:e.jsxs("div",{className:"login-form",children:[e.jsxs("h2",{children:["Login Sebagai ",t]}),e.jsx("input",{type:"text",placeholder:"Username"}),e.jsx("input",{type:"password",placeholder:"Password"}),e.jsx("button",{children:"Login"}),e.jsx("button",{className:"close-button",onClick:r,children:"Tutup"})]})})]})}function Bs(){const{chapterIndex:t,levelIndex:n}=Me(),[s,r]=o.useState(""),[c,m]=o.useState(0),[u,g]=o.useState(0),[P,k]=o.useState(0),[b,S]=o.useState(!1),[h,E]=o.useState(!1),[D,I]=o.useState([]),[v,j]=o.useState(!1),[y,p]=o.useState([]),d=V(),a={0:{0:[{pertanyaan:"Berapa hasil dari 2 + 2?",jawaban:"4",poin:20},{pertanyaan:"Berapa hasil dari 5 + 3?",jawaban:"8",poin:20},{pertanyaan:"Berapa hasil dari 4 + 6?",jawaban:"10",poin:20},{pertanyaan:"Berapa hasil dari 7 + 2?",jawaban:"9",poin:20},{pertanyaan:"Berapa hasil dari 3 + 8?",jawaban:"11",poin:20}]}},_=()=>{try{if(v){const F=D[u];return a[parseInt(t)][parseInt(n)][F]}else return a[parseInt(t)][parseInt(n)][u]}catch{return{pertanyaan:"Soal tidak tersedia",jawaban:"",poin:0}}},L=()=>{try{return v?D.length:a[parseInt(t)][parseInt(n)].length}catch{return 1}};o.useEffect(()=>{const F=JSON.parse(localStorage.getItem("chapterProgress"))||[];JSON.parse(localStorage.getItem("levelScores")),F&&F[t]&&k(F[t]);const f=a[parseInt(t)][parseInt(n)].length;p(Array(f).fill(null))},[t,n]);const i=F=>{if(F){const f=_().poin||0,N=L(),G=f/(N*20)*100,z=Math.min(P+G,100);k(z);const q=JSON.parse(localStorage.getItem("chapterProgress"))||Array(3).fill(0);q[t]=z,localStorage.setItem("chapterProgress",JSON.stringify(q));const Y=c+f;m(Y);const ee=localStorage.getItem("selectedAvatar");if(ee){const X=JSON.parse(ee),te=`avatar_${X.name}_levelScores`,ce=JSON.parse(localStorage.getItem(te))||{},me=`bab${t}_level${n}`;ce[me]=Y,localStorage.setItem(te,JSON.stringify(ce));const he=`avatar_${X.name}_chapterProgress`,ue=JSON.parse(localStorage.getItem(he))||Array(3).fill(0);ue[t]=z,localStorage.setItem(he,JSON.stringify(ue));const pe=window.location.pathname.split("/"),ge=pe.length>2?pe[2]:"addition",xe=JSON.parse(localStorage.getItem(`${te}_operations`))||{};xe[me]=ge,localStorage.setItem(`${te}_operations`,JSON.stringify(xe)),localStorage.setItem(`${me}_timestamp`,Date.now().toString()),localStorage.setItem("currentOperation",ge),localStorage.setItem("activeCharacter",ee)}const se=JSON.parse(localStorage.getItem("levelScores"))||{},ae=`bab${t}_level${n}`;return se[ae]=Y,localStorage.setItem("levelScores",JSON.stringify(se)),!0}return!1},$=()=>{if(!s.trim()){E(!0),S(!0),setTimeout(()=>{E(!1)},500),setTimeout(()=>{S(!1)},3e3);return}const F=_(),f=s.trim().toLowerCase()===F.jawaban.toLowerCase();if(v){if(f){[...D];const N=D[u],G=[...y];G[N]=!0,p(G)}}else{const N=[...y];N[u]=f,p(N),f||I([...D,u])}i(f),r(""),u<L()-1?g(u+1):D.length>0&&!v?O():T()},O=()=>{const F=`bab${t}_level${n}`;localStorage.setItem("currentLevelKey",F),localStorage.setItem("soalStatus",JSON.stringify(y)),localStorage.setItem("wrongAnswers",JSON.stringify(D)),localStorage.setItem("currentScore",c.toString());const f=L();localStorage.setItem("totalSoal",f.toString()),d(`/hasil-retry/${c}`)},T=()=>{const F=`bab${t}_level${n}`;localStorage.setItem("currentLevelKey",F);const f=L();localStorage.setItem("totalSoal",f.toString()),d(`/hasil/${c}`)},J=F=>{F.key==="Enter"&&$()};return o.useEffect(()=>{if(localStorage.getItem("retryMode")==="true"){const f=JSON.parse(localStorage.getItem("wrongAnswers"))||[],N=JSON.parse(localStorage.getItem("soalStatus"))||[],G=parseInt(localStorage.getItem("currentScore")||"0");j(!0),I(f),p(N),m(G),g(0),localStorage.removeItem("retryMode")}},[]),e.jsxs("div",{className:"game-page",children:[e.jsx("h1",{children:v?"Perbaiki Jawabanmu":"Game Matematika"}),e.jsxs("div",{className:"game-progress-container",children:[e.jsxs("div",{className:"game-progress-label",children:["Progress: ",Math.round(P),"%"]}),e.jsx("div",{className:"game-progress-bar",children:e.jsx("div",{className:"game-progress-fill",style:{width:`${P}%`}})})]}),e.jsxs("div",{className:"soal-info",children:[v?e.jsx("p",{className:"retry-mode",children:"Mode: Perbaikan Jawaban"}):null,e.jsxs("p",{children:["Bab ",parseInt(t)+1,", Level ",parseInt(n)+1]}),e.jsxs("p",{children:["Soal ",u+1," dari ",L(),v?" (yang perlu diperbaiki)":""]}),e.jsxs("p",{children:["Skor: ",c]})]}),e.jsxs(x.div,{className:"soal-container",animate:{scale:h?[1,1.02,.98,1]:1},transition:{duration:.5},children:[e.jsx(x.p,{className:"pertanyaan",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:300,damping:15},children:_().pertanyaan},`${v}-${u}`),e.jsxs("div",{className:"input-container",children:[e.jsx(x.input,{type:"text",value:s,onChange:F=>r(F.target.value),onKeyPress:J,placeholder:v?"Perbaiki jawabanmu...":"Masukkan jawaban...",autoFocus:!0,className:h?"shake-input":"",animate:{border:b?"2px solid #ff3d3d":"2px solid #999"}}),e.jsx(x.button,{onClick:$,whileHover:{scale:1.05},whileTap:{scale:.95},className:v?"retry-button":"",children:v?"Perbaiki":"Jawab"})]}),e.jsx(W,{children:b&&e.jsxs(x.div,{className:"error-message",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{type:"spring",stiffness:500,damping:30},children:[e.jsx("div",{className:"error-icon",children:"❗"}),e.jsx("p",{children:"Oops! Jawaban tidak boleh kosong"}),e.jsx("div",{className:"error-character",children:e.jsx("img",{src:"/src/assets/icon_murid.PNG",alt:"Karakter",className:"error-character-img"})})]})})]}),e.jsxs(x.div,{className:"helper-frame",initial:{x:100,opacity:0},animate:{x:0,opacity:1},transition:{delay:.5,type:"spring",stiffness:100},children:[e.jsx("div",{className:"speech-bubble",children:e.jsx("p",{children:v?"Yuk, perbaiki jawaban yang salah! 🧩":"Ayo jawab pertanyaannya! 🎮"})}),e.jsx("img",{src:v?"/src/assets/harimau.png":"/src/assets/anjing.png",alt:"Karakter Pembantu",className:"helper-character-img"})]})]})}function Ls(){const{score:t}=Me(),n=V(),[s,r]=o.useState({babIndex:0,levelIndex:0,levelKey:""});o.useEffect(()=>{const u=localStorage.getItem("currentLevelKey")||"";if(u){const g=u.match(/bab(\d+)/),P=u.match(/level(\d+)/);g&&P&&r({babIndex:parseInt(g[1]),levelIndex:parseInt(P[1]),levelKey:u})}if(u&&t){const g=localStorage.getItem("selectedAvatar");if(g){const E=JSON.parse(g),D=`avatar_${E.name}_levelScores`,I=localStorage.getItem("currentOperation")||"addition",v=Date.now(),j=`${u}_${I}_${v}`;let y=JSON.parse(localStorage.getItem(D))||{};y[j]=parseInt(t),localStorage.setItem(D,JSON.stringify(y));const p=`avatar_${E.name}_operations`,d=JSON.parse(localStorage.getItem(p))||{};d[j]=I,localStorage.setItem(p,JSON.stringify(d)),localStorage.setItem(`${j}_timestamp`,v.toString());const[a,_]=u.split("_"),L=parseInt(a.replace("bab","")),i=`avatar_${E.name}_chapterProgress`;let $=JSON.parse(localStorage.getItem(i))||Array(3).fill(0);const O=new Set;Object.keys(y).forEach(J=>{const F=J.split("_");F.length>=2&&F[0]===`bab${L}`&&O.add(F[1])});const T=Math.min(O.size/3*100,100);$[L]=T,localStorage.setItem(i,JSON.stringify($))}const P=localStorage.getItem("currentOperation")||"addition",k=Date.now(),b=`${u}_${P}_${k}`;let S=JSON.parse(localStorage.getItem("levelScores"))||{};S[b]=parseInt(t),localStorage.setItem("levelScores",JSON.stringify(S));const h=JSON.parse(localStorage.getItem("chapterProgress"))||[];h.includes(b)||(h.push(b),localStorage.setItem("chapterProgress",JSON.stringify(h)))}if(parseInt(t)>50){const g=document.createElement("div");return g.className="confetti-container",document.body.appendChild(g),()=>{document.body.removeChild(g)}}},[t]);const c=()=>{s.levelIndex<2?n(`/materi/${s.babIndex}/${s.levelIndex+1}`):s.babIndex<2?n(`/materi/${s.babIndex+1}/0`):n("/main-siswa")},m=()=>{const u=parseInt(t),P=(parseInt(localStorage.getItem("totalSoal"))||5)*20,k=u/P*100;return k<=75?"Jangan Menyerah, Coba Lagi Ya!":k>75&&k<=85?"Wah Hebat, Sedikit Lagi Kamu Mencapai Skor Sempurna!":"Wah Hebatt, Pertahankan Ya!"};return e.jsxs(x.div,{className:"hasil-page",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},style:{minHeight:"100vh",width:"100%"},children:[e.jsx(x.h1,{initial:{scale:.5},animate:{scale:1},transition:{type:"spring",stiffness:200,damping:10},children:"🎉 Level Selesai!"}),e.jsxs("p",{children:["Bab ",s.babIndex+1,", Level ",s.levelIndex+1]}),e.jsxs(x.div,{className:"score-display",initial:{scale:.8,rotate:-5},animate:{scale:1,rotate:0},transition:{delay:.3,type:"spring"},children:[e.jsx("p",{className:"score-number",children:t}),e.jsx("p",{className:"score-label",children:"Skor Anda"})]}),e.jsx("p",{className:"score-message",children:m()}),e.jsx("div",{className:"hasil-buttons",children:e.jsx("button",{onClick:c,className:"next-level-button",children:"Level Selanjutnya ➔"})})]})}function Ps(){const t=V(),[n,s]=o.useState({name:"",role:"",avatar:null,id_kelas:null}),[r,c]=o.useState({totalScore:0,completedLevels:0,completedOperations:0,totalOperations:36,highestScore:0,recentActivity:[]}),[m]=o.useState(1),[u]=o.useState(1);o.useEffect(()=>{(async()=>{const h={addition:"Addition",subtraction:"Subtraction",multiplication:"Multiplication",division:"Division"},E=localStorage.getItem("userRole"),D=JSON.parse(localStorage.getItem("selectedAvatar")),I=localStorage.getItem("userKelas"),v=localStorage.getItem("id_siswa"),j=JSON.parse(localStorage.getItem("userData")||"{}");if(!D){t("/login");return}let y=null;if(j&&j.id_siswa)y=j,console.log("Using stored user data:",y);else try{let f=w.from("siswa").select("*");v?(f=f.eq("id_siswa",v),console.log("Searching by id_siswa:",v)):(f=f.ilike("nama",D.name),console.log("Searching by name:",D.name));const{data:N,error:G}=await f.maybeSingle();console.log("Fetched student data:",N),G?console.error("Error fetching siswa:",G):N?(localStorage.setItem("userData",JSON.stringify(N)),localStorage.setItem("userKelas",N.id_kelas.toString()),localStorage.setItem("id_siswa",N.id_siswa.toString()),y=N):(console.log("No student data found"),I&&(y={id_kelas:parseInt(I)}))}catch(f){console.error("Exception fetching siswa:",f),I&&(y={id_kelas:parseInt(I)})}y||(y={id_kelas:2},localStorage.setItem("userKelas","2")),s({name:(j==null?void 0:j.nama)||D.name||"Siswa",role:E||"siswa",avatar:{...D,displayName:(j==null?void 0:j.nama)||D.name},id_kelas:y.id_kelas});let p={};const d=`avatar_${D.name}_levelScores`;p=JSON.parse(localStorage.getItem(d))||{};const a=`avatar_${D.name}_operations`,_=JSON.parse(localStorage.getItem(a))||{};let L=0,i=0,$=0,O=0,T=[];const J={},F=new Set;Object.entries(p).forEach(([f,N])=>{if(N>0){const G=f.split("_");let z,q,Y;if(G.length>=3)z=`${G[0]}_${G[1]}`,q=G[2],Y=G.length>3?G[3]:Date.now().toString();else if(G.length===2)z=f,q=_[f]||"unknown",Y=Date.now().toString();else return;F.add(z),J[z]||(J[z]=[]),J[z].includes(q)||(J[z].push(q),$++),N>O&&(O=N);const[ee,se]=z.split("_"),ae=parseInt(ee.replace("bab",""))+1,X=parseInt(se.replace("level",""))+1,te=h[q]||q,ce=parseInt(localStorage.getItem(`${f}_timestamp`)||Y);T.push({id:f,bab:ae,level:X,title:`Level ${X} ${te}`,score:N,timestamp:ce,operation:q}),L+=N}}),i=F.size,T.sort((f,N)=>N.timestamp-f.timestamp),c({totalScore:L,completedOperations:$,completedLevels:i,totalOperations:36,highestScore:O,recentActivity:T})})()},[t]);const g=()=>Math.round(r.completedOperations/r.totalOperations*100),P=()=>{const S=n.id_kelas;switch(console.log("Navigating based on kelas:",S),S){case 2:t("/kelas2");break;case 4:t("/kelas4");break;case 5:t("/kelas5");break;case 6:t("/kelas6");break;default:t("/main-siswa")}},k=(S,h,E)=>r.recentActivity.filter(D=>D.bab===S&&D.level===h&&D.operation===E),b=S=>{const h=new Date(S);return`${h.getDate()}/${h.getMonth()+1}/${h.getFullYear()}`};return e.jsxs(x.div,{className:"hasil-page skor-page",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[e.jsx("h1",{children:"Progres Belajarmu"}),e.jsxs("div",{className:"profile-info",children:[n.avatar&&e.jsx("div",{className:"avatar-container",children:e.jsx("img",{src:n.avatar.src,alt:"Avatar",className:"user-avatar"})}),e.jsxs("p",{children:["Hai, ",n.avatar?n.avatar.displayName:"Siswa","!"]})]}),e.jsxs("div",{className:"progress-overview",children:[e.jsxs("p",{children:["Total Skor: ",e.jsx("strong",{children:r.totalScore})]}),e.jsxs("p",{children:["Level Mulai Dikerjakan:"," ",e.jsx("strong",{children:r.completedLevels})," dari 9"]}),e.jsxs("p",{children:["Operasi Selesai: ",e.jsx("strong",{children:r.completedOperations})," ","dari ",r.totalOperations]}),e.jsxs("p",{children:["Progres Keseluruhan: ",e.jsxs("strong",{children:[g(),"%"]})]})]}),e.jsxs("div",{className:"skor-progress-container",children:[e.jsx("div",{className:"skor-progress-bar",children:e.jsx("div",{className:"skor-progress-fill",style:{width:`${g()}%`}})}),e.jsxs("p",{className:"progress-percentage",children:[g(),"%"]})]}),e.jsx("div",{className:"achievement-highlight",children:e.jsxs("p",{children:["Skor Tertinggi: ",e.jsx("strong",{children:r.highestScore})]})}),r.recentActivity.length>0?e.jsxs("div",{className:"recent-activities-container",children:[e.jsx("h2",{className:"aktivitas-title",children:"Aktivitas Terakhir"}),e.jsxs("div",{className:"recent-activities-box",children:[e.jsxs("h3",{className:"bab-title",children:["Bab ",m]}),e.jsx("div",{className:"divider"}),e.jsxs("div",{className:"level-container",children:[e.jsxs("h4",{className:"level-title",children:["Level ",u]}),e.jsxs("div",{className:"operations-container",children:[e.jsxs("div",{className:"operation-section",children:[e.jsx("h5",{className:"operation-title",children:"Addition"}),e.jsx("div",{className:"activities-grid",children:k(m,u,"addition").length>0?k(m,u,"addition").map(S=>e.jsxs("div",{className:"activity-white-card",children:[e.jsxs("div",{className:"operation-score",children:["Skor: ",e.jsx("span",{children:S.score})]}),e.jsx("div",{className:"activity-date",children:b(S.timestamp)})]},S.id)):e.jsx("div",{className:"no-activity-message",children:"Belum ada aktivitas Addition"})})]}),e.jsxs("div",{className:"operation-section",children:[e.jsx("h5",{className:"operation-title",children:"Subtraction"}),e.jsx("div",{className:"activities-grid",children:k(m,u,"subtraction").length>0?k(m,u,"subtraction").map(S=>e.jsxs("div",{className:"activity-white-card",children:[e.jsxs("div",{className:"operation-score",children:["Skor: ",e.jsx("span",{children:S.score})]}),e.jsx("div",{className:"activity-date",children:b(S.timestamp)})]},S.id)):e.jsx("div",{className:"no-activity-message",children:"Belum ada aktivitas Subtraction"})})]}),e.jsxs("div",{className:"operation-section",children:[e.jsx("h5",{className:"operation-title",children:"Multiplication"}),e.jsx("div",{className:"activities-grid",children:k(m,u,"multiplication").length>0?k(m,u,"multiplication").map(S=>e.jsxs("div",{className:"activity-white-card",children:[e.jsxs("div",{className:"operation-score",children:["Skor: ",e.jsx("span",{children:S.score})]}),e.jsx("div",{className:"activity-date",children:b(S.timestamp)})]},S.id)):e.jsx("div",{className:"no-activity-message",children:"Belum ada aktivitas Multiplication"})})]}),e.jsxs("div",{className:"operation-section",children:[e.jsx("h5",{className:"operation-title",children:"Division"}),e.jsx("div",{className:"activities-grid",children:k(m,u,"division").length>0?k(m,u,"division").map(S=>e.jsxs("div",{className:"activity-white-card",children:[e.jsxs("div",{className:"operation-score",children:["Skor: ",e.jsx("span",{children:S.score})]}),e.jsx("div",{className:"activity-date",children:b(S.timestamp)})]},S.id)):e.jsx("div",{className:"no-activity-message",children:"Belum ada aktivitas Division"})})]})]})]})]})]}):e.jsxs("div",{className:"recent-activities-container empty-activities",children:[e.jsx("h2",{className:"aktivitas-title",children:"Aktivitas Terakhir"}),e.jsx("div",{className:"empty-message",children:e.jsx("p",{children:"Belum ada aktivitas. Ayo mulai belajar!"})})]}),e.jsx("div",{className:"navigation-buttons",children:e.jsx("button",{onClick:P,className:"menu-button",children:"Kembali ke Menu"})})]})}function Ds(){const{score:t}=Me(),n=V(),[s,r]=o.useState({babIndex:0,levelIndex:0,levelKey:""}),[c,m]=o.useState(0);o.useEffect(()=>{const k=localStorage.getItem("currentLevelKey")||"",b=JSON.parse(localStorage.getItem("wrongAnswers"))||[];if(m(b.length),k){const S=k.match(/bab(\d+)/),h=k.match(/level(\d+)/);S&&h&&r({babIndex:parseInt(S[1]),levelIndex:parseInt(h[1]),levelKey:k})}},[]);const u=()=>{const k=parseInt(t),S=(parseInt(localStorage.getItem("totalSoal"))||5)*20,h=k/S*100;return h<=75?"Jangan Menyerah, Coba Lagi Ya!":h>75&&h<=85?"Wah Hebat, Sedikit Lagi Kamu Mencapai Skor Sempurna!":"Wah Hebatt, Pertahankan Ya!"},g=()=>{localStorage.setItem("retryMode","true"),n(`/game/${s.babIndex}/${s.levelIndex}`)},P=()=>{localStorage.removeItem("retryMode"),localStorage.removeItem("wrongAnswers"),localStorage.removeItem("soalStatus"),n(`/hasil/${t}`)};return e.jsxs(x.div,{className:"hasil-page retry-page",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[e.jsx(x.h1,{initial:{scale:.5},animate:{scale:1},transition:{type:"spring",stiffness:200,damping:10},children:"Ayo Coba Lagi! ✏️"}),e.jsxs("p",{children:["Bab ",s.babIndex+1,", Level ",s.levelIndex+1]}),e.jsxs(x.div,{className:"score-display",initial:{scale:.8,rotate:-5},animate:{scale:1,rotate:0},transition:{delay:.3,type:"spring"},children:[e.jsx("p",{className:"score-number",children:t}),e.jsx("p",{className:"score-label",children:"Skor Saat Ini"})]}),e.jsx("p",{className:"score-message",children:u()}),e.jsxs("div",{className:"retry-info",children:[e.jsxs(x.div,{className:"wrong-answers-count",initial:{x:-50,opacity:0},animate:{x:0,opacity:1},transition:{delay:.5,type:"spring"},children:[e.jsx("p",{className:"wrong-count",children:c}),e.jsx("p",{children:"Soal yang perlu diperbaiki"})]}),e.jsx(x.p,{className:"retry-message",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.7},children:"Beberapa jawaban masih kurang tepat. Mau mencoba lagi soal yang salah saja?"})]}),e.jsxs(x.div,{className:"helper-frame retry-character",initial:{y:50,opacity:0},animate:{y:0,opacity:1},transition:{delay:.9,type:"spring",stiffness:100},style:{alignItems:"flex-end",alignSelf:"flex-end",marginRight:"30px"},children:[e.jsx("div",{className:"speech-bubble",style:{alignSelf:"flex-end"},children:e.jsx("p",{children:"Jangan menyerah! Yuk perbaiki jawabanmu! 😺"})}),e.jsx("img",{src:"/src/assets/kucing.png",alt:"Karakter Kucing",className:"helper-character-img",style:{alignSelf:"flex-end"}})]}),e.jsxs("div",{className:"hasil-buttons",children:[e.jsx("button",{onClick:g,className:"retry-button",children:"Perbaiki Jawaban"}),e.jsx("button",{onClick:P,className:"skip-button",children:"Lanjutkan Saja"})]})]})}const Pe=["addition","subtraction","multiplication","division"],be={addition:"penjumlahan",subtraction:"pengurangan",multiplication:"perkalian",division:"pembagian"},As=()=>{const t=V(),n=Qe(),[s,r]=o.useState([]),[c,m]=o.useState(0),[u,g]=o.useState(0),[P,k]=o.useState(null),[b,S]=o.useState({addition:!1,subtraction:!1,multiplication:!1,division:!1}),[h,E]=o.useState(Pe);o.useEffect(()=>{(()=>{const a=[];for(let _=0;_<15;_++)a.push({id:_,left:`${Math.random()*100}%`,size:`${Math.random()*60+10}px`,delay:`${Math.random()*15}s`,duration:`${Math.random()*10+10}s`});r(a)})();const j=new URLSearchParams(n.search),y=j.get("chapter"),p=j.get("level");if(y!==null&&p!==null)m(parseInt(y)),g(parseInt(p)),localStorage.setItem("currentBabIndex",y),localStorage.setItem("currentLevelIndex",p);else{const a=localStorage.getItem("currentBabIndex"),_=localStorage.getItem("currentLevelIndex");a&&_&&(m(parseInt(a)),g(parseInt(_)))}const d=localStorage.getItem("selectedAvatar");d&&k(JSON.parse(d)),D()},[n]);const D=()=>{const v=localStorage.getItem("selectedAvatar");if(!v)return;const j=JSON.parse(v);k(j);const y=`avatar_${j.name}_operations`,p=JSON.parse(localStorage.getItem(y))||{},d=localStorage.getItem("currentBabIndex"),a=localStorage.getItem("currentLevelIndex"),_=`bab${d}_level${a}`,L={addition:!1,subtraction:!1,multiplication:!1,division:!1};Object.entries(p).forEach(([i,$])=>{i===_&&($==="addition"&&(L.addition=!0),$==="subtraction"&&(L.subtraction=!0),$==="multiplication"&&(L.multiplication=!0),$==="division"&&(L.division=!0))}),S(L),E(Pe)},I=(v,j)=>{j==="materi"?t(`/materi/${v}`):j==="soal"&&(v==="addition"?t("/game/penjumlahan"):v==="subtraction"?t("/game/pengurangan"):v==="multiplication"?t("/game/perkalian"):v==="division"&&t("/game/pembagian"))};return e.jsxs("div",{className:"category-container",children:[s.map(v=>e.jsx("div",{className:"bubble",style:{left:v.left,width:v.size,height:v.size,animationDelay:v.delay,animationDuration:v.duration}},v.id)),e.jsxs("div",{className:"header2",children:[e.jsxs("h1",{children:["Halo ",P?P.name:"Tamu"," ",e.jsx("span",{className:"wave",children:"👋"})]}),e.jsx("p",{children:"Silahkan pilih kategori yang ingin kamu pelajari"}),e.jsxs("p",{className:"level-info",children:["Bab ",c+1," Level ",u+1]})]}),e.jsxs("div",{className:"categories-section",children:[e.jsx("h2",{children:"Kategori"}),e.jsxs("div",{className:"categories-grid",children:[e.jsxs("div",{className:"category-item",children:[e.jsxs("div",{className:`category-circle addition ${b.addition?"completed":""}`,children:[e.jsx("span",{className:"category-symbol",children:"2+2"}),b.addition&&e.jsx("div",{className:"completed-check",children:"✓"})]}),e.jsx("p",{className:"category-name",children:be.addition}),e.jsxs("div",{className:"category-buttons",children:[e.jsx("button",{className:"btn-materi",onClick:()=>I("addition","materi"),children:"Materi"}),e.jsx("button",{className:"btn-soal",onClick:()=>I("addition","soal"),children:"Soal"})]})]}),e.jsxs("div",{className:"category-item",children:[e.jsxs("div",{className:`category-circle substraction ${b.subtraction?"completed":""}`,children:[e.jsx("span",{className:"category-symbol",children:"2-2"}),b.subtraction&&e.jsx("div",{className:"completed-check",children:"✓"})]}),e.jsx("p",{className:"category-name",children:be.subtraction}),e.jsxs("div",{className:"category-buttons",children:[e.jsx("button",{className:"btn-materi",onClick:()=>I("subtraction","materi"),children:"Materi"}),e.jsx("button",{className:"btn-soal",onClick:()=>I("subtraction","soal"),children:"Soal"})]})]}),e.jsxs("div",{className:"category-item",children:[e.jsxs("div",{className:`category-circle division ${b.division?"completed":""}`,children:[e.jsx("span",{className:"category-symbol",children:"10/5"}),b.division&&e.jsx("div",{className:"completed-check",children:"✓"})]}),e.jsx("p",{className:"category-name",children:be.division}),e.jsxs("div",{className:"category-buttons",children:[e.jsx("button",{className:"btn-materi",onClick:()=>I("division","materi"),children:"Materi"}),e.jsx("button",{className:"btn-soal",onClick:()=>I("division","soal"),children:"Soal"})]})]}),e.jsxs("div",{className:"category-item",children:[e.jsxs("div",{className:`category-circle multiplication ${b.multiplication?"completed":""}`,children:[e.jsx("span",{className:"category-symbol",children:"2×2"}),b.multiplication&&e.jsx("div",{className:"completed-check",children:"✓"})]}),e.jsx("p",{className:"category-name",children:be.multiplication}),e.jsxs("div",{className:"category-buttons",children:[e.jsx("button",{className:"btn-materi",onClick:()=>I("multiplication","materi"),children:"Materi"}),e.jsx("button",{className:"btn-soal",onClick:()=>I("multiplication","soal"),children:"Soal"})]})]})]})]})]})},De=async t=>{try{const{data:n,error:s}=await w.from("nilai").select(`
        id_nilai,
        nilai,
        tanggal,
        materi:id_materi (id_materi, nama_materi, kategori)
      `).eq("id_siswa",t);if(s)throw s;return n}catch(n){throw console.error(`Error fetching nilai for siswa ${t}:`,n),n}},$s=async t=>{try{const{data:n,error:s}=await w.from("riwayat_siswa").select(`
        id_riwayat,
        id_siswa,
        id_materi,
        kategori,
        nilai,
        waktu_pengerjaan,
        durasi_pengerjaan,
        jumlah_benar,
        jumlah_salah,
        level_kesulitan,
        selesai,
        keterangan,
        materi:id_materi (id_materi, nama_materi)
      `).eq("id_siswa",t).order("waktu_pengerjaan",{ascending:!1});if(s)throw s;return n}catch(n){throw console.error(`Error fetching riwayat for siswa ${t}:`,n),n}},Ne=async t=>{const n=[{id_materi:101,nama_materi:"Penjumlahan 1-50",kategori:"Bilangan"},{id_materi:102,nama_materi:"Pengurangan 1-50",kategori:"Bilangan"},{id_materi:103,nama_materi:"Perkalian Dasar",kategori:"Bilangan"},{id_materi:104,nama_materi:"Pembagian Dasar",kategori:"Bilangan"},{id_materi:105,nama_materi:"Bangun Datar",kategori:"Geometri"},{id_materi:106,nama_materi:"Bangun Ruang",kategori:"Geometri"},{id_materi:107,nama_materi:"Satuan Panjang",kategori:"Pengukuran"},{id_materi:108,nama_materi:"Satuan Berat",kategori:"Pengukuran"},{id_materi:109,nama_materi:"Satuan Waktu",kategori:"Pengukuran"},{id_materi:110,nama_materi:"Pecahan",kategori:"Bilangan Pecahan"}],s=Math.floor(Math.random()*6)+5,r=[],c=new Date;for(let m=0;m<s;m++){const u=Math.floor(Math.random()*90),g=new Date(c);g.setDate(g.getDate()-u);const P=n[Math.floor(Math.random()*n.length)],k=Math.floor(Math.random()*101);r.push({id_nilai:m+1e3,id_siswa:t,id_materi:P.id_materi,nilai:k,tanggal:g.toISOString().split("T")[0],materi:P})}return r.sort((m,u)=>new Date(u.tanggal)-new Date(m.tanggal)),await new Promise(m=>setTimeout(m,800)),r},Ks=({isOpen:t,onClose:n,student:s})=>{const[r,c]=o.useState([]),[m,u]=o.useState(!0),[g,P]=o.useState(null),[k,b]=o.useState(!1),[S,h]=o.useState("riwayat"),[E,D]=o.useState("semua"),[I,v]=o.useState([]);o.useEffect(()=>{t&&s&&j()},[t,s]);const j=async()=>{try{u(!0),P(null),b(!1),h("riwayat");let d;try{d=await $s(s.id),(!d||d.length===0)&&(h("nilai"),d=await De(s.id),(!d||d.length===0)&&(b(!0),d=await Ne(s.id)))}catch(_){console.warn("Error fetching real history, trying nilai table:",_);try{h("nilai"),d=await De(s.id),(!d||d.length===0)&&(b(!0),d=await Ne(s.id))}catch(L){console.warn("Error fetching from nilai table, using dummy data:",L),b(!0),d=await Ne(s.id)}}let a;S==="riwayat"?a=d:a=d.sort((_,L)=>{const i=_.waktu_pengerjaan?_.waktu_pengerjaan:_.tanggal,$=L.waktu_pengerjaan?L.waktu_pengerjaan:L.tanggal;return new Date($)-new Date(i)}),c(a)}catch(d){console.error("Error fetching student history:",d),P("Gagal memuat riwayat siswa")}finally{u(!1)}};o.useEffect(()=>{if(r.length>0)if(E==="semua")v(r);else{const d=r.filter(a=>{var L;return(a.kategori||((L=a.materi)==null?void 0:L.kategori)||"").toLowerCase()===E.toLowerCase()});v(d)}else v([])},[r,E]);const y=()=>{const d=new Set;return r.forEach(a=>{var L;const _=a.kategori||((L=a.materi)==null?void 0:L.kategori);_&&d.add(_)}),["semua",...Array.from(d)]},p=()=>{let d="Tanggal,Materi,Kategori,Nilai";S==="riwayat"?d+=`,Benar,Salah,Level Kesulitan
`:d+=`
`,I.forEach(i=>{var f,N;const $=i.waktu_pengerjaan?i.waktu_pengerjaan:i.tanggal,O=((f=i.materi)==null?void 0:f.nama_materi)||"-",T=i.kategori||((N=i.materi)==null?void 0:N.kategori)||"-",J=i.nilai||0;let F=`"${new Date($).toLocaleDateString("id-ID")}","${O}","${T}","${J}"`;if(S==="riwayat"){const G=i.jumlah_benar||0,z=i.jumlah_salah||0,q=i.level_kesulitan||"Sedang";F+=`,"${G}","${z}","${q}"`}d+=F+`
`});const a=new Blob([d],{type:"text/csv;charset=utf-8;"}),_=URL.createObjectURL(a),L=document.createElement("a");L.setAttribute("href",_),L.setAttribute("download",`riwayat_${s.name}_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(L),L.click(),document.body.removeChild(L)};return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:["Riwayat Belajar ",(s==null?void 0:s.name)||"Siswa"]}),e.jsx("button",{className:"close-button",onClick:n,children:"×"})]}),e.jsx("div",{className:"modal-body",children:m?e.jsxs("div",{className:"loading",children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Memuat data riwayat..."]}):g?e.jsx("div",{className:"error-message",children:g}):r.length===0?e.jsx("div",{className:"empty-history",children:"Belum ada riwayat belajar untuk siswa ini"}):e.jsxs("div",{className:"history-list",children:[k&&e.jsxs("div",{className:"dummy-data-notice",children:[e.jsx("i",{className:"fas fa-info-circle"})," Menampilkan data contoh. Data asli belum tersedia."]}),!k&&e.jsxs("div",{className:"data-source-info",children:[e.jsx("i",{className:"fas fa-database"}),"Data dari: ",S==="riwayat"?"Riwayat Lengkap":"Nilai Ujian"]}),e.jsxs("div",{className:"filter-section",children:[e.jsx("label",{htmlFor:"filterKategori",children:"Filter Kategori:"}),e.jsx("select",{id:"filterKategori",value:E,onChange:d=>D(d.target.value),children:y().map(d=>e.jsx("option",{value:d,children:d},d))}),e.jsx("button",{className:"export-button",onClick:p,children:"Ekspor ke CSV"})]}),e.jsxs("table",{className:"history-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Tanggal"}),e.jsx("th",{children:"Materi"}),e.jsx("th",{children:"Kategori"}),e.jsx("th",{children:"Nilai"}),"                    ",S==="riwayat"&&e.jsxs(e.Fragment,{children:[e.jsx("th",{children:"Benar"}),e.jsx("th",{children:"Level"})]})]})}),e.jsx("tbody",{children:I.map(d=>{var $,O,T;const a=d.waktu_pengerjaan?d.waktu_pengerjaan:d.tanggal,_=(($=d.materi)==null?void 0:$.nama_materi)||"-",L=d.kategori||((O=d.materi)==null?void 0:O.kategori)||"-",i=d.nilai||0;return e.jsxs("tr",{children:[e.jsx("td",{children:new Date(a).toLocaleDateString("id-ID")}),e.jsx("td",{children:_}),e.jsx("td",{children:L}),e.jsx("td",{className:i>=70?"good-score":"needs-improvement",children:i}),"                        ",S==="riwayat"&&e.jsxs(e.Fragment,{children:[e.jsxs("td",{children:[d.jumlah_benar||0,"/",(d.jumlah_benar||0)+(d.jumlah_salah||0)]}),e.jsx("td",{children:e.jsx("span",{className:`level-${((T=d.level_kesulitan)==null?void 0:T.toLowerCase())||"sedang"}`,children:d.level_kesulitan||"Sedang"})})]})]},d.id_riwayat||d.id_nilai)})})]})]})}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"action-button close",onClick:n,children:"Tutup"})})]})}):null},Es=({isOpen:t,onClose:n,studentId:s,teacherId:r,studentName:c})=>{const[m,u]=o.useState(""),[g,P]=o.useState(!1),[k,b]=o.useState(null),[S,h]=o.useState(!0);o.useEffect(()=>{(async()=>{console.log("Fetching user from localStorage..."),h(!0);const I=localStorage.getItem("isLoggedIn")==="true",v=localStorage.getItem("userRole"),j=localStorage.getItem("userData"),y=j?JSON.parse(j):null;console.log("Login status:",{isLoggedIn:I,userRole:v,userData:y}),!I||v!=="guru"||!y?(console.warn("No valid teacher login session found in localStorage"),b(null)):(console.log("User from localStorage:",y),b(y)),h(!1)})()},[]),o.useEffect(()=>{console.log("Button status:",{loading:g,isUserLoading:S,user:k?"User exists":"No user",teacherId:r,studentId:s})},[g,S,k,r,s]);const E=async D=>{if(D.preventDefault(),S){console.log("User is still loading, preventing submit.");return}if(!k){alert("Anda harus login terlebih dahulu");return}if(!m.trim()){alert("Catatan tidak boleh kosong");return}if(!r){console.error("teacherId tidak diberikan ke ModalCatatan."),alert("Terjadi kesalahan: Informasi guru tidak lengkap.");return}try{P(!0);const I=Ie.local().setZone("Asia/Jakarta"),{data:v,error:j}=await w.from("catatan").insert({id_guru:r,catatan:m.trim(),waktu:I.toISO()}).select().single();if(j)throw console.error("Error membuat catatan:",j),j;const{error:y}=await w.from("siswa_catatan").insert({id_siswa:s,id_catatan:v.id_catatan});if(y)throw console.error("Error membuat relasi:",y),y;alert("Catatan berhasil disimpan"),n(),u("")}catch(I){console.error("Error menyimpan catatan:",I),alert("Terjadi kesalahan saat menyimpan catatan. Silakan coba lagi.")}finally{P(!1)}};return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h3",{children:["Tambah Catatan untuk ",c]}),e.jsx("button",{className:"close-button",onClick:n,children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("form",{onSubmit:E,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"catatan",children:"Catatan:"}),e.jsx("textarea",{id:"catatan",value:m,onChange:D=>u(D.target.value),placeholder:"Tulis catatan untuk siswa...",rows:"5",required:!0})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"cancel-button",onClick:n,disabled:g||S,children:"Batal"}),e.jsx("button",{type:"submit",className:"submit-button",disabled:g||S||!k,children:g?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Menyimpan..."]}):S?"Memuat user...":k?"Simpan Catatan":"Login diperlukan"})]})]})]})}):null},Os=({isOpen:t,onClose:n,student:s,notes:r,onDeleteNote:c})=>{const m=u=>Ie.fromISO(u).setZone("Asia/Jakarta").toLocaleString(Ie.DATETIME_MED_WITH_SECONDS,{locale:"id"});return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Catatan Siswa"}),e.jsx("button",{className:"close-button",onClick:n,children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"student-info",children:[e.jsx("h3",{children:s.name}),e.jsx("p",{className:"student-class",children:s.class})]}),e.jsx("div",{className:"notes-container",children:r&&r.length>0?r.map((u,g)=>e.jsxs("div",{className:"note-item",children:[e.jsx("div",{className:"note-header",children:e.jsx("span",{className:"note-date",children:m(u.waktu)})}),e.jsxs("div",{className:"note-content",children:[e.jsx("p",{className:"note-text",children:u.catatan}),e.jsxs("div",{className:"note-actions",children:[e.jsxs("button",{className:"send-to-parent-button-inline",onClick:()=>alert(`Kirim catatan ID ${u.id_catatan} ke wali`),children:[e.jsx("i",{className:"fas fa-paper-plane"})," Kirim ke wali"]}),e.jsxs("button",{className:"delete-note-button-inline",onClick:()=>c(u.id_catatan),children:[e.jsx("i",{className:"fas fa-trash"})," Hapus Catatan"]})]})]})]},g)):e.jsxs("div",{className:"no-notes",children:[e.jsx("i",{className:"fas fa-info-circle"}),e.jsx("p",{children:"Belum ada catatan untuk siswa ini"})]})}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"close-modal-button",onClick:n,children:"Tutup"})})]})}):null},Ts=({isOpen:t,onClose:n,student:s,onUpdate:r})=>{const[c,m]=o.useState({nama:"",nis:"",tanggal_lahir:"",alamat:"",id_kelas:"",avatar:"",Jenis_Kelamin:"",id_wali:""}),[u,g]=o.useState([]),[P,k]=o.useState(!1),[b,S]=o.useState(null),h=["Anjing","Babi","Bebek","Gurita","Harimau","Kelinci","Kucing","Sapi","Serigala","Singa"];o.useEffect(()=>{var j;s&&m({nama:s.name||"",nis:s.nis||"",tanggal_lahir:s.birthDate||"",alamat:s.address||"",id_kelas:((j=s.class)==null?void 0:j.replace("Kelas ",""))||"",avatar:s.avatar||"",Jenis_Kelamin:s.gender||"",id_wali:s.id_wali||""}),E()},[s]);const E=async()=>{try{const{data:j,error:y}=await w.from("wali").select("id_wali, nama");if(y)throw y;g(j||[])}catch(j){console.error("Error fetching parents:",j),S("Gagal memuat data wali murid")}},D=async j=>{try{const{data:y,error:p}=await w.from("siswa").select("id_siswa").eq("id_wali",j);if(p)throw p;return!(y&&y.length>=3&&!y.some(d=>d.id_siswa===s.id))}catch(y){return console.error("Error checking parent assignments:",y),!1}},I=async j=>{const{name:y,value:p}=j.target;y==="id_wali"&&p&&(await D(p)||alert("Peringatan: Wali murid ini sudah ditautkan dengan 3 siswa lain.")),m(d=>({...d,[y]:p}))},v=async j=>{j.preventDefault(),k(!0),S(null);try{if(c.id_wali&&!await D(c.id_wali)&&!confirm("Wali murid ini sudah ditautkan dengan 3 siswa lain. Apakah Anda yakin ingin melanjutkan?")){k(!1);return}const{error:y}=await w.from("siswa").update({nama:c.nama,nis:c.nis,tanggal_lahir:c.tanggal_lahir,alamat:c.alamat,id_kelas:c.id_kelas,avatar:c.avatar,Jenis_Kelamin:c.Jenis_Kelamin,id_wali:c.id_wali||null}).eq("id_siswa",s.id);if(y)throw y;alert("Data siswa berhasil diperbarui!"),r(),n()}catch(y){console.error("Error updating student:",y),S("Gagal memperbarui data siswa: "+y.message)}finally{k(!1)}};return t?e.jsx("div",{className:"edit-modal-overlay",children:e.jsxs("div",{className:"edit-modal",children:[e.jsxs("div",{className:"edit-modal-header",children:[e.jsx("h2",{children:"Edit Data Siswa"}),e.jsx("button",{className:"close-button",onClick:n,children:"×"})]}),e.jsxs("form",{onSubmit:v,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"nama",children:"Nama Siswa:"}),e.jsx("input",{type:"text",id:"nama",name:"nama",value:c.nama,onChange:I,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"nis",children:"NIS:"}),e.jsx("input",{type:"text",id:"nis",name:"nis",value:c.nis,onChange:I,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"tanggal_lahir",children:"Tanggal Lahir:"}),e.jsx("input",{type:"date",id:"tanggal_lahir",name:"tanggal_lahir",value:c.tanggal_lahir,onChange:I,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"alamat",children:"Alamat:"}),e.jsx("textarea",{id:"alamat",name:"alamat",value:c.alamat,onChange:I,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"id_kelas",children:"Kelas:"}),e.jsx("input",{type:"number",id:"id_kelas",name:"id_kelas",value:c.id_kelas,onChange:I,min:"1",max:"6",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"avatar",children:"Avatar:"}),e.jsxs("select",{id:"avatar",name:"avatar",value:c.avatar,onChange:I,required:!0,children:[e.jsx("option",{value:"",children:"Pilih Avatar"}),h.map(j=>e.jsx("option",{value:j,children:j},j))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"Jenis_Kelamin",children:"Jenis Kelamin:"}),e.jsxs("select",{id:"Jenis_Kelamin",name:"Jenis_Kelamin",value:c.Jenis_Kelamin,onChange:I,required:!0,children:[e.jsx("option",{value:"",children:"Pilih Jenis Kelamin"}),e.jsx("option",{value:"L",children:"Laki-laki"}),e.jsx("option",{value:"P",children:"Perempuan"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"id_wali",children:"Wali Murid:"}),e.jsxs("select",{id:"id_wali",name:"id_wali",value:c.id_wali||"",onChange:I,children:[e.jsx("option",{value:"",children:"Pilih Wali Murid"}),u.map(j=>e.jsx("option",{value:j.id_wali,children:j.nama},j.id_wali))]})]}),b&&e.jsx("div",{className:"error-message",children:b}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"save-button",disabled:P,children:P?"Menyimpan...":"Simpan"}),e.jsx("button",{type:"button",className:"cancel-button",onClick:n,disabled:P,children:"Batal"})]})]})]})}):null},Fs=({isOpen:t,onClose:n,onAdd:s})=>{const[r,c]=o.useState({nama:"",nis:"",tanggal_lahir:"",alamat:"",id_kelas:"",avatar:"",Jenis_Kelamin:"L",id_wali:""}),[m,u]=o.useState([]),[g,P]=o.useState(!1),[k,b]=o.useState(null),S=["Anjing","Babi","Bebek","Gurita","Harimau","Kelinci","Kucing","Sapi","Serigala","Singa"];o.useEffect(()=>{h()},[]);const h=async()=>{try{const{data:v,error:j}=await w.from("wali").select("id_wali, nama");if(j)throw j;u(v||[])}catch(v){console.error("Error fetching parents:",v),b("Gagal memuat data wali murid")}},E=async v=>{try{const{data:j,error:y}=await w.from("siswa").select("id_siswa").eq("id_wali",v);if(y)throw y;return!(j&&j.length>=3)}catch(j){return console.error("Error checking parent assignments:",j),!1}},D=async v=>{const{name:j,value:y}=v.target;j==="id_wali"&&y&&(await E(y)||alert("Peringatan: Wali murid ini sudah ditautkan dengan 3 siswa.")),c(p=>({...p,[j]:y}))},I=async v=>{v.preventDefault(),P(!0),b(null);try{if(r.id_wali&&!await E(r.id_wali)&&!confirm("Wali murid ini sudah ditautkan dengan 3 siswa. Apakah Anda yakin ingin melanjutkan?")){P(!1);return}const{data:j,error:y}=await w.from("siswa").insert({nama:r.nama,nis:r.nis,tanggal_lahir:r.tanggal_lahir,alamat:r.alamat,id_kelas:r.id_kelas,avatar:r.avatar,Jenis_Kelamin:r.Jenis_Kelamin,id_wali:r.id_wali||null,id_role:4}).select().single();if(y)throw y;alert("Siswa baru berhasil ditambahkan!"),s(j),n()}catch(j){console.error("Error adding student:",j),b("Gagal menambahkan siswa: "+j.message)}finally{P(!1)}};return t?e.jsx("div",{className:"edit-modal-overlay",children:e.jsxs("div",{className:"edit-modal",children:[e.jsxs("div",{className:"edit-modal-header",children:[e.jsx("h2",{children:"Tambah Siswa Baru"}),e.jsx("button",{className:"close-button",onClick:n,children:"×"})]}),e.jsxs("form",{onSubmit:I,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"nama",children:"Nama Siswa:"}),e.jsx("input",{type:"text",id:"nama",name:"nama",value:r.nama,onChange:D,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"nis",children:"NIS:"}),e.jsx("input",{type:"text",id:"nis",name:"nis",value:r.nis,onChange:D,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"tanggal_lahir",children:"Tanggal Lahir:"}),e.jsx("input",{type:"date",id:"tanggal_lahir",name:"tanggal_lahir",value:r.tanggal_lahir,onChange:D,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"alamat",children:"Alamat:"}),e.jsx("textarea",{id:"alamat",name:"alamat",value:r.alamat,onChange:D,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"id_kelas",children:"Kelas:"}),e.jsx("input",{type:"number",id:"id_kelas",name:"id_kelas",value:r.id_kelas,onChange:D,min:"1",max:"6",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"avatar",children:"Avatar:"}),e.jsxs("select",{id:"avatar",name:"avatar",value:r.avatar,onChange:D,required:!0,children:[e.jsx("option",{value:"",children:"Pilih Avatar"}),S.map(v=>e.jsx("option",{value:v,children:v},v))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"Jenis_Kelamin",children:"Jenis Kelamin:"}),e.jsxs("select",{id:"Jenis_Kelamin",name:"Jenis_Kelamin",value:r.Jenis_Kelamin,onChange:D,required:!0,children:[e.jsx("option",{value:"L",children:"Laki-laki"}),e.jsx("option",{value:"P",children:"Perempuan"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"id_wali",children:"Wali Murid:"}),e.jsxs("select",{id:"id_wali",name:"id_wali",value:r.id_wali||"",onChange:D,children:[e.jsx("option",{value:"",children:"Pilih Wali Murid"}),m.map(v=>e.jsx("option",{value:v.id_wali,children:v.nama},v.id_wali))]})]}),k&&e.jsx("div",{className:"error-message",children:k}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"save-button",disabled:g,children:g?"Menyimpan...":"Simpan"}),e.jsx("button",{type:"button",className:"cancel-button",onClick:n,disabled:g,children:"Batal"})]})]})]})}):null},Js=({isOpen:t,onClose:n,student:s,availableClasses:r,onConfirm:c,type:m})=>{if(!t)return null;const u=g=>{const P=m==="naik"?`Apakah Anda yakin ingin menaikkan ${s.name} ke ${g}?`:`Apakah Anda yakin ingin memindahkan ${s.name} ke ${g}?`;window.confirm(P)&&c(g)};return e.jsx("div",{className:"edit-modal-overlay",children:e.jsxs("div",{className:"edit-modal",style:{maxWidth:"500px"},children:[e.jsxs("div",{className:"edit-modal-header",style:{background:m==="naik"?"#4CAF50":"#2196F3",color:"white"},children:[e.jsxs("h2",{children:[m==="naik"?"Naik Kelas":"Pindah Kelas"," - ",s.name]}),e.jsx("button",{className:"close-button",onClick:n,children:"×"})]}),e.jsxs("div",{className:"modal-body",style:{padding:"20px"},children:[e.jsx("p",{style:{marginBottom:"15px",fontSize:"16px",color:"#666"},children:m==="naik"?"Pilih kelas tujuan untuk kenaikan kelas:":"Pilih kelas tujuan untuk pindah kelas:"}),e.jsx("div",{className:"class-options",style:{display:"grid",gap:"10px",maxHeight:"300px",overflowY:"auto",padding:"5px"},children:r.map(g=>e.jsxs("button",{onClick:()=>u(g),style:{padding:"12px 15px",border:"1px solid #e0e0e0",borderRadius:"8px",backgroundColor:"#fff",cursor:"pointer",transition:"all 0.2s ease",width:"100%",textAlign:"left",fontSize:"15px",display:"flex",alignItems:"center",gap:"10px"},onMouseOver:P=>{P.target.style.backgroundColor="#f5f5f5",P.target.style.borderColor=m==="naik"?"#4CAF50":"#2196F3"},onMouseOut:P=>{P.target.style.backgroundColor="#fff",P.target.style.borderColor="#e0e0e0"},children:[e.jsx("i",{className:`fas ${m==="naik"?"fa-arrow-up":"fa-exchange-alt"}`,style:{color:m==="naik"?"#4CAF50":"#2196F3"}}),g]},g))})]}),e.jsx("div",{className:"modal-footer",style:{padding:"15px 20px",borderTop:"1px solid #eee",display:"flex",justifyContent:"flex-end",gap:"10px"},children:e.jsx("button",{onClick:n,className:"cancel-button",style:{padding:"8px 20px",borderRadius:"6px",border:"1px solid #ddd",backgroundColor:"white",color:"#666",cursor:"pointer",fontSize:"14px",transition:"all 0.2s ease"},onMouseOver:g=>{g.target.style.backgroundColor="#f5f5f5"},onMouseOut:g=>{g.target.style.backgroundColor="white"},children:"Batal"})})]})})},Ae=()=>{const t=V(),[n,s]=o.useState("daftar"),[r,c]=o.useState(""),[m,u]=o.useState("Semua Kelas"),[g,P]=o.useState([]),[k,b]=o.useState({name:"agung",role:"Guru Matematika",school:"SDN Merdeka 01",email:"siti.rahayu@sdnmerdeka01.sch.id",phone:"+62 812-3456-7890",studentCount:0,kelas:[]}),[S,h]=o.useState(!0),[E,D]=o.useState(null),[I,v]=o.useState({isOpen:!1,student:null}),[j,y]=o.useState([]),[p,d]=o.useState([]),[a,_]=o.useState([]),[L,i]=o.useState([]),[$,O]=o.useState({isOpen:!1,studentId:null,studentName:""}),[T,J]=o.useState({isOpen:!1,student:null,notes:[]}),[F,f]=o.useState({isOpen:!1,student:null}),[N,G]=o.useState({isOpen:!1}),[z,q]=o.useState({isOpen:!1,type:null,student:null,availableClasses:[]});o.useEffect(()=>{(async()=>{try{h(!0);const l=localStorage.getItem("isLoggedIn")==="true",M=localStorage.getItem("userRole"),K=localStorage.getItem("userData"),R=K?JSON.parse(K):null;if(!l||M!=="guru"||!R){console.warn("No valid teacher login session found in localStorage"),alert("Sesi login tidak valid. Silakan login kembali."),t("/login");return}console.log("Current user from localStorage:",R),D(R.id_guru),await Y(R.id_guru)}catch(l){console.error("Error loading user data:",l),alert("Terjadi kesalahan saat memuat data pengguna. Menggunakan data contoh."),b(M=>({...M,kelas:["Kelas 1","Kelas 2","Kelas 3"]}))}finally{h(!1)}})()},[t]),o.useEffect(()=>{k.kelas&&k.kelas.length>0&&(console.log("Teacher classes loaded, fetching students:",k.kelas),ee())},[k.kelas]),o.useEffect(()=>{E&&(async()=>{try{const{data:l,error:M}=await w.from("kelas").select("*").eq("id_guru",E);if(M)throw M;y(l||[]);const{data:K,error:R}=await w.from("siswa").select("*");if(R)throw R;P(K||[]);const{data:H,error:U}=await w.from("catatan").select(`
            *,
            siswa_catatan!inner(*)
          `).eq("id_guru",E);if(U)throw U;d(H||[]);const{data:Q,error:fe}=await w.from("nilai").select("*");if(fe)throw fe;_(Q||[]);const{data:Ze,error:Be}=await w.from("kemajuan").select("*");if(Be)throw Be;i(Ze||[])}catch(l){console.error("Error fetching data:",l),alert("Terjadi kesalahan saat memuat data")}})()},[E]);const Y=async C=>{h(!0);try{const{data:l,error:M}=await w.from("guru").select("*").eq("id_guru",C).single();if(M)throw M;if(l){console.log("Fetched teacher data:",l);let K=[];l.kelas&&(console.log("Raw kelas data:",l.kelas,"Type:",typeof l.kelas),typeof l.kelas=="number"?K=[`Kelas ${l.kelas}`]:typeof l.kelas=="string"&&(K=l.kelas.split(",").map(H=>ae(H.trim())))),K=K.map(H=>ae(H)),K.length===0&&(K=["Kelas 1","Kelas 2","Kelas 3"],console.log("Using default classes as none were found in teacher data")),console.log("Processed teacher classes:",K);let R="Guru Matematika";if(K.length>0)if(K.length===1)R=`Guru Matematika ${K[0]}`;else{const H=K.map(U=>{var Q;return(Q=U.match(/\d+/))==null?void 0:Q[0]}).filter(Boolean).sort((U,Q)=>parseInt(U)-parseInt(Q));H.length>1&&(R=`Guru Matematika Kelas ${H[0]}-${H[H.length-1]}`)}b({name:l.nama||k.name,role:R,school:"SDN Merdeka 01",email:l.email||k.email,phone:l.no_telp||k.phone,kelas:K,studentCount:0})}}catch(l){console.error("Error fetching teacher data:",l),alert("Error fetching teacher data. Using default profile."),b(M=>({...M,kelas:["Kelas 1","Kelas 2","Kelas 3"]}))}finally{h(!1)}},ee=async()=>{h(!0);try{const{data:C,error:l}=await w.from("siswa").select(`
          *,
          wali:id_wali (
            nama
          )
        `);if(l)throw l;if(!C||C.length===0){console.log("No students found in database"),P([]),b(K=>({...K,studentCount:0}));return}const M=C.map(K=>{const R=K.wali!==null;return{id:K.id_siswa,name:K.nama||"Nama tidak tersedia",class:`Kelas ${K.id_kelas}`||"Kelas tidak tersedia",nis:K.nis,birthDate:K.tanggal_lahir,address:K.alamat,gender:K.Jenis_Kelamin,id_wali:K.id_wali,parent:R?K.wali.nama:"Belum ditautkan",parentStatus:R?"linked":"unlinked",avatar:K.avatar,auth_user_id:K.created_at,created_at:K.created_at,updated_at:K.updated_at}});P(M),b(K=>({...K,studentCount:M.length}))}catch(C){console.error("Error fetching students:",C),alert("Error fetching students data. Using sample data instead."),se()}finally{h(!1)}},se=()=>{const C=[];k.kelas.forEach((l,M)=>{const K=l.replace(/\D/g,""),R=K?6+parseInt(K):7;C.push({id:`sample-${M}-1`,name:`Budi ${K||M+1}`,class:l,age:R,parent:M%2===0?"Andi Wijaya":"Belum ditautkan",parentStatus:M%2===0?"linked":"unlinked",avatar:"/src/assets/laki.png"}),C.push({id:`sample-${M}-2`,name:`Ani ${K||M+1}`,class:l,age:R,parent:M%2===1?"Rina Wijayanti":"Belum ditautkan",parentStatus:M%2===1?"linked":"unlinked",avatar:"/src/assets/perempuan.png"})}),P(C),b(l=>({...l,studentCount:C.length}))},ae=C=>{if(!C)return"";const l=String(C).trim();if(/^\d+$/.test(l))return`Kelas ${l}`;if(/^[kK](elas|ls)?\.?\s*\d+[A-Za-z]?$/.test(l))return`Kelas ${l.match(/\d+[A-Za-z]?/)[0]}`;if(l.toLowerCase().includes("kelas")){const M=l.match(/\d+[A-Za-z]?/);return M?`Kelas ${M[0]}`:l.charAt(0).toUpperCase()+l.slice(1).toLowerCase()}return`Kelas ${l}`},X=async()=>{try{const{error:C}=await w.auth.signOut();if(C)throw C;localStorage.removeItem("isLoggedIn"),localStorage.removeItem("userRole"),localStorage.removeItem("userData"),t("/login")}catch(C){console.error("Error logging out:",C),alert("Error logging out. Please try again.")}},te=()=>{G({isOpen:!1})},ce=C=>{const l={id:C.id_siswa,name:C.nama,class:`Kelas ${C.id_kelas}`,nis:C.nis,birthDate:C.tanggal_lahir,address:C.alamat,gender:C.Jenis_Kelamin,id_wali:C.id_wali,parentStatus:C.id_wali?"linked":"unlinked",avatar:C.avatar};P(M=>[...M,l]),b(M=>({...M,studentCount:M.studentCount+1}))},me=()=>{if(!g)return[];let C=[...g];return r&&(C=C.filter(l=>l.name.toLowerCase().includes(r.toLowerCase()))),m!=="Semua Kelas"&&(C=C.filter(l=>l.class===m)),C},he=(C,l)=>{O({isOpen:!0,studentId:C,studentName:l})},ue=C=>{v({isOpen:!0,student:C})},pe=()=>{v({isOpen:!1,student:null})},ge=C=>{alert(`Lihat laporan siswa ID: ${C}`)},xe=async C=>{if(confirm("Apakah Anda yakin ingin menghapus siswa ini?"))try{const{error:l}=await w.from("siswa_catatan").delete().eq("id_siswa",C);l&&console.error("Error menghapus catatan siswa:",l);const{error:M}=await w.from("nilai").delete().eq("id_siswa",C);M&&console.error("Error menghapus nilai siswa:",M);const{error:K}=await w.from("kemajuan").delete().eq("id_siswa",C);K&&console.error("Error menghapus data kemajuan siswa:",K);const{error:R}=await w.from("siswa").delete().eq("id_siswa",C);if(R)throw R;P(g.filter(H=>H.id!==C)),b(H=>({...H,studentCount:H.studentCount-1})),alert("Siswa berhasil dihapus")}catch(l){console.error("Error deleting student:",l),alert("Error deleting student: "+l.message)}},Je=()=>{O({isOpen:!1,studentId:null,studentName:""})},Re=C=>{const l=p.filter(M=>{var K;return((K=M.siswa_catatan[0])==null?void 0:K.id_siswa)===C.id});J({isOpen:!0,student:C,notes:l})},Ge=()=>{J({isOpen:!1,student:null,notes:[]})},ze=async C=>{if(confirm("Apakah Anda yakin ingin menghapus catatan ini?"))try{const{error:l}=await w.from("siswa_catatan").delete().eq("id_catatan",C);if(l)throw l;const{error:M}=await w.from("catatan").delete().eq("id_catatan",C);if(M)throw M;const K=p.filter(R=>R.id_catatan!==C);d(K),J(R=>{if(R.isOpen&&R.student){const H=R.student.id,U=K.filter(Q=>Q.siswa_catatan&&Q.siswa_catatan.length>0&&Q.siswa_catatan.some(fe=>fe.id_siswa===H));return{...R,notes:U}}else return R}),alert("Catatan berhasil dihapus!")}catch(l){console.error("Error deleting note:",l),alert("Gagal menghapus catatan: "+l.message)}},He=async C=>{try{const l=C.class.match(/\d+/)[0];if(parseInt(l)+1>6){alert("Siswa sudah berada di kelas tertinggi");return}const{data:K,error:R}=await w.from("kelas").select("nama_kelas").gt("id_kelas",parseInt(l)).lte("id_kelas",6).order("id_kelas",{ascending:!0});if(R)throw R;if(!K||K.length===0){alert("Tidak ada kelas yang tersedia untuk kenaikan kelas");return}q({isOpen:!0,type:"naik",student:C,availableClasses:K.map(H=>H.nama_kelas)})}catch(l){console.error("Error in handleNaikKelas:",l),alert("Terjadi kesalahan saat memproses kenaikan kelas")}},Ue=async C=>{try{const l=C.class.match(/\d+/)[0],{data:M,error:K}=await w.from("kelas").select("nama_kelas").neq("id_kelas",parseInt(l)).order("id_kelas",{ascending:!0});if(K)throw K;if(!M||M.length===0){alert("Tidak ada kelas lain yang tersedia untuk pemindahan");return}q({isOpen:!0,type:"pindah",student:C,availableClasses:M.map(R=>R.nama_kelas)})}catch(l){console.error("Error in handlePindahKelas:",l),alert("Terjadi kesalahan saat memproses pemindahan kelas")}},qe=async C=>{const l=z.student;C.match(/\d+/)[0];try{const{data:M,error:K}=await w.from("kelas").select("id_kelas").eq("nama_kelas",C).single();if(K)throw K;if(!M)throw new Error("Kelas tidak ditemukan");const{error:R}=await w.from("siswa").update({id_kelas:M.id_kelas,updated_at:new Date().toISOString()}).eq("id_siswa",l.id);if(R)throw R;P(g.map(U=>U.id===l.id?{...U,class:C}:U));const H=z.type==="naik"?"dinaikkan ke":"dipindahkan ke";alert(`${l.name} berhasil ${H} ${C}`),q({isOpen:!1,type:null,student:null,availableClasses:[]})}catch(M){console.error("Error dalam mengubah kelas:",M),alert("Gagal mengubah kelas: "+M.message)}},Ve=()=>{switch(n){case"daftar":const C=me();return e.jsxs("div",{className:"student-list",children:[e.jsxs("div",{className:"search-filter-container",children:[e.jsx("div",{className:"search-bar",children:e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx("i",{className:"fas fa-search search-icon"}),e.jsx("input",{type:"text",id:"search-siswa",name:"search-siswa",placeholder:"Cari siswa...",value:r,onChange:l=>c(l.target.value),className:"search-input"})]})}),e.jsx("div",{className:"filter-actions",style:{display:"flex",alignItems:"center",gap:"10px"},children:e.jsxs("div",{className:"filter-dropdown",style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsxs("select",{id:"filter-kelas",name:"filter-kelas",value:m,onChange:l=>u(l.target.value),className:"filter-select",children:[e.jsx("option",{value:"Semua Kelas",children:"Semua Kelas"}),k.kelas&&k.kelas.sort((l,M)=>{var H,U;const K=parseInt(((H=l.match(/\d+/))==null?void 0:H[0])||0),R=parseInt(((U=M.match(/\d+/))==null?void 0:U[0])||0);return K-R}).map((l,M)=>e.jsx("option",{value:l,children:l},M))]}),e.jsxs("button",{className:"filter-button",children:[e.jsx("i",{className:"fas fa-filter"})," Filter"]}),e.jsxs("button",{className:"add-student-button",onClick:()=>G({isOpen:!0}),style:{backgroundColor:"#4CAF50",color:"white",border:"none",padding:"10px 20px",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",height:"40px"},onMouseOver:l=>{l.target.style.backgroundColor="#45a049",l.target.style.transform="translateY(-1px)",l.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.15)"},onMouseOut:l=>{l.target.style.backgroundColor="#4CAF50",l.target.style.transform="translateY(0)",l.target.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)"},children:[e.jsx("i",{className:"fas fa-plus",style:{fontSize:"14px"}}),"Tambah Siswa"]})]})})]})," ",e.jsx("div",{className:"students-container",children:S?e.jsxs("div",{className:"loading",children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Memuat data siswa..."]}):C.length===0?e.jsx("div",{className:"no-students",children:"Tidak ada siswa yang ditemukan"}):C.map(l=>e.jsxs("div",{className:"student-card",children:[e.jsx("div",{className:"student-avatar",children:e.jsx("img",{src:ke(l),alt:`${l.name} avatar`})})," ",e.jsxs("div",{className:"student-info",children:[e.jsx("h3",{children:l.name}),e.jsxs("p",{children:[l.class," | NIS: ",l.nis]}),e.jsxs("p",{className:"parent-info",children:[e.jsx("span",{className:"parent-label",children:"Wali Murid: "}),l.parentStatus==="linked"?e.jsx("span",{className:"linked",children:l.parent}):e.jsx("span",{className:"unlinked",children:"Belum ditautkan"})]})]})," ","                    ",e.jsxs("div",{className:"student-actions",children:[e.jsxs("button",{className:"action-button edit",onClick:()=>Xe(l),children:[e.jsx("i",{className:"fas fa-edit"})," Edit"]}),e.jsx("button",{className:"action-button tugas",onClick:()=>ue(l),children:"Riwayat"}),e.jsx("button",{className:"action-button hapus",onClick:()=>xe(l.id),children:"Hapus"})]})]},l.id))})," ",e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:"pagination-prev",children:"<"}),e.jsx("button",{className:"pagination-number active",children:"1"}),e.jsx("button",{className:"pagination-number",children:"2"}),e.jsx("button",{className:"pagination-number",children:"3"}),e.jsx("button",{className:"pagination-next",children:">"})]})]});case"kelas":return e.jsxs("div",{className:"student-list",children:[e.jsxs("div",{className:"search-filter-container",children:[e.jsx("div",{className:"search-bar",children:e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx("i",{className:"fas fa-search search-icon"}),e.jsx("input",{type:"text",placeholder:"Cari siswa...",value:r,onChange:l=>c(l.target.value),className:"search-input"})]})}),e.jsxs("div",{className:"filter-dropdown",children:[e.jsxs("select",{value:m,onChange:l=>u(l.target.value),className:"filter-select",children:[e.jsx("option",{value:"Semua Kelas",children:"Semua Kelas"}),k.kelas&&k.kelas.sort((l,M)=>{var H,U;const K=parseInt(((H=l.match(/\d+/))==null?void 0:H[0])||0),R=parseInt(((U=M.match(/\d+/))==null?void 0:U[0])||0);return K-R}).map((l,M)=>e.jsx("option",{value:l,children:l},M))]}),e.jsxs("button",{className:"filter-button",children:[e.jsx("i",{className:"fas fa-filter"})," Filter"]})]})]}),e.jsx("div",{className:"students-container",children:S?e.jsxs("div",{className:"loading",children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Memuat data siswa..."]}):g.filter(l=>(m==="Semua Kelas"||l.class===m)&&(r===""||l.name.toLowerCase().includes(r.toLowerCase()))).length===0?e.jsx("div",{className:"no-students",children:"Tidak ada siswa yang ditemukan"}):g.filter(l=>(m==="Semua Kelas"||l.class===m)&&(r===""||l.name.toLowerCase().includes(r.toLowerCase()))).map(l=>e.jsxs("div",{className:"student-card",children:[e.jsx("div",{className:"student-avatar",children:e.jsx("img",{src:ke(l),alt:`${l.name} avatar`})}),e.jsxs("div",{className:"student-info",children:[e.jsx("h3",{children:l.name}),e.jsxs("p",{children:[l.class," | NIS: ",l.nis]}),e.jsxs("p",{className:"parent-info",children:[e.jsx("span",{className:"parent-label",children:"Wali Murid: "}),l.parentStatus==="linked"?e.jsx("span",{className:"linked",children:l.parent}):e.jsx("span",{className:"unlinked",children:"Belum ditautkan"})]})]}),e.jsxs("div",{className:"student-actions",children:[e.jsxs("button",{className:"action-button naik-kelas",onClick:()=>He(l),style:{backgroundColor:"#4CAF50",color:"white",border:"none",padding:"6px 12px",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"6px",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",marginRight:"8px"},onMouseOver:M=>{M.target.style.backgroundColor="#45a049",M.target.style.transform="translateY(-1px)",M.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.15)"},onMouseOut:M=>{M.target.style.backgroundColor="#4CAF50",M.target.style.transform="translateY(0)",M.target.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)"},children:[e.jsx("i",{className:"fas fa-arrow-up",style:{fontSize:"12px"}}),"Naik Kelas"]}),e.jsxs("button",{className:"action-button pindah-kelas",onClick:()=>Ue(l),style:{backgroundColor:"#2196F3",color:"white",border:"none",padding:"6px 12px",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"6px",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},onMouseOver:M=>{M.target.style.backgroundColor="#1976D2",M.target.style.transform="translateY(-1px)",M.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.15)"},onMouseOut:M=>{M.target.style.backgroundColor="#2196F3",M.target.style.transform="translateY(0)",M.target.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)"},children:[e.jsx("i",{className:"fas fa-exchange-alt",style:{fontSize:"12px"}}),"Pindah Kelas"]})]})]},l.id))})]});case"catatan":return e.jsxs("div",{className:"student-list",children:[e.jsxs("div",{className:"search-filter-container",children:[e.jsx("div",{className:"search-bar",children:e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx("i",{className:"fas fa-search search-icon"}),e.jsx("input",{type:"text",placeholder:"Cari siswa...",value:r,onChange:l=>c(l.target.value),className:"search-input"})]})}),e.jsxs("div",{className:"filter-dropdown",children:[e.jsxs("select",{value:m,onChange:l=>u(l.target.value),className:"filter-select",children:[e.jsx("option",{value:"Semua Kelas",children:"Semua Kelas"}),k.kelas&&k.kelas.sort((l,M)=>{var H,U;const K=parseInt(((H=l.match(/\d+/))==null?void 0:H[0])||0),R=parseInt(((U=M.match(/\d+/))==null?void 0:U[0])||0);return K-R}).map((l,M)=>e.jsx("option",{value:l,children:l},M))]}),e.jsxs("button",{className:"filter-button",children:[e.jsx("i",{className:"fas fa-filter"})," Filter"]})]})]}),e.jsx("div",{className:"students-container",children:S?e.jsxs("div",{className:"loading",children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Memuat data siswa..."]}):g.filter(l=>(m==="Semua Kelas"||l.class===m)&&(r===""||l.name.toLowerCase().includes(r.toLowerCase()))).length===0?e.jsx("div",{className:"no-students",children:"Tidak ada siswa yang ditemukan"}):g.filter(l=>(m==="Semua Kelas"||l.class===m)&&(r===""||l.name.toLowerCase().includes(r.toLowerCase()))).map(l=>e.jsxs("div",{className:"student-card",children:[e.jsx("div",{className:"student-avatar",children:e.jsx("img",{src:ke(l),alt:`${l.name} avatar`})}),e.jsxs("div",{className:"student-info",children:[e.jsx("h3",{children:l.name}),e.jsxs("p",{children:[l.class," | NIS: ",l.nis]}),e.jsxs("p",{className:"parent-info",children:[e.jsx("span",{className:"parent-label",children:"Wali Murid: "}),l.parentStatus==="linked"?e.jsx("span",{className:"linked",children:l.parent}):e.jsx("span",{className:"unlinked",children:"Belum ditautkan"})]})]}),e.jsxs("div",{className:"student-actions",children:[e.jsxs("button",{className:"action-button catatan",onClick:()=>he(l.id,l.name),children:[e.jsx("i",{className:"fas fa-comment-alt"})," Kirim Catatan"]}),e.jsxs("button",{className:"action-button lihat-catatan",onClick:()=>Re(l),children:[e.jsx("i",{className:"fas fa-eye"})," Lihat Catatan"]})]})]},l.id))})]});case"laporan":return e.jsxs("div",{className:"reports",children:[e.jsx("h2",{children:"Laporan"}),e.jsx("div",{className:"report-filters",children:e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Pilih Kelas:"}),e.jsx("select",{value:m||"",onChange:l=>u(parseInt(l.target.value)),children:j.map(l=>e.jsx("option",{value:l.id_kelas,children:l.nama_kelas},l.id_kelas))})]})}),m&&e.jsxs("div",{className:"report-content",children:[e.jsxs("div",{className:"class-summary",children:[e.jsx("h3",{children:"Ringkasan Kelas"}),e.jsxs("div",{className:"summary-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Total Siswa:"}),e.jsx("span",{className:"stat-value",children:g.filter(l=>l.id_kelas===m).length})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Rata-rata Nilai:"}),e.jsx("span",{className:"stat-value",children:calculateClassAverage(m)})]})]})]}),e.jsxs("div",{className:"student-reports",children:[e.jsx("h3",{children:"Laporan Per Siswa"}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nama Siswa"}),e.jsx("th",{children:"Rata-rata Nilai"}),e.jsx("th",{children:"Kemajuan"}),e.jsx("th",{children:"Aksi"})]})}),e.jsx("tbody",{children:g.filter(l=>l.id_kelas===m).map(l=>e.jsxs("tr",{children:[e.jsx("td",{children:l.nama}),e.jsx("td",{children:calculateStudentAverage(l.id_siswa)}),e.jsx("td",{children:getStudentProgress(l.id_siswa)}),e.jsx("td",{children:e.jsxs("button",{onClick:()=>ge(l.id_siswa),children:[e.jsx("i",{className:"fas fa-file-alt"})," Detail"]})})]},l.id_siswa))})]})]})]})]});default:return e.jsx("div",{children:"No content available"})}},ke=C=>{const l={Anjing:"/src/assets/anjing.png",Babi:"/src/assets/babi.png",Bebek:"/src/assets/bebek.png",Gurita:"/src/assets/gurita.png",Harimau:"/src/assets/harimau.png",Kelinci:"/src/assets/kelinci.png",Kucing:"/src/assets/kucing.png",Sapi:"/src/assets/sapi.png",Serigala:"/src/assets/serigala.png",Singa:"/src/assets/singa.png"};return C!=null&&C.avatar&&l[C.avatar]?l[C.avatar]:(C==null?void 0:C.gender)==="P"?"/src/assets/perempuan.png":"/src/assets/laki.png"},We=()=>{ee()},Ye=()=>{f({isOpen:!1,student:null})},Xe=C=>{f({isOpen:!0,student:C})};return e.jsxs("div",{className:"guru-dashboard",children:[" "," ",e.jsxs("header",{className:"header-guru",children:[e.jsxs("div",{className:"logo",children:[e.jsx("i",{className:"fas fa-chalkboard-teacher logo-icon"}),e.jsx("h1",{children:"Math Fun - Dashboard Guru"})]}),e.jsxs("div",{className:"header-actions",children:[e.jsxs("button",{className:"user-mode-button",children:[e.jsx("i",{className:"fas fa-user-friends icon-margin"})," Mode Orang Tua"]}),"x",e.jsxs("button",{className:"logout-button",onClick:X,children:[e.jsx("i",{className:"fas fa-sign-out-alt icon-margin"})," Logout"]})]})]})," "," ",e.jsxs("div",{className:"profile-container",children:[e.jsx("div",{className:"profile-avatar",children:e.jsx("img",{src:"/src/assets/icon_guru.png",alt:"Profile"})}),e.jsx("div",{className:"profile-info",children:S?e.jsxs("div",{className:"loading-profile",children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Memuat data guru..."]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:k.name}),e.jsxs("p",{children:[k.role," - ",k.school]}),e.jsxs("div",{className:"contact-info",children:[e.jsxs("a",{href:`mailto:${k.email}`,className:"email-link",children:[e.jsx("i",{className:"fas fa-envelope"})," ",k.email]}),e.jsxs("a",{href:`tel:${k.phone}`,className:"phone-link",children:[e.jsx("i",{className:"fas fa-phone"})," ",k.phone]}),e.jsxs("span",{className:"student-count",children:[e.jsx("i",{className:"fas fa-user-graduate"})," ",k.studentCount," Siswa"]})]})]})}),e.jsxs("button",{className:"edit-profile-button",children:[e.jsx("i",{className:"fas fa-edit"})," Edit Profil"]})]})," "," ",e.jsxs("nav",{className:"tabs-nav",children:[e.jsxs("button",{className:`tab-button ${n==="daftar"?"active":""}`,onClick:()=>s("daftar"),children:[e.jsx("i",{className:"fas fa-users tab-icon"})," Kelola Siswa"]}),e.jsxs("button",{className:`tab-button ${n==="kelas"?"active":""}`,onClick:()=>s("kelas"),children:[e.jsx("i",{className:"fas fa-chalkboard tab-icon"})," Kelola Kelas"]}),e.jsxs("button",{className:`tab-button ${n==="materi"?"active":""}`,onClick:()=>s("materi"),children:[e.jsx("i",{className:"fas fa-chalkboard tab-icon"})," Kelola Materi"]}),e.jsxs("button",{className:`tab-button ${n==="catatan"?"active":""}`,onClick:()=>s("catatan"),children:[e.jsx("i",{className:"fas fa-comment-alt tab-icon"})," Kirim Catatan"]}),e.jsxs("button",{className:`tab-button ${n==="laporan"?"active":""}`,onClick:()=>s("laporan"),children:[e.jsx("i",{className:"fas fa-chart-bar tab-icon"})," Laporan"]}),"      "]}),e.jsx("div",{className:"tab-content",children:Ve()}),e.jsx(Ks,{isOpen:I.isOpen,onClose:pe,student:I.student}),e.jsx(Es,{isOpen:$.isOpen,onClose:Je,studentId:$.studentId,teacherId:E,studentName:$.studentName}),e.jsx(Os,{isOpen:T.isOpen,onClose:Ge,student:T.student,notes:T.notes,onDeleteNote:ze}),e.jsx(Ts,{isOpen:F.isOpen,onClose:Ye,student:F.student,onUpdate:We}),e.jsx(Fs,{isOpen:N.isOpen,onClose:te,onAdd:ce}),e.jsx(Js,{isOpen:z.isOpen,onClose:()=>q({isOpen:!1,type:null,student:null,availableClasses:[]}),student:z.student,availableClasses:z.availableClasses,onConfirm:qe,type:z.type})]})},Ee="/RubimathV1.8/assets/bronze-C06y5rVm.PNG",Oe="/RubimathV1.8/assets/silver-ByBpWjuQ.PNG",Te="/RubimathV1.8/assets/gold-B99uM-3Z.PNG",Fe="/RubimathV1.8/assets/mainsiswa-CNgKkMeZ.jpg",ie=[{title:"Bab 1",levels:["Level 1"]},{title:"Bab 2",levels:["Level 1"]},{title:"Bab 3",levels:["Level 1"]},{title:"Bab 4",levels:["Level 1"]},{title:"Bab 5",levels:["Level 1"]},{title:"Bab 6",levels:["Level 1"]}];function Rs(){const[t,n]=o.useState(null),[s,r]=o.useState(0),[c,m]=o.useState(Array(ie.length).fill(0)),[u,g]=o.useState(null),[P,k]=o.useState({completedLevels:0}),[b,S]=o.useState({}),h=V();o.useEffect(()=>{if(console.log("MainSiswa2 mounted"),document.body.style.backgroundColor="#ffffff",document.body.style.color="#333333",!(localStorage.getItem("isLoggedIn")==="true")){h("/login");return}const d=localStorage.getItem("userData"),a=d?JSON.parse(d):null,_=localStorage.getItem("selectedAvatar");if(_){const L=JSON.parse(_);g({...L,displayName:(a==null?void 0:a.nama)||L.name});const i=`avatar_${L.name}_levelScores`;JSON.parse(localStorage.getItem(i));let $=0;const O=Array(ie.length).fill(0);m(O),k({completedLevels:$}),S({});const T=O.reduce((F,f)=>F+f,0)/ie.length;r(T);const J=`avatar_${L.name}_chapterProgress`;localStorage.setItem(J,JSON.stringify(O))}else{const L=JSON.parse(localStorage.getItem("chapterProgress"))||Array(ie.length).fill(0);m(L);const i=L.reduce(($,O)=>$+O,0)/ie.length;r(i)}},[h]);const E=p=>{p===0?(localStorage.setItem("currentBabIndex",0),localStorage.setItem("currentLevelIndex",0),h("/category2_bab1")):p===1?(localStorage.setItem("currentBabIndex",1),localStorage.setItem("currentLevelIndex",0),h("/category2_bab2")):p===2?(localStorage.setItem("currentBabIndex",2),localStorage.setItem("currentLevelIndex",0),h("/category2_bab3")):p===3?(localStorage.setItem("currentBabIndex",3),localStorage.setItem("currentLevelIndex",0),h("/category2_bab4")):p===4?(localStorage.setItem("currentBabIndex",4),localStorage.setItem("currentLevelIndex",0),h("/category2_bab5")):p===5?(localStorage.setItem("currentBabIndex",5),localStorage.setItem("currentLevelIndex",0),h("/category2_bab6")):n(p)},D=(p,d)=>{localStorage.setItem("currentBabIndex",p),localStorage.setItem("currentLevelIndex",d),h(`/category?chapter=${p}&level=${d}`)},I=()=>{n(null)},v=()=>{localStorage.removeItem("isLoggedIn"),h("/login")},j=()=>{h("/skor")},y=(p,d)=>{if(!u)return!1;const a=`bab${p}_level${d}`;return b[a]&&b[a].length>0};return e.jsxs("div",{className:"main-siswa-container",style:{color:"#333333",backgroundImage:`url(${Fe})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",position:"relative"},children:[e.jsxs("header",{className:"header-siswa",style:{position:"relative",zIndex:1},children:[" ",e.jsx(x.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},style:{color:"#ff5722",textShadow:"2px 2px 4px rgba(0,0,0,0.5)"},children:"Game Matematika Siswa"}),e.jsxs("div",{className:"profile-section",children:[e.jsx("div",{className:"profile-icon",children:u?e.jsx("img",{src:u.src,alt:u.displayName||u.name,className:"avatar-image"}):"👤"}),e.jsxs("div",{className:"profile-actions",children:[e.jsx("button",{onClick:j,className:"score-button",children:"Lihat Progres"}),e.jsx("button",{onClick:v,className:"logout-button",children:"Keluar"})," "]})]})]}),e.jsxs("div",{className:"progress-container",style:{position:"relative",zIndex:1,backgroundColor:"transparent",padding:"15px"},children:[e.jsxs("div",{className:"progress-info",style:{color:"white"},children:[e.jsxs("p",{children:["Progress"," ",e.jsx("strong",{children:u?u.displayName:"Siswa"}),":"," ",Math.round(s),"%"]}),e.jsxs("p",{children:["Level Selesai: ",e.jsx("strong",{children:P.completedLevels})," dari 9"]})]}),e.jsxs("div",{className:"progress-bar",style:{position:"relative",marginBottom:"20px",width:"90%",margin:"0 auto 30px auto",height:"15px"},children:[" ",e.jsx("div",{style:{position:"absolute",left:"30%",top:-2,bottom:-2,width:"3px",backgroundColor:"#ff5722"}}),e.jsx("div",{style:{position:"absolute",left:"60%",top:-2,bottom:-2,width:"3px",backgroundColor:"#ff5722"}}),e.jsx("div",{style:{position:"absolute",right:"0",top:-2,bottom:-2,width:"3px",backgroundColor:"#ff5722"}}),e.jsx(x.div,{className:"progress",style:{width:`${s}%`},initial:{width:0},animate:{width:`${s}%`},transition:{duration:.8}})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"30px",position:"relative",padding:"0",height:"70px",width:"90%",margin:"0 auto",overflow:"visible"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",position:"absolute",left:"30%",transform:"translateX(-50%)"},children:[" ",e.jsx("img",{src:Ee,alt:"Bronze Badge",style:{width:"60px",height:"60px",marginRight:"10px",opacity:s>=30?"1":"0.4",filter:s>=30?"none":"grayscale(80%)",transition:"all 0.3s ease"}}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontWeight:"bold",fontSize:"0.9rem",textAlign:"left",opacity:s>=30?"1":"0.6"},children:"Bronze"}),e.jsx("p",{style:{margin:"2px 0 0 0",fontSize:"0.8rem",textAlign:"left",color:s>=30?"#ff5722":"#999999"},children:"30%"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",position:"absolute",left:"60%",transform:"translateX(-50%)"},children:[" ",e.jsx("img",{src:Oe,alt:"Silver Badge",style:{width:"60px",height:"60px",marginRight:"10px",opacity:s>=60?"1":"0.4",filter:s>=60?"none":"grayscale(80%)",transition:"all 0.3s ease"}}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontWeight:"bold",fontSize:"0.9rem",textAlign:"left",opacity:s>=60?"1":"0.6"},children:"Silver"}),e.jsx("p",{style:{margin:"2px 0 0 0",fontSize:"0.8rem",textAlign:"left",color:s>=60?"#ff5722":"#999999"},children:"60%"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",position:"absolute",left:"calc(100% - 2px)",transform:"translateX(-50%)"},children:[" ",e.jsx("img",{src:Te,alt:"Gold Badge",style:{width:"60px",height:"60px",marginRight:"10px",opacity:s>=100?"1":"0.4",filter:s>=100?"none":"grayscale(80%)",transition:"all 0.3s ease"}}),e.jsxs("div",{style:{whiteSpace:"nowrap"},children:[e.jsx("p",{style:{margin:0,fontWeight:"bold",fontSize:"0.9rem",textAlign:"left",opacity:s>=100?"1":"0.6"},children:"Gold"}),e.jsx("p",{style:{margin:"2px 0 0 0",fontSize:"0.8rem",textAlign:"left",color:s>=100?"#ff5722":"#999999"},children:"100%"})]})]})]})]}),e.jsx("div",{className:"chapter-buttons",style:{position:"relative",zIndex:1},children:ie.map((p,d)=>e.jsx(x.button,{className:"big-chapter-button",onClick:()=>E(d),initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.2*d},style:{backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white",textShadow:"1px 1px 2px black",padding:"25px 15px 15px",fontSize:"1.5rem",fontWeight:"bold",display:"flex",flexDirection:"column",alignItems:"center"},children:p.title},d))})," ",t!==null&&t!==0&&e.jsx("div",{className:"popup-overlay",style:{zIndex:10,backgroundColor:"rgba(0, 0, 0, 0.7)"},children:e.jsxs(x.div,{className:"popup",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},style:{backgroundColor:"rgba(0, 0, 0, 0.8)",border:"2px solid #ff5722",color:"white"},children:[" ",e.jsx("h2",{children:ie[t].title}),e.jsx("div",{className:"levels",children:ie[t].levels.map((p,d)=>e.jsx("div",{className:"level-container",children:e.jsx("button",{className:`level-button ${y(t,d)?"level-completed":""}`,onClick:()=>D(t,d),children:p})},d))}),e.jsx("button",{className:"close-popup-button",onClick:I,children:"✖ Kembali ke Menu"})]})})]})}const ne=[{title:"Bab 1",levels:["Level 1"]},{title:"Bab 2",levels:["Level 1"]},{title:"Bab 3",levels:["Level 1"]},{title:"Bab 4",levels:["Level 1"]},{title:"Bab 5",levels:["Level 1"]},{title:"Bab 6",levels:["Level 1"]}];function Gs(){const[t,n]=o.useState(null),[s,r]=o.useState(0),[c,m]=o.useState(Array(ne.length).fill(0)),[u,g]=o.useState(null),[P,k]=o.useState({completedLevels:0}),[b,S]=o.useState({}),h=V();o.useEffect(()=>{if(console.log("MainSiswa4 mounted"),document.body.style.backgroundColor="#ffffff",document.body.style.color="#333333",!(localStorage.getItem("isLoggedIn")==="true")){h("/login");return}const d=localStorage.getItem("userData"),a=d?JSON.parse(d):null;if(a&&a.nama)g({name:a.nama});else{console.warn("No user data found in localStorage"),h("/login");return}const _=localStorage.getItem("selectedAvatar");if(_){const L=JSON.parse(_);g({...L,displayName:a.nama});const i=`avatar_${L.name}_levelScores`;JSON.parse(localStorage.getItem(i));let $=0;const O=Array(ne.length).fill(0);m(O),k({completedLevels:$}),S({});const T=O.reduce((F,f)=>F+f,0)/ne.length;r(T);const J=`avatar_${L.name}_chapterProgress`;localStorage.setItem(J,JSON.stringify(O))}else{const L=JSON.parse(localStorage.getItem("chapterProgress"))||Array(ne.length).fill(0);m(L);const i=L.reduce(($,O)=>$+O,0)/ne.length;r(i)}},[h]);const E=p=>{p===0?(localStorage.setItem("currentBabIndex",0),localStorage.setItem("currentLevelIndex",0),h("/category4_bab1")):p===1?(localStorage.setItem("currentBabIndex",1),localStorage.setItem("currentLevelIndex",0),h("/category4_bab2")):p===2?(localStorage.setItem("currentBabIndex",2),localStorage.setItem("currentLevelIndex",0),h("/category4_bab3")):p===3?(localStorage.setItem("currentBabIndex",3),localStorage.setItem("currentLevelIndex",0),h("/category4_bab4")):p===4?(localStorage.setItem("currentBabIndex",4),localStorage.setItem("currentLevelIndex",0),h("/category4_bab5")):p===5?(localStorage.setItem("currentBabIndex",5),localStorage.setItem("currentLevelIndex",0),h("/category4_bab6")):n(p)},D=(p,d)=>{localStorage.setItem("currentBabIndex",p),localStorage.setItem("currentLevelIndex",d),h(`/category?chapter=${p}&level=${d}`)},I=()=>{n(null)},v=()=>{localStorage.removeItem("isLoggedIn"),h("/login")},j=()=>{h("/skor")},y=(p,d)=>{if(!u)return!1;const a=`bab${p}_level${d}`;return b[a]&&b[a].length>0};return e.jsxs("div",{className:"main-siswa-container",style:{color:"#333333",backgroundImage:`url(${Fe})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",position:"relative"},children:[e.jsxs("header",{className:"header-siswa",style:{position:"relative",zIndex:1},children:["        ",e.jsx(x.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},style:{color:"#ff5722",textShadow:"2px 2px 4px rgba(0,0,0,0.5)"},children:"Game Matematika Siswa"}),e.jsxs("div",{className:"profile-section",children:[e.jsx("div",{className:"profile-icon",children:u?e.jsx("img",{src:u.src,alt:u.displayName||u.name,className:"avatar-image"}):"👤"}),e.jsxs("div",{className:"profile-actions",children:[e.jsx("button",{onClick:j,className:"score-button",children:"Lihat Progres"}),e.jsx("button",{onClick:v,className:"logout-button",children:"Keluar"}),"          "]})]})]}),e.jsxs("div",{className:"progress-container",style:{position:"relative",zIndex:1,backgroundColor:"transparent",padding:"15px"},children:[e.jsxs("div",{className:"progress-info",style:{color:"white"},children:[e.jsxs("p",{children:["Progress"," ",e.jsx("strong",{children:u?u.displayName:"Siswa"}),":"," ",Math.round(s),"%"]}),e.jsxs("p",{children:["Level Selesai: ",e.jsx("strong",{children:P.completedLevels})," dari 9"]})]}),e.jsxs("div",{className:"progress-bar",style:{position:"relative",marginBottom:"20px",width:"90%",margin:"0 auto 30px auto",height:"15px"},children:["          ",e.jsx("div",{style:{position:"absolute",left:"30%",top:-2,bottom:-2,width:"3px",backgroundColor:"#ff5722"}}),e.jsx("div",{style:{position:"absolute",left:"60%",top:-2,bottom:-2,width:"3px",backgroundColor:"#ff5722"}}),e.jsx("div",{style:{position:"absolute",right:"0",top:-2,bottom:-2,width:"3px",backgroundColor:"#ff5722"}}),e.jsx(x.div,{className:"progress",style:{width:`${s}%`},initial:{width:0},animate:{width:`${s}%`},transition:{duration:.8}})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"30px",position:"relative",padding:"0",height:"70px",width:"90%",margin:"0 auto",overflow:"visible"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",position:"absolute",left:"30%",transform:"translateX(-50%)"},children:["            ",e.jsx("img",{src:Ee,alt:"Bronze Badge",style:{width:"60px",height:"60px",marginRight:"10px",opacity:s>=30?"1":"0.4",filter:s>=30?"none":"grayscale(80%)",transition:"all 0.3s ease"}}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontWeight:"bold",fontSize:"0.9rem",textAlign:"left",opacity:s>=30?"1":"0.6"},children:"Bronze"}),e.jsx("p",{style:{margin:"2px 0 0 0",fontSize:"0.8rem",textAlign:"left",color:s>=30?"#ff5722":"#999999"},children:"30%"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",position:"absolute",left:"60%",transform:"translateX(-50%)"},children:["            ",e.jsx("img",{src:Oe,alt:"Silver Badge",style:{width:"60px",height:"60px",marginRight:"10px",opacity:s>=60?"1":"0.4",filter:s>=60?"none":"grayscale(80%)",transition:"all 0.3s ease"}}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontWeight:"bold",fontSize:"0.9rem",textAlign:"left",opacity:s>=60?"1":"0.6"},children:"Silver"}),e.jsx("p",{style:{margin:"2px 0 0 0",fontSize:"0.8rem",textAlign:"left",color:s>=60?"#ff5722":"#999999"},children:"60%"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",position:"absolute",left:"calc(100% - 2px)",transform:"translateX(-50%)"},children:["              ",e.jsx("img",{src:Te,alt:"Gold Badge",style:{width:"60px",height:"60px",marginRight:"10px",opacity:s>=100?"1":"0.4",filter:s>=100?"none":"grayscale(80%)",transition:"all 0.3s ease"}}),e.jsxs("div",{style:{whiteSpace:"nowrap"},children:[e.jsx("p",{style:{margin:0,fontWeight:"bold",fontSize:"0.9rem",textAlign:"left",opacity:s>=100?"1":"0.6"},children:"Gold"}),e.jsx("p",{style:{margin:"2px 0 0 0",fontSize:"0.8rem",textAlign:"left",color:s>=100?"#ff5722":"#999999"},children:"100%"})]})]})]})]}),e.jsx("div",{className:"chapter-buttons",style:{position:"relative",zIndex:1},children:ne.map((p,d)=>e.jsx(x.button,{className:"big-chapter-button",onClick:()=>E(d),initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.2*d},style:{backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white",textShadow:"1px 1px 2px black",padding:"25px 15px 15px",fontSize:"1.5rem",fontWeight:"bold",display:"flex",flexDirection:"column",alignItems:"center"},children:p.title},d))}),"      ",t!==null&&t!==0&&e.jsx("div",{className:"popup-overlay",style:{zIndex:10,backgroundColor:"rgba(0, 0, 0, 0.7)"},children:e.jsxs(x.div,{className:"popup",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},style:{backgroundColor:"rgba(0, 0, 0, 0.8)",border:"2px solid #ff5722",color:"white"},children:["            ",e.jsx("h2",{children:ne[t].title}),e.jsx("div",{className:"levels",children:ne[t].levels.map((p,d)=>e.jsx("div",{className:"level-container",children:e.jsx("button",{className:`level-button ${y(t,d)?"level-completed":""}`,onClick:()=>D(t,d),children:p})},d))}),e.jsx("button",{className:"close-popup-button",onClick:I,children:"✖ Kembali ke Menu"})]})})]})}const ve=[{id:1,title:"Level 1",description:"Pengenalan Dasar",icon:"🔢",color:"#FF6B6B",gradient:"linear-gradient(135deg, #FF6B6B, #FF8E8E)",subChapters:[{id:1,title:"Cara Membaca dan Menulis Bilangan Cacah",icon:"📘"},{id:2,title:"Cara Membandingkan dan Mengurutkan Bilangan Cacah Sampai 10.000",icon:"🔢"}],games:[{id:1,title:"Petualangan Bilangan Cacah",path:"/game/kelas4/bab1/level1",icon:"🔢"}]},{id:2,title:"Level 2",description:"Operasi Dasar",icon:"🧮",color:"#4ECDC4",gradient:"linear-gradient(135deg, #4ECDC4, #7EE8FA)",subChapters:[{id:3,title:"Komposisi Bilangan Cacah Sampai 10.000",icon:"➕"},{id:4,title:"Pengurangan Bilangan Cacah Sampai 1.000",icon:"➖"}],games:[{id:2,title:"Tantangan Komposisi & Pengurangan",path:"/game/kelas4/bab1/level2",icon:"🧮"}]},{id:3,title:"Level 3",description:"Geometri Dasar",icon:"📐",color:"#FFD166",gradient:"linear-gradient(135deg, #FFD166, #FFF3B0)",subChapters:[{id:5,title:"Perkalian Bilangan Cacah Sampai 1.000",icon:"✖️"},{id:6,title:"Pembagian Bilangan Cacah Sampai 1.000",icon:"➗"}],games:[{id:5,title:"Latihan Perkalian Dan Pembagian",path:"/game/kelas4/bab1/level3",icon:"🧩"}]},{id:4,title:"Level 4",description:"Bangun Ruang",icon:"🧊",color:"#6A0572",gradient:"linear-gradient(135deg, #6A0572, #AB83A1)",subChapters:[{id:7,title:"Faktor Kelipatan",icon:"🧊"},{id:8,title:"Evaluasi",icon:"📦"}],games:[{id:7,title:"Ayo Latihan!",path:"/game/kelas4/bab1/level4",icon:"🎲"}],locked:!1}];function zs(){const t=V(),[n,s]=o.useState(null),[r,c]=o.useState(!1),[m,u]=o.useState({}),[g,P]=o.useState([]),[k,b]=o.useState(!1),[S,h]=o.useState(!1),E=o.useRef(null),D=Array.from({length:50},(i,$)=>({id:$,size:Math.random()*3+1,left:Math.random()*100,top:Math.random()*100,delay:Math.random()*5,duration:Math.random()*3+2})),I=Array.from({length:6},(i,$)=>({id:$,size:Math.random()*150+100,left:Math.random()*100,top:Math.random()*20+10,speed:Math.random()*100+50,delay:Math.random()*20}));o.useEffect(()=>{if(!(localStorage.getItem("isLoggedIn")==="true")){t("/login");return}const $=JSON.parse(localStorage.getItem("selectedAvatar"));if($){const T=`avatar_${$.name}_bab1_levels_progress`,J=JSON.parse(localStorage.getItem(T))||{};u(J);const F=ve.filter(f=>{var N;return!f.locked&&((N=J[`level_${f.id}`])==null?void 0:N.completed)}).map(f=>f.id);P(F)}const O=setTimeout(()=>{h(!0)},3e3);return()=>clearTimeout(O)},[t]);const v=()=>{Ke({particleCount:100,spread:70,origin:{y:.6}})},j=i=>{if(i.locked){alert("Level ini terkunci! Selesaikan level sebelumnya terlebih dahulu.");return}b(!0),g.includes(i.id)&&v(),s(i),c(!0),h(!1)},y=()=>{const i=ve.find($=>$.id===1);i&&(s(i),c(!0),h(!1),b(!0),g.includes(1)&&v())},p=()=>{c(!1),setTimeout(()=>{s(null),b(!1)},300)},d=i=>{t(`/materi/materikelas4/materiBab1_${i.id}`)},a=i=>{t(i.path)},_=()=>{b(!0),setTimeout(()=>{t("/kelas4")},500)},L=i=>g.includes(i);return e.jsxs("div",{className:`category-container ${k?"animate-bg":""}`,children:[e.jsxs("div",{className:"background-elements",children:[D.map(i=>e.jsx("div",{className:"star",style:{width:i.size+"px",height:i.size+"px",left:i.left+"%",top:i.top+"%",animationDelay:i.delay+"s",animationDuration:i.duration+"s"}},`star-${i.id}`)),I.map(i=>e.jsx("div",{className:"cloud",style:{width:i.size+"px",height:i.size/2+"px",left:i.left+"%",top:i.top+"%",animationDuration:i.speed+"s",animationDelay:i.delay+"s"}},`cloud-${i.id}`))]}),e.jsxs("header",{className:"header animated-header",children:[e.jsxs(x.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:["BAB 1 ",e.jsx("span",{className:"wave",children:"🎓"})]}),e.jsx(x.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3,duration:.6},className:"header-tagline",children:"Pilih level untuk memulai petualangan belajarmu!"})]}),e.jsxs("section",{className:"categories-section",children:[e.jsxs(x.h2,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.7},children:[e.jsx("span",{className:"category-icon",children:"🚀"})," Pilih Level"]}),e.jsx(x.button,{className:"back-button",onClick:_,whileHover:{scale:1.05},whileTap:{scale:.95},initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},children:"Kembali"}),e.jsx(W,{children:S&&e.jsxs(x.div,{className:"hint-bubble",initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8},children:[e.jsx("div",{className:"hint-arrow"}),e.jsx("p",{children:"Klik kartu level untuk mulai belajar!"})]})}),e.jsx("div",{className:"level-path",children:ve.map((i,$)=>e.jsxs(oe.Fragment,{children:[$>0&&e.jsx("div",{className:`path-connector ${g.includes(i.id-1)?"completed-path":""}`,children:g.includes(i.id-1)&&e.jsx("div",{className:"path-progress-animation"})}),e.jsx("div",{className:`path-node ${L(i.id)?"completed-node":""} ${i.locked?"locked-node":""}`,children:i.id})]},`path-${i.id}`))}),e.jsx("div",{className:"level-grid",children:ve.map(i=>e.jsxs(x.div,{className:`level-card ${i.locked?"level-locked":""} ${i.id===1?"level1-card":""}`,onClick:()=>i.id===1?y():j(i),whileHover:i.locked?{}:{scale:1.05,y:-5},whileTap:i.locked?{}:{scale:.95},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*i.id},style:{boxShadow:i.id===1?"0 8px 25px rgba(255, 107, 107, 0.4)":"0 8px 20px rgba(0, 0, 0, 0.15)"},ref:i.id===1?E:null,children:[e.jsxs("div",{className:`level-icon-circle ${L(i.id)?"completed":""}`,style:{background:i.gradient},children:[i.locked&&e.jsx("div",{className:"lock-overlay",children:"🔒"}),L(i.id)&&e.jsx("div",{className:"completed-check",children:"✓"}),e.jsx("span",{className:"level-symbol",children:i.icon})]}),e.jsx("h3",{className:"level-title",children:i.title}),e.jsx("p",{className:"level-description",children:i.description}),e.jsxs("div",{className:"level-info",children:[e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"📚"})," ",i.subChapters.length," Sub Bab"]}),e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"🎮"})," ",i.games.length," Game"]})]}),e.jsx("div",{className:"level-badge",style:{background:i.color},children:i.id})]},i.id))})]}),e.jsx(W,{children:r&&n&&e.jsx(x.div,{className:"popup-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:p,children:e.jsxs(x.div,{className:"level-popup",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{type:"spring",damping:25},style:{background:"linear-gradient(to bottom right, white, #f9f9f9)",borderTop:`5px solid ${n.color}`},onClick:i=>i.stopPropagation(),children:[e.jsx(x.button,{className:"close-popup",onClick:p,initial:{opacity:0},animate:{opacity:1},whileHover:{scale:1.1},whileTap:{scale:.9},transition:{duration:.3,type:"spring",stiffness:300},children:"✕"}),e.jsxs("div",{className:"popup-header",style:{background:n.gradient},children:[e.jsx("div",{className:"popup-level-icon",children:n.icon}),e.jsxs("h2",{children:["Level ",n.id,": ",n.title]})]}),e.jsxs("div",{className:"popup-sections",children:[e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"📚"}),"Sub-Bab Materi"]}),e.jsx("div",{className:"sub-chapter-list",children:n.subChapters.map(i=>e.jsxs(x.div,{className:"sub-chapter-item",onClick:()=>d(i),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"sub-chapter-icon",children:i.icon}),e.jsxs("div",{className:"sub-chapter-content",children:[e.jsx("div",{className:"sub-chapter-number",children:i.id}),e.jsx("h4",{children:i.title})]}),e.jsx("div",{className:"sub-chapter-arrow",children:"→"})]},i.id))})]}),e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"🎮"}),"Game Latihan"]}),e.jsx("div",{className:"game-list",children:n.games.map(i=>e.jsxs(x.div,{className:"game-item",onClick:()=>a(i),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"game-icon",children:i.icon}),e.jsxs("div",{className:"game-content",children:[e.jsx("h4",{children:i.title}),e.jsx("span",{className:"game-label",children:"Main Sekarang"})]}),e.jsx("div",{className:"game-arrow",children:"→"})]},i.id))})]})]}),e.jsx("div",{className:"popup-footer",children:L(n.id)?e.jsxs("div",{className:"level-status completed-status",children:[e.jsx("span",{className:"status-icon",children:"✓"})," Level Selesai"]}):e.jsxs("div",{className:"level-status",children:[e.jsx("span",{className:"status-icon",children:"⏳"})," Belum Selesai"]})})]})})})]})}const ye=[{id:1,title:"Level 1",description:"Pengenalan Operasi Hitung",icon:"🔍",color:"#4E6BFF",gradient:"linear-gradient(135deg, #4E6BFF, #8393FF)",subChapters:[{id:1,title:"Pembilang Satu",icon:"📝"},{id:2,title:"Menyebut Pecahan Yang Penyebutnya Sama",icon:"📊"}],games:[{id:1,title:"Permainan Mencari Pecahan Dan Pembilang",path:"/game/kelas4/bab2/level1",icon:"🎲"}]},{id:2,title:"Level 2",description:"Pengukuran & Pola",icon:"📏",color:"#FF5733",gradient:"linear-gradient(135deg, #FF5733, #FF9A7A)",subChapters:[{id:3,title:"Mengurutkan dan Membandingkan Pecahan",icon:"🧩"},{id:4,title:"Pecahan Senilai",icon:"🔢"}],games:[{id:3,title:"Tantangan Mengurutkan Dan Pecahan Senilai",path:"/game/kelas4/bab2/level2",icon:"🎯"}]},{id:3,title:"Level 3",description:"Operasi Kompleks",icon:"🧮",color:"#9C27B0",gradient:"linear-gradient(135deg, #9C27B0, #D066E2)",subChapters:[{id:5,title:"Pecahan Desimal",icon:"✖️"},{id:6,title:"Pecahan Desimal: Persepuluhan",icon:"➗"}],games:[{id:5,title:"Menghitung Pecahan Desimal Sampai Perespuluhan",path:"/game/kelas4/bab2/level3",icon:"🧩"}]},{id:4,title:"Level 4",description:"Evaluasi & Penerapan",icon:"🏆",color:"#009688",gradient:"linear-gradient(135deg, #009688, #4DB6AC)",subChapters:[{id:7,title:"Pecahan Desimal: Perseratusan dan Persen",icon:"📊"},{id:8,title:"Rangkuman Singkat",icon:"📝"}],games:[{id:7,title:"Game Latihan Pecahan Desimal",path:"/game/kelas4/bab2/level4",icon:"🎮"}],locked:!1}];function Hs(){const t=V(),[n,s]=o.useState(null),[r,c]=o.useState(!1),[m,u]=o.useState({}),[g,P]=o.useState([]),[k,b]=o.useState(!1),[S,h]=o.useState(!1),E=o.useRef(null),D=Array.from({length:50},(i,$)=>({id:$,size:Math.random()*3+1,left:Math.random()*100,top:Math.random()*100,delay:Math.random()*5,duration:Math.random()*3+2})),I=Array.from({length:6},(i,$)=>({id:$,size:Math.random()*150+100,left:Math.random()*100,top:Math.random()*20+10,speed:Math.random()*100+50,delay:Math.random()*20}));o.useEffect(()=>{if(!(localStorage.getItem("isLoggedIn")==="true")){t("/login");return}const $=JSON.parse(localStorage.getItem("selectedAvatar"));if($){const T=`avatar_${$.name}_bab2_levels_progress`,J=JSON.parse(localStorage.getItem(T))||{};u(J);const F=ye.filter(f=>{var N;return!f.locked&&((N=J[`level_${f.id}`])==null?void 0:N.completed)}).map(f=>f.id);P(F)}const O=setTimeout(()=>{h(!0)},3e3);return()=>clearTimeout(O)},[t]);const v=()=>{Ke({particleCount:100,spread:70,origin:{y:.6}})},j=i=>{if(i.locked){alert("Level ini terkunci! Selesaikan level sebelumnya terlebih dahulu.");return}b(!0),g.includes(i.id)&&v(),s(i),c(!0),h(!1)},y=()=>{const i=ye.find($=>$.id===1);i&&(s(i),c(!0),h(!1),b(!0),g.includes(1)&&v())},p=()=>{c(!1),setTimeout(()=>{s(null),b(!1)},300)},d=i=>{i.title==="Pembilang Satu"?t("/materi/materikelas4/materiBab2_1"):i.title==="Menyebut Pecahan Yang Penyebutnya Sama"?t("/materi/materikelas4/materiBab2_2"):i.title==="Mengurutkan dan Membandingkan Pecahan"?t("/materi/materikelas4/materiBab2_3"):i.title==="Pecahan Senilai"?t("/materi/materikelas4/materiBab2_4"):i.title==="Pecahan Desimal"?t("/materi/materikelas4/materiBab2_5"):i.title==="Pecahan Desimal: Persepuluhan"?t("/materi/materikelas4/materiBab2_6"):i.title==="Pecahan Desimal: Perseratusan dan Persen"?t("/materi/materikelas4/materiBab2_7"):t(`/materi/materikelas4/materiBab1_${i.id}`)},a=i=>{t(i.path)},_=()=>{b(!0),setTimeout(()=>{t("/kelas4")},500)},L=i=>g.includes(i);return e.jsxs("div",{className:`category-container ${k?"animate-bg":""}`,children:[e.jsxs("div",{className:"background-elements",children:[D.map(i=>e.jsx("div",{className:"star",style:{width:i.size+"px",height:i.size+"px",left:i.left+"%",top:i.top+"%",animationDelay:i.delay+"s",animationDuration:i.duration+"s"}},`star-${i.id}`)),I.map(i=>e.jsx("div",{className:"cloud",style:{width:i.size+"px",height:i.size/2+"px",left:i.left+"%",top:i.top+"%",animationDuration:i.speed+"s",animationDelay:i.delay+"s"}},`cloud-${i.id}`))]}),e.jsxs("header",{className:"header animated-header",children:[e.jsxs(x.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:["BAB 2 ",e.jsx("span",{className:"wave",children:"🧮"})]}),e.jsx(x.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3,duration:.6},className:"header-tagline",children:"Pilih level untuk memulai perjalanan belajar matematika!"})]}),e.jsxs("section",{className:"categories-section",children:[e.jsxs(x.h2,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.7},children:[e.jsx("span",{className:"category-icon",children:"📚"})," Bab 2: Operasi Hitung"]}),e.jsx(x.button,{className:"back-button",onClick:_,whileHover:{scale:1.05},whileTap:{scale:.95},initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},children:"Kembali"}),e.jsx(W,{children:S&&e.jsxs(x.div,{className:"hint-bubble",initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8},children:[e.jsx("div",{className:"hint-arrow"}),e.jsx("p",{children:"Klik kartu level untuk mulai belajar!"})]})}),e.jsx("div",{className:"level-path",children:ye.map((i,$)=>e.jsxs(oe.Fragment,{children:[$>0&&e.jsx("div",{className:`path-connector ${g.includes(i.id-1)?"completed-path":""}`,children:g.includes(i.id-1)&&e.jsx("div",{className:"path-progress-animation"})}),e.jsx("div",{className:`path-node ${L(i.id)?"completed-node":""} ${i.locked?"locked-node":""}`,onClick:()=>j(i),children:i.id})]},`path-${i.id}`))}),e.jsx("div",{className:"level-grid",children:ye.map(i=>e.jsxs(x.div,{className:`level-card ${i.locked?"level-locked":""} ${i.id===1?"level1-card":""}`,onClick:()=>i.id===1?y():j(i),whileHover:i.locked?{}:{scale:1.05,y:-5},whileTap:i.locked?{}:{scale:.95},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*i.id},style:{boxShadow:i.id===1?"0 8px 25px rgba(78, 107, 255, 0.4)":"0 8px 20px rgba(0, 0, 0, 0.15)"},ref:i.id===1?E:null,children:[e.jsxs("div",{className:`level-icon-circle ${L(i.id)?"completed":""} ${i.id===1?"level1-icon":""}`,style:{background:i.gradient},children:[i.locked&&e.jsx("div",{className:"lock-overlay",children:"🔒"}),L(i.id)&&e.jsx("div",{className:"completed-check",children:"✓"}),e.jsx("span",{className:"level-symbol",children:i.icon})]}),e.jsx("h3",{className:"level-title",children:i.title}),e.jsx("p",{className:"level-description",children:i.description}),e.jsxs("div",{className:"level-info",children:[e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"📚"})," ",i.subChapters.length," Sub Bab"]}),e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"🎮"})," ",i.games.length," Game"]})]}),e.jsx("div",{className:"level-badge",style:{background:i.color},children:i.id})]},i.id))})]}),e.jsx(W,{children:r&&n&&e.jsx(x.div,{className:"popup-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:p,children:e.jsxs(x.div,{className:"level-popup",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{type:"spring",damping:25},style:{background:"linear-gradient(to bottom right, white, #f9f9f9)",borderTop:`5px solid ${n.color}`},onClick:i=>i.stopPropagation(),children:[e.jsx(x.button,{className:"close-popup",onClick:p,initial:{opacity:0},animate:{opacity:1},whileHover:{scale:1.1},whileTap:{scale:.9},transition:{duration:.3,type:"spring",stiffness:300},children:"✕"}),e.jsxs("div",{className:"popup-header",style:{background:n.gradient},children:[e.jsx("div",{className:"popup-level-icon",children:n.icon}),e.jsxs("h2",{children:["Level ",n.id,": ",n.title]})]}),e.jsxs("div",{className:"popup-sections",children:[e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"📚"}),"Sub-Bab Materi"]}),e.jsx("div",{className:"sub-chapter-list",children:n.subChapters.map(i=>e.jsxs(x.div,{className:"sub-chapter-item",onClick:()=>d(i),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"sub-chapter-icon",children:i.icon}),e.jsxs("div",{className:"sub-chapter-content",children:[e.jsx("div",{className:"sub-chapter-number",children:i.id}),e.jsx("h4",{children:i.title})]}),e.jsx("div",{className:"sub-chapter-arrow",children:"→"})]},i.id))})]}),e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"🎮"}),"Game Latihan"]}),e.jsx("div",{className:"game-list",children:n.games.map(i=>e.jsxs(x.div,{className:"game-item",onClick:()=>a(i),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"game-icon",children:i.icon}),e.jsxs("div",{className:"game-content",children:[e.jsx("h4",{children:i.title}),e.jsx("span",{className:"game-label",children:"Main Sekarang"})]}),e.jsx("div",{className:"game-arrow",children:"→"})]},i.id))})]})]}),e.jsx("div",{className:"popup-footer",children:L(n.id)?e.jsxs("div",{className:"level-status completed-status",children:[e.jsx("span",{className:"status-icon",children:"✓"})," Level Selesai"]}):e.jsxs("div",{className:"level-status",children:[e.jsx("span",{className:"status-icon",children:"⏳"})," Belum Selesai"]})})]})})})]})}const Se=[{id:1,title:"Level 1",description:"Pengenalan Pola Gambar",icon:"🏠",color:"#3F51B5",gradient:"linear-gradient(135deg, #3F51B5, #7986CB)",subChapters:[{id:1,title:"Pola Gambar",icon:"🧊"},{id:2,title:"Pola Gambar Membesar",icon:"📦"},{id:3,title:"Pola Gambar Mengecil",icon:"🔷"}],games:[{id:1,title:"Yuk Coba Gamenya!",path:"/game/kelas4/bab3/level1",icon:"🎲"}]},{id:2,title:"Level 2",description:"Pengenalan Pola Bilangan",icon:"📐",color:"#4CAF50",gradient:"linear-gradient(135deg, #4CAF50, #81C784)",subChapters:[{id:4,title:"Pola Bilangan",icon:"🎯"},{id:5,title:"Pola Bilangan Membesar",icon:"📊"},{id:6,title:"Pola Bilangan Mengecil",icon:"🔢"}],games:[{id:2,title:"Yuk Coba Gamenya!",path:"/game/kelas4/bab3/level2",icon:"⚡"}]}];function Us(){const t=V(),[n,s]=o.useState(null),[r,c]=o.useState(!1),[m,u]=o.useState({}),[g,P]=o.useState([]),[k,b]=o.useState(!1),[S,h]=o.useState(!1),E=Array.from({length:50},(a,_)=>({id:_,size:Math.random()*3+1,left:Math.random()*100,top:Math.random()*100,delay:Math.random()*5,duration:Math.random()*3+2})),D=Array.from({length:6},(a,_)=>({id:_,size:Math.random()*150+100,left:Math.random()*100,top:Math.random()*20+10,speed:Math.random()*100+50,delay:Math.random()*20}));o.useEffect(()=>{if(!(localStorage.getItem("isLoggedIn")==="true")){t("/login");return}const _=JSON.parse(localStorage.getItem("selectedAvatar"));if(_){const i=`avatar_${_.name}_levels_progress`,$=JSON.parse(localStorage.getItem(i))||{};u($);const O=Se.filter(T=>{var J;return!T.locked&&((J=$[`level_${T.id}`])==null?void 0:J.completed)}).map(T=>T.id);P(O)}const L=setTimeout(()=>{h(!0)},3e3);return()=>clearTimeout(L)},[t]);const I=a=>{if(a.locked){alert("Level ini terkunci! Selesaikan level sebelumnya terlebih dahulu.");return}b(!0),s(a),c(!0),h(!1)},v=()=>{c(!1),setTimeout(()=>{s(null),b(!1)},300)},j=a=>{a.title==="Pola Gambar"?t("/materi/materikelas4/materiBab3_1"):a.title==="Pola Gambar Membesar"?t("/materi/materikelas4/materiBab3_2"):a.title==="Pola Gambar Mengecil"?t("/materi/materikelas4/materiBab3_3"):a.title==="Pola Bilangan"?t("/materi/materikelas4/materiBab3_4"):a.title==="Pola Bilangan Membesar"?t("/materi/materikelas4/materiBab3_5"):a.title==="Pola Bilangan Mengecil"?t("/materi/materikelas4/materiBab3_6"):t(`/materi/materikelas4/materiBab3_${a.id}`)},y=a=>{t(a.path)},p=()=>{b(!0),setTimeout(()=>{t("/kelas4")},500)},d=a=>!1;return e.jsxs("div",{className:`category-container ${k?"animate-bg":""}`,children:[e.jsxs("div",{className:"background-elements",children:[E.map(a=>e.jsx("div",{className:"star",style:{width:a.size+"px",height:a.size+"px",left:a.left+"%",top:a.top+"%",animationDelay:a.delay+"s",animationDuration:a.duration+"s"}},`star-${a.id}`)),D.map(a=>e.jsx("div",{className:"cloud",style:{width:a.size+"px",height:a.size/2+"px",left:a.left+"%",top:a.top+"%",animationDuration:a.speed+"s",animationDelay:a.delay+"s"}},`cloud-${a.id}`))]}),e.jsxs("header",{className:"header animated-header",children:[e.jsxs(x.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:["BAB 3 ",e.jsx("span",{className:"wave",children:"🏠"})]}),e.jsx(x.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3,duration:.6},className:"header-tagline",children:"Eksplorasi dunia tiga dimensi dengan seru!"})]}),e.jsxs("section",{className:"categories-section",children:[e.jsxs(x.h2,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.7},children:[e.jsx("span",{className:"category-icon",children:"📦"})," Bab 3: Pengenalan Pola Bilangan Dan Gambar"]}),e.jsx(x.button,{className:"back-button",onClick:p,whileHover:{scale:1.05},whileTap:{scale:.95},initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},children:"Kembali"}),e.jsx(W,{children:S&&e.jsxs(x.div,{className:"hint-bubble",initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8},children:[e.jsx("div",{className:"hint-arrow"}),e.jsx("p",{children:"Klik kartu level untuk mulai belajar!"})]})}),e.jsx("div",{className:"level-path",children:Se.map((a,_)=>e.jsxs(oe.Fragment,{children:[_>0&&e.jsx("div",{className:"path-connector"}),e.jsx("div",{className:`path-node ${a.locked?"locked-node":""}`,children:a.id})]},`path-${a.id}`))}),e.jsx("div",{className:"level-grid",children:Se.map(a=>e.jsxs(x.div,{className:`level-card ${a.locked?"level-locked":""}`,onClick:()=>I(a),whileHover:a.locked?{}:{scale:1.05,y:-5},whileTap:a.locked?{}:{scale:.95},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*a.id},style:{boxShadow:"0 8px 20px rgba(0, 0, 0, 0.15)"},children:[e.jsxs("div",{className:`level-icon-circle ${d(a.id)?"completed":""}`,style:{background:a.gradient},children:[a.locked&&e.jsx("div",{className:"lock-overlay",children:"🔒"}),d(a.id),e.jsx("span",{className:"level-symbol",children:a.icon})]}),e.jsx("h3",{className:"level-title",children:a.title}),e.jsx("p",{className:"level-description",children:a.description}),e.jsxs("div",{className:"level-info",children:[e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"📚"})," ",a.subChapters.length," Sub Bab"]}),e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"🎮"})," ",a.games.length," Game"]})]}),e.jsx("div",{className:"level-badge",style:{background:a.color},children:a.id})]},a.id))})]}),e.jsx(W,{children:r&&n&&e.jsx(x.div,{className:"popup-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:v,children:e.jsxs(x.div,{className:"level-popup",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{type:"spring",damping:25},style:{background:"linear-gradient(to bottom right, white, #f9f9f9)",borderTop:`5px solid ${n.color}`},onClick:a=>a.stopPropagation(),children:[e.jsx(x.button,{className:"close-popup",onClick:v,initial:{opacity:0},animate:{opacity:1},whileHover:{scale:1.1},whileTap:{scale:.9},transition:{duration:.3,type:"spring",stiffness:300},children:"✕"}),e.jsxs("div",{className:"popup-header",style:{background:n.gradient},children:[e.jsx("div",{className:"popup-level-icon",children:n.icon}),e.jsxs("h2",{children:["Level ",n.id,": ",n.title]})]}),e.jsxs("div",{className:"popup-sections",children:[e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"📚"}),"Sub-Bab Materi"]}),e.jsx("div",{className:"sub-chapter-list",children:n.subChapters.map(a=>e.jsxs(x.div,{className:"sub-chapter-item",onClick:()=>j(a),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"sub-chapter-icon",children:a.icon}),e.jsxs("div",{className:"sub-chapter-content",children:[e.jsx("div",{className:"sub-chapter-number",children:a.id}),e.jsx("h4",{children:a.title})]}),e.jsx("div",{className:"sub-chapter-arrow",children:"→"})]},a.id))})]}),e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"🎮"}),"Game Latihan"]}),e.jsx("div",{className:"game-list",children:n.games.map(a=>e.jsxs(x.div,{className:"game-item",onClick:()=>y(a),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"game-icon",children:a.icon}),e.jsxs("div",{className:"game-content",children:[e.jsx("h4",{children:a.title}),e.jsx("span",{className:"game-label",children:"Main Sekarang"})]}),e.jsx("div",{className:"game-arrow",children:"→"})]},a.id))})]})]}),e.jsx("div",{className:"popup-footer",children:d(n.id)?e.jsxs("div",{className:"level-status completed-status",children:[e.jsx("span",{className:"status-icon",children:"✓"})," Level Selesai"]}):e.jsxs("div",{className:"level-status",children:[e.jsx("span",{className:"status-icon",children:"⏳"})," Belum Selesai"]})})]})})})]})}const we=[{id:1,title:"Level 1",description:"Pengukuran Luas",icon:"📏",color:"#4CAF50",gradient:"linear-gradient(135deg, #4CAF50, #81C784)",subChapters:[{id:1,title:"Pengukuran Luas Menggunakan Satuan Tidak Baku",icon:"🟦"},{id:2,title:"Pengukuran Luas Menggunakan Satuan Baku",icon:"📐"}],games:[{id:1,title:"Yuk Coba Gamenya!",path:"/game/kelas4/bab4/level1",icon:"🎮"}]},{id:2,title:"Level 2",description:"Pengukuran Volume",icon:"📦",color:"#2196F3",gradient:"linear-gradient(135deg, #2196F3, #64B5F6)",subChapters:[{id:3,title:"Pengukuran Volume Menggunakan Satuan Tidak Baku",icon:"🧊"},{id:4,title:"Pengukuran Volume Menggunakan Satuan Baku",icon:"🥛"}],games:[{id:2,title:"Yuk Coba Gamenya!",path:"/game/kelas4/bab4/level2",icon:"🎲"}]}];function qs(){const t=V(),[n,s]=o.useState(null),[r,c]=o.useState(!1),[m,u]=o.useState({}),[g,P]=o.useState([]),[k,b]=o.useState(!1),[S,h]=o.useState(!1),E=Array.from({length:50},(a,_)=>({id:_,size:Math.random()*3+1,left:Math.random()*100,top:Math.random()*100,delay:Math.random()*5,duration:Math.random()*3+2})),D=Array.from({length:6},(a,_)=>({id:_,size:Math.random()*150+100,left:Math.random()*100,top:Math.random()*20+10,speed:Math.random()*100+50,delay:Math.random()*20}));o.useEffect(()=>{if(!(localStorage.getItem("isLoggedIn")==="true")){t("/login");return}const _=JSON.parse(localStorage.getItem("selectedAvatar"));if(_){const i=`avatar_${_.name}_levels_progress`,$=JSON.parse(localStorage.getItem(i))||{};u($);const O=we.filter(T=>{var J;return!T.locked&&((J=$[`level_${T.id}`])==null?void 0:J.completed)}).map(T=>T.id);P(O)}const L=setTimeout(()=>{h(!0)},3e3);return()=>clearTimeout(L)},[t]);const I=a=>{if(a.locked){alert("Level ini terkunci! Selesaikan level sebelumnya terlebih dahulu.");return}b(!0),s(a),c(!0),h(!1)},v=()=>{c(!1),setTimeout(()=>{s(null),b(!1)},300)},j=a=>{a.title==="Pengukuran Luas Menggunakan Satuan Tidak Baku"?t("/materi/materikelas4/materiBab4_1"):a.title==="Pengukuran Luas Menggunakan Satuan Baku"?t("/materi/materikelas4/materiBab4_2"):a.title==="Pengukuran Volume Menggunakan Satuan Tidak Baku"?t("/materi/materikelas4/materiBab4_3"):a.title==="Pengukuran Volume Menggunakan Satuan Baku"?t("/materi/materikelas4/materiBab4_4"):t(`/materi/materikelas4/materiBab4_${a.id}`)},y=a=>{t(a.path)},p=()=>{b(!0),setTimeout(()=>{t("/kelas4")},500)},d=a=>!1;return e.jsxs("div",{className:`category-container ${k?"animate-bg":""}`,children:[e.jsxs("div",{className:"background-elements",children:[E.map(a=>e.jsx("div",{className:"star",style:{width:a.size+"px",height:a.size+"px",left:a.left+"%",top:a.top+"%",animationDelay:a.delay+"s",animationDuration:a.duration+"s"}},`star-${a.id}`)),D.map(a=>e.jsx("div",{className:"cloud",style:{width:a.size+"px",height:a.size/2+"px",left:a.left+"%",top:a.top+"%",animationDuration:a.speed+"s",animationDelay:a.delay+"s"}},`cloud-${a.id}`))]})," ",e.jsxs("header",{className:"header animated-header",children:[e.jsxs(x.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:["BAB 4 ",e.jsx("span",{className:"wave",children:"📏"})]}),e.jsx(x.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3,duration:.6},className:"header-tagline",children:"Belajar pengukuran luas dan volume bersama!"})]}),e.jsxs("section",{className:"categories-section",children:[" ",e.jsxs(x.h2,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.7},children:[e.jsx("span",{className:"category-icon",children:"📏"})," Bab 4: Pengukuran Luas dan Volume"]}),e.jsx(x.button,{className:"back-button",onClick:p,whileHover:{scale:1.05},whileTap:{scale:.95},initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},children:"Kembali"}),e.jsx(W,{children:S&&e.jsxs(x.div,{className:"hint-bubble",initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8},children:[e.jsx("div",{className:"hint-arrow"}),e.jsx("p",{children:"Klik kartu level untuk mulai belajar!"})]})}),e.jsx("div",{className:"level-path",children:we.map((a,_)=>e.jsxs(oe.Fragment,{children:[_>0&&e.jsx("div",{className:"path-connector"}),e.jsx("div",{className:`path-node ${a.locked?"locked-node":""}`,children:a.id})]},`path-${a.id}`))}),e.jsx("div",{className:"level-grid",children:we.map(a=>e.jsxs(x.div,{className:`level-card ${a.locked?"level-locked":""}`,onClick:()=>I(a),whileHover:a.locked?{}:{scale:1.05,y:-5},whileTap:a.locked?{}:{scale:.95},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*a.id},style:{boxShadow:"0 8px 20px rgba(0, 0, 0, 0.15)"},children:[e.jsxs("div",{className:`level-icon-circle ${d(a.id)?"completed":""}`,style:{background:a.gradient},children:[a.locked&&e.jsx("div",{className:"lock-overlay",children:"🔒"}),d(a.id),e.jsx("span",{className:"level-symbol",children:a.icon})]}),e.jsx("h3",{className:"level-title",children:a.title}),e.jsx("p",{className:"level-description",children:a.description}),e.jsxs("div",{className:"level-info",children:[e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"📚"})," ",a.subChapters.length," Sub Bab"]}),e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"🎮"})," ",a.games.length," Game"]})]}),e.jsx("div",{className:"level-badge",style:{background:a.color},children:a.id})]},a.id))})]}),e.jsx(W,{children:r&&n&&e.jsx(x.div,{className:"popup-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:v,children:e.jsxs(x.div,{className:"level-popup",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{type:"spring",damping:25},style:{background:"linear-gradient(to bottom right, white, #f9f9f9)",borderTop:`5px solid ${n.color}`},onClick:a=>a.stopPropagation(),children:[e.jsx(x.button,{className:"close-popup",onClick:v,initial:{opacity:0},animate:{opacity:1},whileHover:{scale:1.1},whileTap:{scale:.9},transition:{duration:.3,type:"spring",stiffness:300},children:"✕"}),e.jsxs("div",{className:"popup-header",style:{background:n.gradient},children:[e.jsx("div",{className:"popup-level-icon",children:n.icon}),e.jsxs("h2",{children:["Level ",n.id,": ",n.title]})]}),e.jsxs("div",{className:"popup-sections",children:[e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"📚"}),"Sub-Bab Materi"]}),e.jsx("div",{className:"sub-chapter-list",children:n.subChapters.map(a=>e.jsxs(x.div,{className:"sub-chapter-item",onClick:()=>j(a),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"sub-chapter-icon",children:a.icon}),e.jsxs("div",{className:"sub-chapter-content",children:[e.jsx("div",{className:"sub-chapter-number",children:a.id}),e.jsx("h4",{children:a.title})]}),e.jsx("div",{className:"sub-chapter-arrow",children:"→"})]},a.id))})]}),e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"🎮"}),"Game Latihan"]}),e.jsx("div",{className:"game-list",children:n.games.map(a=>e.jsxs(x.div,{className:"game-item",onClick:()=>y(a),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"game-icon",children:a.icon}),e.jsxs("div",{className:"game-content",children:[e.jsx("h4",{children:a.title}),e.jsx("span",{className:"game-label",children:"Main Sekarang"})]}),e.jsx("div",{className:"game-arrow",children:"→"})]},a.id))})]})]}),e.jsx("div",{className:"popup-footer",children:d(n.id)?e.jsxs("div",{className:"level-status completed-status",children:[e.jsx("span",{className:"status-icon",children:"✓"})," Level Selesai"]}):e.jsxs("div",{className:"level-status",children:[e.jsx("span",{className:"status-icon",children:"⏳"})," Belum Selesai"]})})]})})})]})}const _e=[{id:1,title:"Level 1",description:"Data dan Pengukuran",icon:"📊",color:"#E91E63",gradient:"linear-gradient(135deg, #E91E63, #F48FB1)",subChapters:[{id:1,title:"Apa Itu Segibanyak?",icon:"📝"},{id:2,title:" Segitiga: Bangun Tiga Sisi yang Seru!",icon:"📈"},{id:3,title:"Segiempat Bangun Empat Sisi yang Menarik",icon:"🔍"}],games:[{id:1,title:"Yuk Coba Gamenya!",path:"/game/kelas4/Bab5/level1",icon:"🎮"}]}];function Vs(){const t=V(),[n,s]=o.useState(null),[r,c]=o.useState(!1),[m,u]=o.useState({}),[g,P]=o.useState([]),[k,b]=o.useState(!1),[S,h]=o.useState(!1),E=Array.from({length:50},(a,_)=>({id:_,size:Math.random()*3+1,left:Math.random()*100,top:Math.random()*100,delay:Math.random()*5,duration:Math.random()*3+2})),D=Array.from({length:6},(a,_)=>({id:_,size:Math.random()*150+100,left:Math.random()*100,top:Math.random()*20+10,speed:Math.random()*100+50,delay:Math.random()*20}));o.useEffect(()=>{if(!(localStorage.getItem("isLoggedIn")==="true")){t("/login");return}const _=JSON.parse(localStorage.getItem("selectedAvatar"));if(_){const i=`avatar_${_.name}_levels_progress`,$=JSON.parse(localStorage.getItem(i))||{};u($);const O=_e.filter(T=>{var J;return!T.locked&&((J=$[`level_${T.id}`])==null?void 0:J.completed)}).map(T=>T.id);P(O)}const L=setTimeout(()=>{h(!0)},3e3);return()=>clearTimeout(L)},[t]);const I=a=>{if(a.locked){alert("Level ini terkunci! Selesaikan level sebelumnya terlebih dahulu.");return}b(!0),s(a),c(!0),h(!1)},v=()=>{c(!1),setTimeout(()=>{s(null),b(!1)},300)},j=a=>{a.title==="Apa Itu Segibanyak?"?t("/materi/materikelas4/materiBab5_1"):a.title===" Segitiga: Bangun Tiga Sisi yang Seru!"?t("/materi/materikelas4/materiBab5_2"):a.title==="Segiempat Bangun Empat Sisi yang Menarik"?t("/materi/materikelas4/materiBab5_3"):t(`/materi/materikelas4/materiBab5_${a.id}`)},y=a=>{t(a.path)},p=()=>{b(!0),setTimeout(()=>{t("/kelas4")},500)},d=a=>!1;return e.jsxs("div",{className:`category-container ${k?"animate-bg":""}`,children:[e.jsxs("div",{className:"background-elements",children:[E.map(a=>e.jsx("div",{className:"star",style:{width:a.size+"px",height:a.size+"px",left:a.left+"%",top:a.top+"%",animationDelay:a.delay+"s",animationDuration:a.duration+"s"}},`star-${a.id}`)),D.map(a=>e.jsx("div",{className:"cloud",style:{width:a.size+"px",height:a.size/2+"px",left:a.left+"%",top:a.top+"%",animationDuration:a.speed+"s",animationDelay:a.delay+"s"}},`cloud-${a.id}`))]})," ",e.jsxs("header",{className:"header animated-header",children:[e.jsxs(x.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:["BAB 5 ",e.jsx("span",{className:"wave",children:"📊"})]}),e.jsx(x.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3,duration:.6},className:"header-tagline",children:"Belajar data dan pengukuran bersama!"})]}),e.jsxs("section",{className:"categories-section",children:[" ",e.jsxs(x.h2,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.7},children:[e.jsx("span",{className:"category-icon",children:"📊"})," Bab 5: Data dan Pengukuran"]}),e.jsx(x.button,{className:"back-button",onClick:p,whileHover:{scale:1.05},whileTap:{scale:.95},initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},children:"Kembali"}),e.jsx(W,{children:S&&e.jsxs(x.div,{className:"hint-bubble",initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8},children:[e.jsx("div",{className:"hint-arrow"}),e.jsx("p",{children:"Klik kartu level untuk mulai belajar!"})]})}),e.jsx("div",{className:"level-path",children:_e.map((a,_)=>e.jsxs(oe.Fragment,{children:[_>0&&e.jsx("div",{className:"path-connector"}),e.jsx("div",{className:`path-node ${a.locked?"locked-node":""}`,children:a.id})]},`path-${a.id}`))}),e.jsx("div",{className:"level-grid",children:_e.map(a=>e.jsxs(x.div,{className:`level-card ${a.locked?"level-locked":""}`,onClick:()=>I(a),whileHover:a.locked?{}:{scale:1.05,y:-5},whileTap:a.locked?{}:{scale:.95},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*a.id},style:{boxShadow:"0 8px 20px rgba(0, 0, 0, 0.15)"},children:[e.jsxs("div",{className:`level-icon-circle ${d(a.id)?"completed":""}`,style:{background:a.gradient},children:[a.locked&&e.jsx("div",{className:"lock-overlay",children:"🔒"}),d(a.id),e.jsx("span",{className:"level-symbol",children:a.icon})]}),e.jsx("h3",{className:"level-title",children:a.title}),e.jsx("p",{className:"level-description",children:a.description}),e.jsxs("div",{className:"level-info",children:[e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"📚"})," ",a.subChapters.length," Sub Bab"]}),e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"🎮"})," ",a.games.length," Game"]})]}),e.jsx("div",{className:"level-badge",style:{background:a.color},children:a.id})]},a.id))})]}),e.jsx(W,{children:r&&n&&e.jsx(x.div,{className:"popup-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:v,children:e.jsxs(x.div,{className:"level-popup",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{type:"spring",damping:25},style:{background:"linear-gradient(to bottom right, white, #f9f9f9)",borderTop:`5px solid ${n.color}`},onClick:a=>a.stopPropagation(),children:[e.jsx(x.button,{className:"close-popup",onClick:v,initial:{opacity:0},animate:{opacity:1},whileHover:{scale:1.1},whileTap:{scale:.9},transition:{duration:.3,type:"spring",stiffness:300},children:"✕"}),e.jsxs("div",{className:"popup-header",style:{background:n.gradient},children:[e.jsx("div",{className:"popup-level-icon",children:n.icon}),e.jsxs("h2",{children:["Level ",n.id,": ",n.title]})]}),e.jsxs("div",{className:"popup-sections",children:[e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"📚"}),"Sub-Bab Materi"]}),e.jsx("div",{className:"sub-chapter-list",children:n.subChapters.map(a=>e.jsxs(x.div,{className:"sub-chapter-item",onClick:()=>j(a),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"sub-chapter-icon",children:a.icon}),e.jsxs("div",{className:"sub-chapter-content",children:[e.jsx("div",{className:"sub-chapter-number",children:a.id}),e.jsx("h4",{children:a.title})]}),e.jsx("div",{className:"sub-chapter-arrow",children:"→"})]},a.id))})]}),e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"🎮"}),"Game Latihan"]}),e.jsx("div",{className:"game-list",children:n.games.map(a=>e.jsxs(x.div,{className:"game-item",onClick:()=>y(a),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"game-icon",children:a.icon}),e.jsxs("div",{className:"game-content",children:[e.jsx("h4",{children:a.title}),e.jsx("span",{className:"game-label",children:"Main Sekarang"})]}),e.jsx("div",{className:"game-arrow",children:"→"})]},a.id))})]})]}),e.jsx("div",{className:"popup-footer",children:d(n.id)?e.jsxs("div",{className:"level-status completed-status",children:[e.jsx("span",{className:"status-icon",children:"✓"})," Level Selesai"]}):e.jsxs("div",{className:"level-status",children:[e.jsx("span",{className:"status-icon",children:"⏳"})," Belum Selesai"]})})]})})})]})}const Ce=[{id:1,title:"Level 1",description:"Data dan Diagram",icon:"📏",color:"#E91E63",gradient:"linear-gradient(135deg,rgb(233, 192, 30), #F48FB1)",subChapters:[{id:1,title:"Bentuk Penyajian Data Tabel Dan Diagram",icon:"📝"},{id:2,title:"Diagram Gambar (Piktogram)",icon:"📈"},{id:3,title:"Diagram Batang",icon:"🔍"}],games:[{id:1,title:"Yuk Coba Gamenya!",path:"/game/kelas4/Bab6/level1",icon:"🎮"}]}];function Ws(){const t=V(),[n,s]=o.useState(null),[r,c]=o.useState(!1),[m,u]=o.useState({}),[g,P]=o.useState([]),[k,b]=o.useState(!1),[S,h]=o.useState(!1),E=Array.from({length:50},(a,_)=>({id:_,size:Math.random()*3+1,left:Math.random()*100,top:Math.random()*100,delay:Math.random()*5,duration:Math.random()*3+2})),D=Array.from({length:6},(a,_)=>({id:_,size:Math.random()*150+100,left:Math.random()*100,top:Math.random()*20+10,speed:Math.random()*100+50,delay:Math.random()*20}));o.useEffect(()=>{if(!(localStorage.getItem("isLoggedIn")==="true")){t("/login");return}const _=JSON.parse(localStorage.getItem("selectedAvatar"));if(_){const i=`avatar_${_.name}_levels_progress`,$=JSON.parse(localStorage.getItem(i))||{};u($);const O=Ce.filter(T=>{var J;return!T.locked&&((J=$[`level_${T.id}`])==null?void 0:J.completed)}).map(T=>T.id);P(O)}const L=setTimeout(()=>{h(!0)},3e3);return()=>clearTimeout(L)},[t]);const I=a=>{if(a.locked){alert("Level ini terkunci! Selesaikan level sebelumnya terlebih dahulu.");return}b(!0),s(a),c(!0),h(!1)},v=()=>{c(!1),setTimeout(()=>{s(null),b(!1)},300)},j=a=>{t(`/materi/materikelas4/materiBab6_${a.id}`)},y=a=>{t(a.path)},p=()=>{b(!0),setTimeout(()=>{t("/kelas4")},500)},d=a=>!1;return e.jsxs("div",{className:`category-container ${k?"animate-bg":""}`,children:[e.jsxs("div",{className:"background-elements",children:[E.map(a=>e.jsx("div",{className:"star",style:{width:a.size+"px",height:a.size+"px",left:a.left+"%",top:a.top+"%",animationDelay:a.delay+"s",animationDuration:a.duration+"s"}},`star-${a.id}`)),D.map(a=>e.jsx("div",{className:"cloud",style:{width:a.size+"px",height:a.size/2+"px",left:a.left+"%",top:a.top+"%",animationDuration:a.speed+"s",animationDelay:a.delay+"s"}},`cloud-${a.id}`))]})," ",e.jsxs("header",{className:"header animated-header",children:[e.jsxs(x.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:["BAB 6 ",e.jsx("span",{className:"wave",children:"📊"})]}),e.jsx(x.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3,duration:.6},className:"header-tagline",children:"Belajar Piktogram dan Diagram Batang bersama!"})]}),e.jsxs("section",{className:"categories-section",children:[" ",e.jsxs(x.h2,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.7},children:[e.jsx("span",{className:"category-icon",children:"📊"})," Bab 6: Piktogram dan Diagram Batang"]}),e.jsx(x.button,{className:"back-button",onClick:p,whileHover:{scale:1.05},whileTap:{scale:.95},initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},children:"Kembali"}),e.jsx(W,{children:S&&e.jsxs(x.div,{className:"hint-bubble",initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8},children:[e.jsx("div",{className:"hint-arrow"}),e.jsx("p",{children:"Klik kartu level untuk mulai belajar!"})]})}),e.jsx("div",{className:"level-path",children:Ce.map((a,_)=>e.jsxs(oe.Fragment,{children:[_>0&&e.jsx("div",{className:"path-connector"}),e.jsx("div",{className:`path-node ${a.locked?"locked-node":""}`,children:a.id})]},`path-${a.id}`))}),e.jsx("div",{className:"level-grid",children:Ce.map(a=>e.jsxs(x.div,{className:`level-card ${a.locked?"level-locked":""}`,onClick:()=>I(a),whileHover:a.locked?{}:{scale:1.05,y:-5},whileTap:a.locked?{}:{scale:.95},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*a.id},style:{boxShadow:"0 8px 20px rgba(0, 0, 0, 0.15)"},children:[e.jsxs("div",{className:`level-icon-circle ${d(a.id)?"completed":""}`,style:{background:a.gradient},children:[a.locked&&e.jsx("div",{className:"lock-overlay",children:"🔒"}),d(a.id),e.jsx("span",{className:"level-symbol",children:a.icon})]}),e.jsx("h3",{className:"level-title",children:a.title}),e.jsx("p",{className:"level-description",children:a.description}),e.jsxs("div",{className:"level-info",children:[e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"📚"})," ",a.subChapters.length," Sub Bab"]}),e.jsxs("span",{className:"info-item",children:[e.jsx("i",{className:"info-icon",children:"🎮"})," ",a.games.length," Game"]})]}),e.jsx("div",{className:"level-badge",style:{background:a.color},children:a.id})]},a.id))})]}),e.jsx(W,{children:r&&n&&e.jsx(x.div,{className:"popup-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:v,children:e.jsxs(x.div,{className:"level-popup",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{type:"spring",damping:25},style:{background:"linear-gradient(to bottom right, white, #f9f9f9)",borderTop:`5px solid ${n.color}`},onClick:a=>a.stopPropagation(),children:[e.jsx(x.button,{className:"close-popup",onClick:v,initial:{opacity:0},animate:{opacity:1},whileHover:{scale:1.1},whileTap:{scale:.9},transition:{duration:.3,type:"spring",stiffness:300},children:"✕"}),e.jsxs("div",{className:"popup-header",style:{background:n.gradient},children:[e.jsx("div",{className:"popup-level-icon",children:n.icon}),e.jsxs("h2",{children:["Level ",n.id,": ",n.title]})]}),e.jsxs("div",{className:"popup-sections",children:[e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"📚"}),"Sub-Bab Materi"]}),e.jsx("div",{className:"sub-chapter-list",children:n.subChapters.map(a=>e.jsxs(x.div,{className:"sub-chapter-item",onClick:()=>j(a),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"sub-chapter-icon",children:a.icon}),e.jsxs("div",{className:"sub-chapter-content",children:[e.jsx("div",{className:"sub-chapter-number",children:a.id}),e.jsx("h4",{children:a.title})]}),e.jsx("div",{className:"sub-chapter-arrow",children:"→"})]},a.id))})]}),e.jsxs("div",{className:"popup-section",children:[e.jsxs("h3",{children:[e.jsx("span",{className:"section-icon",children:"🎮"}),"Game Latihan"]}),e.jsx("div",{className:"game-list",children:n.games.map(a=>e.jsxs(x.div,{className:"game-item",onClick:()=>y(a),whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},children:[e.jsx("div",{className:"game-icon",children:a.icon}),e.jsxs("div",{className:"game-content",children:[e.jsx("h4",{children:a.title}),e.jsx("span",{className:"game-label",children:"Main Sekarang"})]}),e.jsx("div",{className:"game-arrow",children:"→"})]},a.id))})]})]}),e.jsx("div",{className:"popup-footer",children:d(n.id)?e.jsxs("div",{className:"level-status completed-status",children:[e.jsx("span",{className:"status-icon",children:"✓"})," Level Selesai"]}):e.jsxs("div",{className:"level-status",children:[e.jsx("span",{className:"status-icon",children:"⏳"})," Belum Selesai"]})})]})})})]})}const A=({children:t})=>localStorage.getItem("isLoggedIn")==="true"?t:e.jsx(de,{to:"/login"}),$e=({children:t})=>localStorage.getItem("userRole")==="admin"?t:e.jsx(de,{to:"/"});function Ys(){const[t,n]=o.useState(null);return o.useEffect(()=>{const s=async()=>{try{if(!w){n("Tidak dapat terhubung ke database. Beberapa fitur mungkin tidak tersedia.");return}const c=await w.testConnection();n(c?null:"Tidak dapat terhubung ke database. Beberapa fitur mungkin tidak tersedia.")}catch(c){console.error("Database connection error:",c),n("Terjadi kesalahan saat menghubungi database.")}};s();const r=setInterval(s,3e4);return()=>clearInterval(r)},[]),e.jsxs(ea,{children:[t&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,backgroundColor:"#fff3cd",color:"#856404",padding:"10px",textAlign:"center",zIndex:1e3},children:t}),e.jsxs(aa,{children:[e.jsx(B,{path:"/",element:e.jsx(ds,{})}),e.jsx(B,{path:"/login",element:e.jsx(Cs,{})}),e.jsx(B,{path:"/main-siswa",element:e.jsx(A,{children:e.jsx(Is,{})})}),e.jsx(B,{path:"/kelas2",element:e.jsx(A,{children:e.jsx(Rs,{})})}),e.jsx(B,{path:"/kelas4",element:e.jsx(A,{children:e.jsx(Gs,{})})}),e.jsx(B,{path:"/category4_bab1",element:e.jsx(A,{children:e.jsx(zs,{})})}),e.jsx(B,{path:"/category4_bab2",element:e.jsx(A,{children:e.jsx(Hs,{})})}),e.jsx(B,{path:"/category4_bab3",element:e.jsx(A,{children:e.jsx(Us,{})})}),e.jsx(B,{path:"/category4_bab4",element:e.jsx(A,{children:e.jsx(qs,{})})}),e.jsx(B,{path:"/category4_bab5",element:e.jsx(A,{children:e.jsx(Vs,{})})}),e.jsx(B,{path:"/category4_bab6",element:e.jsx(A,{children:e.jsx(Ws,{})})}),e.jsx(B,{path:"/kategori",element:e.jsx(A,{children:e.jsx(Ms,{})})}),e.jsx(B,{path:"/game/:chapterIndex/:levelIndex",element:e.jsx(A,{children:e.jsx(Bs,{})})}),e.jsx(B,{path:"/hasil/:score",element:e.jsx(A,{children:e.jsx(Ls,{})})}),e.jsx(B,{path:"/hasil-retry/:score",element:e.jsx(A,{children:e.jsx(Ds,{})})}),e.jsx(B,{path:"/skor",element:e.jsx(A,{children:e.jsx(Ps,{})})}),e.jsx(B,{path:"/category",element:e.jsx(A,{children:e.jsx(As,{})})}),e.jsx(B,{path:"/game/penjumlahan",element:e.jsx(A,{children:e.jsx(Fa,{})})}),e.jsx(B,{path:"/game/pembagian",element:e.jsx(A,{children:e.jsx(Ja,{})})}),e.jsx(B,{path:"/game/pengurangan",element:e.jsx(A,{children:e.jsx(Ra,{})})}),e.jsx(B,{path:"/game/perkalian",element:e.jsx(A,{children:e.jsx(Ga,{})})}),e.jsx(B,{path:"/game/pengukuran-luas",element:e.jsx(A,{children:e.jsx(za,{})})}),e.jsx(B,{path:"/game/pengukuran-volume",element:e.jsx(A,{children:e.jsx(Ha,{})})}),e.jsx(B,{path:"/game/kelas4/bab1/level1",element:e.jsx(A,{children:e.jsx(Ua,{})})}),e.jsx(B,{path:"/game/kelas4/bab1/level2",element:e.jsx(A,{children:e.jsx(qa,{})})}),e.jsx(B,{path:"/game/kelas4/bab1/level3",element:e.jsx(A,{children:e.jsx(Va,{})})}),e.jsx(B,{path:"/game/kelas4/bab1/level4",element:e.jsx(A,{children:e.jsx(Wa,{})})}),e.jsx(B,{path:"/game/kelas4/bab2/level1",element:e.jsx(A,{children:e.jsx(Ya,{})})}),e.jsx(B,{path:"/game/kelas4/bab2/level2",element:e.jsx(A,{children:e.jsx(Xa,{})})}),e.jsx(B,{path:"/game/kelas4/bab2/level3",element:e.jsx(A,{children:e.jsx(Za,{})})}),e.jsx(B,{path:"/game/kelas4/bab2/level4",element:e.jsx(A,{children:e.jsx(Qa,{})})})," ",e.jsx(B,{path:"/game/kelas4/bab3/level1",element:e.jsx(A,{children:e.jsx(es,{})})}),e.jsx(B,{path:"/game/kelas4/bab3/level2",element:e.jsx(A,{children:e.jsx(as,{})})}),e.jsx(B,{path:"/game/kelas4/bab4/level1",element:e.jsx(A,{children:e.jsx(ss,{})})}),e.jsx(B,{path:"/game/kelas4/bab4/level2",element:e.jsx(A,{children:e.jsx(ts,{})})}),e.jsx(B,{path:"/game/kelas4/bab5/level1",element:e.jsx(A,{children:e.jsx(is,{})})}),e.jsx(B,{path:"/game/kelas4/bab6/level1",element:e.jsx(A,{children:e.jsx(ns,{})})}),e.jsx(B,{path:"/game/addition",element:e.jsx(de,{to:"/game/penjumlahan",replace:!0})}),e.jsx(B,{path:"/game/division",element:e.jsx(de,{to:"/game/pembagian",replace:!0})}),e.jsx(B,{path:"/game/subtraction",element:e.jsx(de,{to:"/game/pengurangan",replace:!0})}),e.jsx(B,{path:"/game/multiplication",element:e.jsx(de,{to:"/game/perkalian",replace:!0})}),e.jsx(B,{path:"/materi/addition",element:e.jsx(A,{children:e.jsx(la,{})})}),e.jsx(B,{path:"/materi/subtraction",element:e.jsx(A,{children:e.jsx(ra,{})})}),e.jsx(B,{path:"/materi/multiplication",element:e.jsx(A,{children:e.jsx(oa,{})})}),e.jsx(B,{path:"/materi/division",element:e.jsx(A,{children:e.jsx(ca,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab1_1",element:e.jsx(A,{children:e.jsx(da,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab1_2",element:e.jsx(A,{children:e.jsx(ma,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab1_3",element:e.jsx(A,{children:e.jsx(ha,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab1_4",element:e.jsx(A,{children:e.jsx(ua,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab1_5",element:e.jsx(A,{children:e.jsx(pa,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab1_6",element:e.jsx(A,{children:e.jsx(ga,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab1_7",element:e.jsx(A,{children:e.jsx(xa,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab2_1",element:e.jsx(A,{children:e.jsx(fa,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab2_2",element:e.jsx(A,{children:e.jsx(ja,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab2_3",element:e.jsx(A,{children:e.jsx(ba,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab2_4",element:e.jsx(A,{children:e.jsx(va,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab2_5",element:e.jsx(A,{children:e.jsx(ya,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab2_6",element:e.jsx(A,{children:e.jsx(ka,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab2_7",element:e.jsx(A,{children:e.jsx(Na,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab3_1",element:e.jsx(A,{children:e.jsx(Sa,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab3_2",element:e.jsx(A,{children:e.jsx(wa,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab3_3",element:e.jsx(A,{children:e.jsx(_a,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab3_4",element:e.jsx(A,{children:e.jsx(Ca,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab3_5",element:e.jsx(A,{children:e.jsx(Ia,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab3_6",element:e.jsx(A,{children:e.jsx(Ma,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab4_1",element:e.jsx(A,{children:e.jsx(Ba,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab4_2",element:e.jsx(A,{children:e.jsx(La,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab4_3",element:e.jsx(A,{children:e.jsx(Pa,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab4_4",element:e.jsx(A,{children:e.jsx(Da,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab5_1",element:e.jsx(A,{children:e.jsx(Aa,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab5_2",element:e.jsx(A,{children:e.jsx($a,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab5_3",element:e.jsx(A,{children:e.jsx(Ka,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab6_1",element:e.jsx(A,{children:e.jsx(Ea,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab6_2",element:e.jsx(A,{children:e.jsx(Oa,{})})}),e.jsx(B,{path:"/materi/materikelas4/materiBab6_3",element:e.jsx(A,{children:e.jsx(Ta,{})})}),e.jsx(B,{path:"/admin/register",element:e.jsx($e,{children:e.jsx(ta,{})})}),e.jsx(B,{path:"/guru/dashboard",element:e.jsx(A,{children:e.jsx(Ae,{})})}),e.jsx(B,{path:"/tabguru",element:e.jsx(A,{children:e.jsx(Ae,{})})}),e.jsx(B,{path:"/admin/dashboard",element:e.jsx($e,{children:e.jsx(ia,{})})})]})]})}const Xs=o.createContext(null),Zs=({children:t})=>{const[n,s]=o.useState(null),[r,c]=o.useState(!0),[m,u]=o.useState(null);o.useEffect(()=>{const b=async()=>{try{if(!w){console.error("Supabase client not initialized"),c(!1);return}const{data:{user:h}}=await w.auth.getUser();if(h){try{await w.rpc("set_current_user_id",{user_id:h.id})}catch(E){console.error("Error setting current user ID:",E)}s(h)}}catch(h){console.error("Error checking auth state:",h),u(h.message)}finally{c(!1)}};if(!w){console.error("Supabase client not initialized"),c(!1);return}const{data:{subscription:S}}=w.auth.onAuthStateChange(async(h,E)=>{if(E!=null&&E.user){try{await w.rpc("set_current_user_id",{user_id:E.user.id})}catch(D){console.error("Error setting current user ID:",D)}s(E.user)}else s(null);c(!1)});return b(),()=>{S==null||S.unsubscribe()}},[]);const k={user:n,loading:r,error:m,signIn:async(b,S)=>{try{if(!w)throw new Error("Supabase client not initialized");const{data:h,error:E}=await w.auth.signInWithPassword({email:b,password:S});if(E)throw E;return h}catch(h){throw u(h.message),h}},signOut:async()=>{try{if(!w)throw new Error("Supabase client not initialized");const{error:b}=await w.auth.signOut();if(b)throw b;localStorage.clear(),s(null)}catch(b){throw u(b.message),b}}};return e.jsx(Xs.Provider,{value:k,children:t})};console.log("============ DEBUG KONEKSI SUPABASE ============");const Qs=()=>{if(!w)return console.error("[Supabase] Client tidak tersedia"),!1;if(typeof w.from!="function")return console.error("[Supabase] Metode from tidak tersedia pada client"),!1;try{const t=w.from("siswa");return!t||typeof t.select!="function"?(console.error("[Supabase] Metode from tidak mengembalikan objek yang valid"),!1):!0}catch(t){return console.error("[Supabase] Error saat validasi client:",t),!1}};console.log("Supabase client tersedia:",w?"Ya":"Tidak");w&&(console.log("Supabase URL:",w.supabaseUrl),console.log("Supabase Key tersedia:",w.supabaseKey?"Ya":"Tidak"),console.log("Metode yang tersedia:",Object.keys(w).join(", ")),console.log("Validasi client:",Qs()?"Valid":"Tidak valid"));const et=sa.createRoot(document.getElementById("root"));et.render(e.jsx(oe.StrictMode,{children:e.jsx(Zs,{children:e.jsx(Ys,{})})}));
//# sourceMappingURL=index-CPIz5NXw.js.map
